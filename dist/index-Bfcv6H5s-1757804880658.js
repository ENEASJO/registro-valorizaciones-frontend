import{j as e,F as re,X as Ie,L as qa,B as us,S as ge,a as le,C as Pe,H as xa,b as Ha,c as Ve,d as $e,e as Ja,U as ue,M as Za,f as ls,g as ua,h as Ka,T as Q,i as ys,A as Es,k as H,l as B,m as oe,D as ie,n as Us,o as Gs,p as Bs,E as Ya,q as ke,I as _s,r as Y,s as As,t as X,u as Ke,P as pa,v as Xa,w as Ee,x as de,y as Ue,R as Qa,z as et,G as st,Z as at,J as Je,K as ce,N as ve,O as Xs,Q as vs,V as be,W as De,Y as cs,_ as tt,$ as as,a0 as rt,a1 as Ws,a2 as it,a3 as ts,a4 as Cs,a5 as nt,a6 as lt,a7 as ha,a8 as ot,a9 as ct,aa as dt,ab as mt,ac as Ss,ad as ga,ae as xt,af as ut,ag as ks,ah as pt,ai as Oe,aj as ht,ak as Qs,al as qs,am as je,an as gt,ao as bt,ap as jt,aq as ft,ar as ye,as as Nt,at as Ts,au as ea,av as Hs,aw as yt,ax as sa,ay as vt,az as wt,aA as Et,aB as _t,aC as At,aD as aa,aE as ta,aF as Ct,aG as St,aH as ra,aI as ia}from"./ui-B5NvA3qg-1757804880658.js";import{d as Pt,a as o,u as ba,L as Fs,O as Dt,R as Rt,B as Ot,e as It,f as pe,N as kt}from"./vendor-B3hXgR8--1757804880658.js";import{m as S,A as we,u as ja,a as Vs,b as fa}from"./utils-Br7exALx-1757804880658.js";import{R as ne,L as Tt,a as Ze,A as Mt,C as Ge,X as Be,Y as Re,T as he,b as fs,P as Ps,c as Ds,d as ds,e as Js,f as ms,g as xs,B as Zs,h as Se,i as zt,j as Lt,k as Ft,l as Vt,m as $t,n as Ut,S as Gt,o as Bt}from"./charts-C5cLmyp--1757804880658.js";(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))x(f);new MutationObserver(f=>{for(const n of f)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&x(l)}).observe(document,{childList:!0,subtree:!0});function j(f){const n={};return f.integrity&&(n.integrity=f.integrity),f.referrerPolicy&&(n.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?n.credentials="include":f.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function x(f){if(f.ep)return;f.ep=!0;const n=j(f);fetch(f.href,n)}})();var ps={},na;function Wt(){if(na)return ps;na=1;var s=Pt();return ps.createRoot=s.createRoot,ps.hydrateRoot=s.hydrateRoot,ps}var qt=Wt();const Ht=()=>{const[s,b]=o.useState(!0),[j,x]=o.useState(!1),[f,n]=o.useState(!1),[l,N]=o.useState(!1),_=ba(),w=[{name:"Dashboard",href:"/",icon:qa},{name:"Empresas",icon:le,hasSubmenu:!0,submenu:[{name:"Empresas Ejecutoras",href:"/empresas/ejecutoras",icon:us},{name:"Empresas Supervisoras",href:"/empresas/supervisoras",icon:ge}]},{name:"Obras",href:"/obras",icon:Pe},{name:"Valorizaciones",icon:re,hasSubmenu:!0,submenu:[{name:"Valorización de Ejecución",href:"/valorizaciones/ejecucion",icon:xa},{name:"Valorización de Supervisión",href:"/valorizaciones/supervision",icon:Ha}]},{name:"Reportes",href:"/reportes",icon:Ve},{name:"Configuración",href:"/configuracion",icon:$e}],i=r=>r?_.pathname===r||_.pathname.startsWith(r+"/"):!1,t=r=>r.submenu?r.submenu.some(c=>_.pathname===c.href):!1;return o.useEffect(()=>{_.pathname.startsWith("/empresas")&&n(!0),_.pathname.startsWith("/valorizaciones")&&N(!0)},[_.pathname]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(S.div,{initial:{x:0},animate:{x:s?0:-280},className:"fixed inset-y-0 left-0 z-50 w-72 bg-white shadow-xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between px-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Valorizaciones"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sistema de Gestión"})]})]}),e.jsx("button",{onClick:()=>b(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 space-y-1 px-3 py-4",children:w.map(r=>e.jsx("div",{children:r.hasSubmenu?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{r.name==="Empresas"?n(!f):r.name==="Valorizaciones"&&N(!l)},className:`
                        w-full flex items-center justify-between px-3 py-2.5 rounded-lg transition-all duration-200
                        ${t(r)?"bg-primary-50 text-primary-600 font-medium shadow-sm":"text-gray-700 hover:bg-gray-100"}
                      `,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r.icon,{className:"w-5 h-5"}),e.jsx("span",{children:r.name})]}),e.jsx(S.div,{animate:{rotate:r.name==="Empresas"&&f||r.name==="Valorizaciones"&&l?90:0},transition:{duration:.2},children:e.jsx(Ja,{className:"w-4 h-4"})})]}),e.jsx(we,{children:(r.name==="Empresas"&&f||r.name==="Valorizaciones"&&l)&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"ml-4 mt-1 space-y-1",children:r.submenu?.map(c=>e.jsxs(Fs,{to:c.href,className:`
                                  flex items-center gap-3 px-3 py-2 rounded-lg transition-all duration-200
                                  ${_.pathname===c.href?c.href.includes("/ejecucion")?"bg-blue-50 text-blue-600 font-medium":c.href.includes("/supervision")?"bg-green-50 text-green-600 font-medium":"bg-blue-50 text-blue-600 font-medium":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}
                                `,children:[e.jsx(c.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:c.name}),_.pathname===c.href&&e.jsx(S.div,{layoutId:"activeSubTab",className:`absolute left-3 w-0.5 h-6 rounded-full ${c.href.includes("/ejecucion")?"bg-blue-600":c.href.includes("/supervision")?"bg-green-600":"bg-blue-600"}`})]},c.name))})})})]}):r.href?e.jsxs(Fs,{to:r.href,className:`
                      flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200
                      ${i(r.href)?"bg-primary-50 text-primary-600 font-medium shadow-sm":"text-gray-700 hover:bg-gray-100"}
                    `,children:[e.jsx(r.icon,{className:"w-5 h-5"}),e.jsx("span",{children:r.name}),i(r.href)&&e.jsx(S.div,{layoutId:"activeTab",className:"absolute left-0 w-1 h-8 bg-primary-600 rounded-r-full"})]}):null},r.name))}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Admin Usuario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"admin@empresa.com"})]})]})})]})}),e.jsxs("div",{className:`transition-all duration-300 ${s?"ml-72":"ml-0"}`,children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-6",children:[e.jsx("button",{onClick:()=>b(!s),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Za,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{className:"relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:[e.jsx(ls,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>x(!j),className:"flex items-center gap-2 p-2 hover:bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center",children:e.jsx(ue,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin"}),e.jsx(ua,{className:"w-4 h-4 text-gray-500"})]}),j&&e.jsxs(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1",children:[e.jsxs("button",{className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[e.jsx(ue,{className:"w-4 h-4"}),"Mi Perfil"]}),e.jsxs("button",{className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[e.jsx($e,{className:"w-4 h-4"}),"Configuración"]}),e.jsx("hr",{className:"my-1"}),e.jsxs("button",{className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(Ka,{className:"w-4 h-4"}),"Cerrar Sesión"]})]})]})]})]})}),e.jsx("main",{className:"p-6",children:e.jsx(Dt,{})})]})]})},Jt=()=>{const s=ba();return o.useEffect(()=>{console.warn(`Ruta no encontrada: ${s.pathname}`),s.pathname==="/Backend"&&(console.error("ERROR: Intento de navegación a /Backend detectado"),console.error("Location completa:",s),console.error("Stack trace:",new Error().stack))},[s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:e.jsx(Q,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Página no encontrada"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["La ruta ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm",children:s.pathname})," no existe."]}),s.pathname==="/Backend"&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"Error detectado:"}),' Navegación incorrecta a "/Backend". Esta ruta no debería existir en el frontend.']})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Fs,{to:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(ys,{className:"w-4 h-4"}),"Ir al Dashboard"]}),e.jsxs("button",{onClick:()=>window.history.back(),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors ml-3",children:[e.jsx(Es,{className:"w-4 h-4"}),"Volver atrás"]})]})]})})},Zt={Building2:le,DollarSign:ie,FileText:re,TrendingUp:oe,CheckCircle:B,Clock:H},Kt=({metric:s,index:b,onClick:j})=>{const[x,f]=o.useState(!1),[n,l]=o.useState(0),N=ja(0),_=Vs(N,Math.round);fa(N,{duration:2e3}),o.useEffect(()=>{const h=typeof s.value=="number"?s.value:0;N.set(h)},[s.value,N]),o.useEffect(()=>_.onChange(h=>l(h)),[_]);const w=Zt[s.icon]||le,i=h=>{switch(s.format){case"currency":return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0,maximumFractionDigits:0,notation:h>=1e6?"compact":"standard",compactDisplay:"short"}).format(h);case"percentage":return`${h}%`;case"number":return new Intl.NumberFormat("es-PE",{notation:h>=1e3?"compact":"standard",compactDisplay:"short"}).format(h);default:return h.toString()}},t=()=>s.changeType==="increase"?Us:s.changeType==="decrease"?Gs:Bs,r=()=>s.changeType==="increase"?"text-green-600":s.changeType==="decrease"?"text-red-600":"text-gray-500",c=t(),p=s.sparklineData.map((h,a)=>({index:a,value:h}));return e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.1,duration:.5,type:"spring",stiffness:100},whileHover:{y:-4,transition:{duration:.2,type:"spring",stiffness:300}},onClick:j,onHoverStart:()=>f(!0),onHoverEnd:()=>f(!1),className:"relative group cursor-pointer",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20 shadow-xl"}),e.jsx(S.div,{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{background:`linear-gradient(45deg, ${s.color.replace("bg-gradient-to-r from-","").replace(" to-",", ")})`,filter:"blur(20px)",transform:"scale(1.1)",zIndex:-1}}),e.jsxs("div",{className:"relative p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-gray-200/50 shadow-lg hover:shadow-2xl transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(S.div,{animate:{scale:x?1.1:1,rotate:x?5:0},transition:{duration:.2},className:`p-3 rounded-xl ${s.color} shadow-lg`,children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs(S.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:b*.1+.3},className:`flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 ${r()}`,children:[e.jsx(c,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-xs font-medium",children:[Math.abs(s.change).toFixed(1),"%"]})]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:s.title}),e.jsx(S.div,{className:"mb-4",children:e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:i(n)})}),e.jsx("div",{className:"h-12 mb-3",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsx(Tt,{data:p,children:e.jsx(Ze,{type:"monotone",dataKey:"value",stroke:s.color.includes("blue")?"#3B82F6":s.color.includes("emerald")?"#10B981":s.color.includes("purple")?"#8B5CF6":s.color.includes("orange")?"#F59E0B":s.color.includes("teal")?"#14B8A6":"#6366F1",strokeWidth:2,dot:!1,activeDot:{r:3,fill:"currentColor"}})})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"vs. período anterior"}),e.jsxs(S.span,{initial:{opacity:0},animate:{opacity:1},transition:{delay:b*.1+.5},className:`font-medium ${r()}`,children:[s.changeType==="increase"?"+":s.changeType==="decrease"?"-":"",Math.abs(s.change).toFixed(1),"%"]})]}),e.jsx(S.div,{className:"absolute top-2 right-2 w-2 h-2 bg-green-400 rounded-full",animate:{scale:[1,1.2,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx(S.div,{className:"absolute inset-0 rounded-2xl bg-gradient-to-br from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})]})},Yt=({alerts:s,onMarkAsRead:b,onDismiss:j,maxVisible:x=5})=>{const[f,n]=o.useState(null),[l,N]=o.useState(!1),_=p=>{switch(p){case"critical":return Q;case"warning":return Y;case"info":return _s;default:return ls}},w=p=>{switch(p){case"critical":return{bg:"bg-red-50",border:"border-red-200",icon:"text-red-500",title:"text-red-800",message:"text-red-700",pulse:"bg-red-400"};case"warning":return{bg:"bg-amber-50",border:"border-amber-200",icon:"text-amber-500",title:"text-amber-800",message:"text-amber-700",pulse:"bg-amber-400"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-500",title:"text-blue-800",message:"text-blue-700",pulse:"bg-blue-400"};default:return{bg:"bg-gray-50",border:"border-gray-200",icon:"text-gray-500",title:"text-gray-800",message:"text-gray-700",pulse:"bg-gray-400"}}},i=p=>{const a=new Date().getTime()-p.getTime(),u=Math.floor(a/(1e3*60)),d=Math.floor(a/(1e3*60*60)),A=Math.floor(a/(1e3*60*60*24));return u<1?"Ahora mismo":u<60?`${u}m`:d<24?`${d}h`:`${A}d`},t=l?s:s.slice(0,x),r=s.filter(p=>!p.read).length,c=s.filter(p=>p.type==="critical"&&!p.read).length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S.div,{animate:{scale:c>0?[1,1.1,1]:1},transition:{duration:1,repeat:c>0?1/0:0,ease:"easeInOut"},children:e.jsx(ls,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Alertas y Notificaciones"}),r>0&&e.jsx(S.span,{initial:{scale:0},animate:{scale:1},className:"px-2 py-1 text-xs font-bold text-white bg-red-500 rounded-full",children:r})]}),s.length>x&&e.jsxs("button",{onClick:()=>N(!l),className:"flex items-center gap-2 px-3 py-1 text-sm text-blue-600 hover:text-blue-700 transition-colors",children:[l?e.jsx(Ya,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"}),l?"Mostrar menos":`Ver todas (${s.length})`]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:e.jsx(we,{mode:"popLayout",children:t.map((p,h)=>{const a=_(p.type),u=w(p.type),d=f===p.id;return e.jsxs(S.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20,height:0},transition:{duration:.3,delay:h*.05,layout:{duration:.2}},className:`relative p-4 rounded-xl border-2 transition-all duration-300 cursor-pointer group hover:shadow-md ${u.bg} ${u.border} ${p.read?"":"ring-2 ring-offset-2 ring-blue-100"}`,onClick:()=>{p.read||b(p.id),n(d?null:p.id)},children:[!p.read&&e.jsx(S.div,{className:`absolute -top-1 -right-1 w-3 h-3 rounded-full ${u.pulse}`,animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S.div,{animate:p.type==="critical"&&!p.read?{rotate:[0,-5,5,-5,5,0]}:{},transition:{duration:.5,repeat:p.type==="critical"&&!p.read?1/0:0,repeatDelay:3},className:"flex-shrink-0",children:e.jsx(a,{className:`w-5 h-5 ${u.icon}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:`font-medium text-sm ${u.title}`,children:p.title}),!p.read&&e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]}),e.jsx(S.p,{className:`text-sm leading-relaxed ${u.message}`,initial:!1,animate:{opacity:d?1:.8,height:d?"auto":"1.5rem"},style:{overflow:d?"visible":"hidden",textOverflow:d?"clip":"ellipsis",whiteSpace:d?"normal":"nowrap"},children:p.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:i(p.timestamp)})]})]}),j&&e.jsx(S.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:A=>{A.stopPropagation(),j(p.id)},className:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-white/50 transition-colors",children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsx(S.div,{className:"absolute inset-0 rounded-xl bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",whileHover:{scale:1.01}})]},p.id)})})}),s.length===0&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-8",children:[e.jsx(S.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(ls,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"})}),e.jsx("p",{className:"text-gray-500",children:"No hay alertas pendientes"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"¡Todo está funcionando correctamente!"})]}),s.length>0&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"flex items-center justify-between px-4 py-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),s.filter(p=>p.type==="critical").length," Críticas"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),s.filter(p=>p.type==="warning").length," Advertencias"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),s.filter(p=>p.type==="info").length," Información"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r," sin leer"]})]})]})},Xt=({value:s,title:b="Eficiencia General",subtitle:j="Obras en tiempo vs total",size:x="md",showLabels:f=!0,animated:n=!0})=>{const[l,N]=o.useState(!1),_=typeof s=="number"&&!isNaN(s)&&isFinite(s)?Math.min(Math.max(s,0),100):0,i={sm:{radius:80,strokeWidth:8,fontSize:"text-xl"},md:{radius:100,strokeWidth:10,fontSize:"text-3xl"},lg:{radius:120,strokeWidth:12,fontSize:"text-4xl"}}[x],{radius:t,strokeWidth:r}=i,c=2*Math.PI*t,p=t+r,h=(t+r)*2,a=ja(0),u=fa(a,{stiffness:50,damping:15,duration:2e3}),d=Vs(u,[0,100],[0,c*.75]),A=Vs(u,Math.round);o.useEffect(()=>{n&&a.set(_)},[_,a,n]);const k=(P=>P>=80?{primary:"#10B981",secondary:"#D1FAE5",gradient:"from-green-400 to-emerald-500",text:"text-green-600"}:P>=60?{primary:"#F59E0B",secondary:"#FEF3C7",gradient:"from-amber-400 to-orange-500",text:"text-amber-600"}:{primary:"#EF4444",secondary:"#FEE2E2",gradient:"from-red-400 to-red-600",text:"text-red-600"})(_),D=(P=>P>=80?oe:P>=60?As:Q)(_),C=P=>P>=90?"Excelente":P>=80?"Muy Bueno":P>=70?"Bueno":P>=60?"Regular":P>=40?"Bajo":"Crítico";return e.jsxs(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6,type:"spring",stiffness:100},className:"flex flex-col items-center p-6",onHoverStart:()=>N(!0),onHoverEnd:()=>N(!1),children:[f&&e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:b}),e.jsx("p",{className:"text-sm text-gray-600",children:j})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:h,height:h,viewBox:`0 0 ${h} ${h}`,className:"transform -rotate-90",children:[e.jsx("circle",{cx:p,cy:p,r:t,stroke:"#F3F4F6",strokeWidth:r,fill:"none",strokeDasharray:`${c*.75} ${c*.25}`,strokeLinecap:"round",className:"opacity-30"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`gradient-${b}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:k.primary,stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:k.primary,stopOpacity:"1"})]}),e.jsxs("filter",{id:`glow-${b}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx(S.circle,{cx:p,cy:p,r:t,stroke:`url(#gradient-${b})`,strokeWidth:r,fill:"none",strokeDasharray:`${d} ${c}`,strokeLinecap:"round",filter:l?`url(#glow-${b})`:"none",className:"transition-all duration-300",initial:{strokeDasharray:`0 ${c}`},animate:{strokeDasharray:n?`${d} ${c}`:`${_/100*c*.75} ${c}`},transition:{duration:2,ease:"easeInOut"}}),n&&e.jsx(S.circle,{cx:p,cy:p,r:t,stroke:k.primary,strokeWidth:1,fill:"none",opacity:0,animate:{r:[t,t+10],opacity:[.5,0]},transition:{duration:2,repeat:1/0,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(S.div,{animate:{scale:l?1.2:1,rotate:l?360:0},transition:{duration:.3,rotate:{duration:.6}},className:`mb-2 p-2 rounded-full bg-gradient-to-br ${k.gradient} shadow-lg`,children:e.jsx(D,{className:"w-6 h-6 text-white"})}),e.jsxs(S.div,{className:`font-bold ${k.text} ${i.fontSize}`,children:[n?e.jsx(S.span,{children:A}):e.jsx("span",{children:_}),e.jsx("span",{className:"text-lg",children:"%"})]}),e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1.5},className:`text-xs font-medium ${k.text} mt-1`,children:C(_)})]}),e.jsx(S.div,{className:`absolute inset-0 rounded-full border-2 border-dashed ${k.text.replace("text-","border-")} opacity-0`,animate:{opacity:l?.3:0,scale:l?1.1:1},transition:{duration:.3}})]}),f&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"flex justify-between w-full max-w-xs mt-4 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full mx-auto mb-1"}),e.jsx("span",{className:"text-gray-500",children:"0-40"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full mx-auto mb-1"}),e.jsx("span",{className:"text-gray-500",children:"40-80"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full mx-auto mb-1"}),e.jsx("span",{className:"text-gray-500",children:"80-100"})]})]}),e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-4 text-center",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:Math.round(_*.24)}),e.jsx("div",{className:"text-gray-500",children:"En tiempo"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:Math.round((100-_)*.24)}),e.jsx("div",{className:"text-gray-500",children:"Retrasadas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"24"}),e.jsx("div",{className:"text-gray-500",children:"Total"})]})]})})]})},Qt=({obras:s,onObracClick:b,maxVisible:j=8})=>{const[x,f]=o.useState(null),[n,l]=o.useState("all"),[N,_]=o.useState(!1),w=h=>{switch(h){case"En ejecución":return{color:"bg-green-500",textColor:"text-green-700",bgColor:"bg-green-50",icon:Xa,pulse:!0};case"Pausada":return{color:"bg-amber-500",textColor:"text-amber-700",bgColor:"bg-amber-50",icon:pa,pulse:!1};case"Finalizada":return{color:"bg-blue-500",textColor:"text-blue-700",bgColor:"bg-blue-50",icon:B,pulse:!1};case"Retrasada":return{color:"bg-red-500",textColor:"text-red-700",bgColor:"bg-red-50",icon:Q,pulse:!0};default:return{color:"bg-gray-500",textColor:"text-gray-700",bgColor:"bg-gray-50",icon:H,pulse:!1}}},i=h=>{const a=new Date,u=h.getTime()-a.getTime();return Math.ceil(u/(1e3*60*60*24))},t=(h,a)=>a==="Retrasada"?"bg-red-500":h>=80?"bg-green-500":h>=50?"bg-amber-500":"bg-blue-500",r=s.filter(h=>{switch(n){case"active":return h.estado==="En ejecución";case"delayed":return h.estado==="Retrasada";case"completed":return h.estado==="Finalizada";default:return!0}}).sort((h,a)=>h.fechaVencimiento.getTime()-a.fechaVencimiento.getTime()),c=N?r:r.slice(0,j),p=[{key:"all",label:"Todas",count:s.length},{key:"active",label:"Activas",count:s.filter(h=>h.estado==="En ejecución").length},{key:"delayed",label:"Retrasadas",count:s.filter(h=>h.estado==="Retrasada").length},{key:"completed",label:"Finalizadas",count:s.filter(h=>h.estado==="Finalizada").length}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Timeline de Obras"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"flex gap-1",children:p.map(h=>e.jsxs("button",{onClick:()=>l(h.key),className:`px-3 py-1 text-xs font-medium rounded-full transition-all duration-200 ${n===h.key?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[h.label," (",h.count,")"]},h.key))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-200 via-blue-300 to-blue-200"}),e.jsx("div",{className:"space-y-4",children:e.jsx(we,{mode:"popLayout",children:c.map((h,a)=>{const u=w(h.estado),d=u.icon,A=i(h.fechaVencimiento),y=x===h.id,k=t(h.avance,h.estado);return e.jsxs(S.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,delay:a*.05,layout:{duration:.2}},className:"relative group",children:[e.jsx(S.div,{className:`absolute left-4 w-4 h-4 rounded-full border-4 border-white shadow-lg ${u.color} z-10`,animate:u.pulse?{scale:[1,1.2,1],boxShadow:["0 0 0 0 rgba(59, 130, 246, 0)","0 0 0 10px rgba(59, 130, 246, 0.1)","0 0 0 0 rgba(59, 130, 246, 0)"]}:{},transition:{duration:2,repeat:u.pulse?1/0:0,ease:"easeInOut"}}),e.jsxs(S.div,{className:`ml-12 p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 ${y?"border-blue-300 shadow-lg":"border-gray-200 hover:border-gray-300"} ${u.bgColor} group-hover:shadow-md`,onClick:()=>{f(y?null:h.id),b?.(h.id)},whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:`w-4 h-4 ${u.textColor}`}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${u.bgColor} ${u.textColor} border ${u.textColor.replace("text-","border-")}`,children:h.estado})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1 line-clamp-2",children:h.nombre}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:h.contratista})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{className:A<0?"text-red-600 font-medium":A<=7?"text-amber-600 font-medium":"",children:A<0?`${Math.abs(A)} días vencida`:A===0?"Vence hoy":`${A} días restantes`})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Avance"}),e.jsxs("span",{className:"font-medium",children:[h.avance,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx(S.div,{className:`h-full rounded-full ${k}`,initial:{width:0},animate:{width:`${h.avance}%`},transition:{duration:1,delay:a*.1}})})]}),e.jsx(we,{children:y&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fecha inicio:"}),e.jsx("div",{className:"font-medium",children:h.fechaInicio.toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fecha vencimiento:"}),e.jsx("div",{className:"font-medium",children:h.fechaVencimiento.toLocaleDateString("es-ES")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 p-3 bg-white/50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:Math.round((new Date().getTime()-h.fechaInicio.getTime())/(1e3*60*60*24))}),e.jsx("div",{className:"text-xs text-gray-500",children:"Días transcurridos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:Math.round((h.fechaVencimiento.getTime()-h.fechaInicio.getTime())/(1e3*60*60*24))}),e.jsx("div",{className:"text-xs text-gray-500",children:"Duración total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-lg font-bold ${h.avance>=80?"text-green-600":h.avance>=50?"text-amber-600":"text-red-600"}`,children:(h.avance/100*Math.round((h.fechaVencimiento.getTime()-h.fechaInicio.getTime())/(1e3*60*60*24))).toFixed(0)}),e.jsx("div",{className:"text-xs text-gray-500",children:"Días productivos"})]})]})]})})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsx(S.div,{animate:{rotate:h.avance>50?0:180},className:`p-1 rounded-full ${h.avance>50?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:e.jsx(oe,{className:"w-3 h-3"})})})]}),e.jsx(S.div,{className:"absolute inset-0 rounded-xl bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]})]},h.id)})})}),r.length>j&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>_(!N),className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:N?"Mostrar menos":`Ver todas (${r.length-j} más)`})}),r.length===0&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx(X,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No hay obras para mostrar"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:n!=="all"&&"Prueba cambiando los filtros"})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.filter(h=>h.estado==="En ejecución").length}),e.jsx("div",{className:"text-xs text-gray-600",children:"En Ejecución"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.filter(h=>h.estado==="Finalizada").length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.filter(h=>h.estado==="Retrasada").length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Retrasadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-600",children:[Math.round(r.reduce((h,a)=>h+a.avance,0)/r.length)||0,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Avance Promedio"})]})]})]})},er=({data:s,onDistritoClick:b,metric:j="inversion"})=>{const[x,f]=o.useState(null),[n,l]=o.useState(null),[N,_]=o.useState(j),w=u=>{switch(N){case"obras":return u.obras;case"eficiencia":return u.eficiencia;case"inversion":default:return u.inversion}},i=u=>{const d=w(u),A=Math.max(...s.map(y=>w(y)));return A>0?d/A:0},t=u=>{const d=i(u);switch(N){case"obras":return{bg:`rgba(59, 130, 246, ${.1+d*.8})`,border:`rgba(59, 130, 246, ${.3+d*.7})`,text:d>.5?"text-white":"text-blue-900"};case"eficiencia":const A=u.eficiencia>=70;return{bg:A?`rgba(34, 197, 94, ${.1+d*.8})`:`rgba(239, 68, 68, ${.1+d*.8})`,border:A?`rgba(34, 197, 94, ${.3+d*.7})`:`rgba(239, 68, 68, ${.3+d*.7})`,text:d>.5?"text-white":A?"text-green-900":"text-red-900"};case"inversion":default:return{bg:`rgba(168, 85, 247, ${.1+d*.8})`,border:`rgba(168, 85, 247, ${.3+d*.7})`,text:d>.5?"text-white":"text-purple-900"}}},r=u=>{const d=w(u);switch(N){case"obras":return`${d} obras`;case"eficiencia":return`${d}%`;case"inversion":return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",notation:"compact",maximumFractionDigits:1}).format(d)}},p=(()=>{switch(N){case"obras":return{label:"Número de Obras",icon:le,color:"text-blue-600",bgColor:"bg-blue-50"};case"eficiencia":return{label:"Eficiencia Promedio",icon:oe,color:"text-green-600",bgColor:"bg-green-50"};case"inversion":default:return{label:"Inversión Total",icon:ie,color:"text-purple-600",bgColor:"bg-purple-50"}}})(),h=p.icon,a=[...s].sort((u,d)=>w(d)-w(u));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Mapa de Calor - Distrito de San Marcos"})]}),e.jsx("div",{className:"flex items-center gap-2 p-1 bg-gray-100 rounded-lg",children:["inversion","obras","eficiencia"].map(u=>{const d=N===u;return e.jsxs("button",{onClick:()=>_(u),className:`px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ${d?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[u==="inversion"&&"Inversión",u==="obras"&&"Obras",u==="eficiencia"&&"Eficiencia"]},u)})})]}),e.jsxs("div",{className:`p-4 rounded-lg ${p.bgColor} border border-opacity-20`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(h,{className:`w-5 h-5 ${p.color}`}),e.jsx("span",{className:"font-medium text-gray-900",children:p.label})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[N==="inversion"&&"Inversión total acumulada por localidad",N==="obras"&&"Cantidad de obras activas por localidad",N==="eficiencia"&&"Promedio de eficiencia de obras por localidad"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:a.map((u,d)=>{const A=t(u),y=i(u),k=x===u.distrito,O=n===u.distrito;return e.jsx(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:d*.05,type:"spring",stiffness:100},whileHover:{scale:1.05,transition:{duration:.2}},whileTap:{scale:.95},className:"relative group cursor-pointer",onClick:()=>{f(k?null:u.distrito),b?.(u.distrito)},onHoverStart:()=>l(u.distrito),onHoverEnd:()=>l(null),children:e.jsxs("div",{className:`relative p-4 rounded-xl border-2 transition-all duration-300 ${k?"ring-2 ring-blue-300 ring-offset-2":""} ${O?"shadow-lg":"shadow-sm"}`,style:{backgroundColor:A.bg,borderColor:A.border},children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-3 h-3 rounded-full border border-white/50",style:{backgroundColor:A.border}})}),e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium text-sm ${A.text} line-clamp-2`,children:u.distrito.replace("C.P. ","").replace("Zona Urbana - ","").replace("Caserío ","")}),u.tipo&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[u.tipo==="Centro Poblado"&&e.jsx(de,{className:"w-3 h-3"}),u.tipo==="Zona Urbana"&&e.jsx(Ue,{className:"w-3 h-3"}),u.tipo==="Caserío"&&e.jsx(ys,{className:"w-3 h-3"}),e.jsxs("span",{className:`text-xs ${A.text} opacity-75`,children:[u.tipo==="Centro Poblado"&&"C.P.",u.tipo==="Zona Urbana"&&"Urbano",u.tipo==="Caserío"&&"Caserío"]})]})]})}),e.jsx("div",{className:`text-lg font-bold ${A.text} mb-1`,children:r(u)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`text-xs ${A.text} opacity-75`,children:["#",d+1]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-8 h-1 bg-white/30 rounded-full overflow-hidden",children:e.jsx(S.div,{className:"h-full bg-white/60 rounded-full",initial:{width:0},animate:{width:`${y*100}%`},transition:{duration:1,delay:d*.05}})})})]}),e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:O?1:0,y:O?0:10},className:"absolute -top-20 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs p-2 rounded-lg whitespace-nowrap z-10 pointer-events-none",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Obras: ",u.obras]}),e.jsxs("div",{children:["Inversión: ",new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",notation:"compact"}).format(u.inversion)]}),e.jsxs("div",{children:["Eficiencia: ",u.eficiencia,"%"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]}),d===0&&e.jsx(S.div,{className:"absolute inset-0 rounded-xl border-2",style:{borderColor:A.border},animate:{scale:[1,1.05,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]})},u.distrito)})}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Intensidad del color indica el valor relativo"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-200 rounded-full"}),e.jsx("span",{children:"Menor"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-12 h-2 bg-gradient-to-r from-gray-200 via-blue-300 to-blue-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${N==="obras"?"bg-blue-600":N==="eficiencia"?"bg-green-600":"bg-purple-600"}`}),e.jsx("span",{children:"Mayor"})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Estructura Territorial del Distrito de San Marcos"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Zona Urbana"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Barrios de San Marcos ciudad"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Centros Poblados"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Agrupaciones de caseríos"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Caseríos"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Caseríos independientes"})]})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Localidades"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.reduce((u,d)=>u+d.obras,0)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Obras"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:new Intl.NumberFormat("es-PE",{notation:"compact",maximumFractionDigits:1}).format(s.reduce((u,d)=>u+d.inversion,0))}),e.jsx("div",{className:"text-xs text-gray-600",children:"Inversión Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(s.reduce((u,d)=>u+d.eficiencia,0)/s.length),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Eficiencia Promedio"})]})]})]})},sr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BACKEND_URL:void 0},ar=()=>"https://registro-valorizaciones-503600768755.southamerica-west1.run.app",Ms=ar();let Ns=Ms.endsWith("/")?Ms.slice(0,-1):Ms;Ns.startsWith("http://")&&(console.warn("🔒 Forzando HTTPS en API_BASE_URL (segunda verificación)"),Ns=Ns.replace("http://","https://"));const te=Ns;{let s=function(){const n=new x,l=n.open;return n.open=function(N,_,w,i,t){let r=_.toString();const c=r.trim(),p="registro-valorizaciones-503600768755.southamerica-west1.run.app";if(c.includes("http://")&&c.includes(p)){const h=c.replace("http://"+p,"https://"+p);console.warn("🔧 XMLHttpRequest interceptado: Corrigiendo HTTP a HTTPS:",{original:c,corrected:h}),r=h}return l.call(this,N,r,w!==!1,i||null,t||null)},n},b=function(n,l){if(typeof n=="string"){const N=n.trim(),_="registro-valorizaciones-503600768755.southamerica-west1.run.app";if(N.includes("http://")&&N.includes(_)){const w=N.replace("http://"+_,"https://"+_);return console.warn("🔧 Request constructor interceptado: Corrigiendo HTTP a HTTPS:",{original:N,corrected:w}),new f(w,l)}}return new f(n,l)};if(typeof window<"u"){const n=window.fetch;window.fetch=function(l,N){let _;if(typeof l=="string")_=l;else if(l instanceof URL)_=l.toString();else if(l instanceof Request)_=l.url;else return n.call(this,l,N);_.includes("registro-valorizaciones-503600768755.southamerica-west1.run.app")&&console.log("🔍 DEBUG: URL que llega al interceptor fetch:",_);const w=_.trim(),i="registro-valorizaciones-503600768755.southamerica-west1.run.app";if(w.includes("http://")&&w.includes(i)){const t=w.replace("http://"+i,"https://"+i);if(console.warn("🔧 WINDOW.FETCH interceptado: Corrigiendo HTTP a HTTPS:",{original:w,corrected:t}),typeof l=="string")return n.call(this,t,N);if(l instanceof URL)return n.call(this,new URL(t),N);{const r=new Request(t,{method:l.method,headers:l.headers,body:l.body,mode:l.mode,credentials:l.credentials,cache:l.cache,redirect:l.redirect,referrer:l.referrer,referrerPolicy:l.referrerPolicy,...N});return n.call(this,r)}}return n.call(this,l,N)},console.log("🛡️ WINDOW.FETCH interceptador activado")}"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(n=>{n.forEach(l=>{console.log("🔄 Desinstalando Service Worker anterior:",l),l.unregister()}),setTimeout(()=>{navigator.serviceWorker.register("/service-worker.js?v="+Date.now(),{scope:"/"}).then(l=>{console.log("✅ Service Worker reinstalado:",l),l.active&&l.active.postMessage({type:"SKIP_WAITING"})}).catch(l=>{console.error("❌ Error al reinstalar Service Worker:",l)})},1e3)});const j=globalThis.fetch;globalThis.fetch=function(n,l){let N;if(typeof n=="string")N=n;else if(n instanceof URL)N=n.toString();else if(n instanceof Request)N=n.url;else return j.call(this,n,l);const _=N.trim(),w="registro-valorizaciones-503600768755.southamerica-west1.run.app";if(_.includes("http://")&&_.includes(w)){const i=_.replace("http://"+w,"https://"+w);if(console.warn("🔧 Fetch interceptado: Corrigiendo HTTP a HTTPS:",{original:_,corrected:i}),typeof n=="string")return j.call(this,i,l);if(n instanceof URL)return j.call(this,new URL(i),l);{const t=new Request(i,{method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,referrerPolicy:n.referrerPolicy,...l});return j.call(this,t)}}return _.includes("http://")&&_.includes(w)&&console.log("⚠️  URL HTTP detectada para corrección:",_),j.call(this,n,l)};const x=globalThis.XMLHttpRequest;s.prototype=x.prototype,s.UNSENT=x.UNSENT,s.OPENED=x.OPENED,s.HEADERS_RECEIVED=x.HEADERS_RECEIVED,s.LOADING=x.LOADING,s.DONE=x.DONE,globalThis.XMLHttpRequest=s;const f=globalThis.Request;b.prototype=f.prototype,globalThis.Request=b,console.log("🛡️ Fetch interceptador activado para corregir URLs HTTP"),console.log("🛡️ XMLHttpRequest interceptador activado"),console.log("🛡️ Request constructor interceptador")}console.log("🌐 Configuración de API en producción:"),console.log("  API_BASE_URL:",te),console.log("  VITE_BACKEND_URL:",void 0),console.log("  PROD:",!0),console.log("  MODE:","production"),console.log("  ¿Empieza con http://?:",te.startsWith("http://")),console.log("  ¿Empieza con https://?:",te.startsWith("https://"));te.includes("localhost")&&console.error("🚨 ERROR: Usando localhost en producción!",{API_BASE_URL:te,env:sr});const G={consultaRuc:`${te}/consultar-ruc`,consultaRucConsolidada:`${te}/consulta-ruc-consolidada`,empresas:`${te}/api/empresas`,empresasGuardadas:`${te}/api/empresas`,empresasSearch:`${te}/api/empresas-guardadas/search`,empresasStats:`${te}/api/empresas-guardadas/stats`,obras:`${te}/obras`,valorizaciones:`${te}/valorizaciones`,health:`${te}/health`,consultaOsce:`${te}/consulta-osce`,buscar:`${te}/buscar`};{const s=`?_v=${Date.now()}`;Object.keys(G).forEach(b=>{typeof G[b]=="string"&&(G[b]+=s)}),console.log("🔄 Cache busting activado con parámetro:",s),console.log("🔄 Endpoint empresas:",G.empresas)}const Na={"Content-Type":"application/json",Accept:"application/json"},ya=parseInt("45000");let os=!1,Ne=null,is=null;const va=async()=>{if(!("serviceWorker"in navigator))throw new Error("Service Worker not supported in this browser");return os&&Ne?(console.log("✅ Service Worker already registered and ready"),Ne):is?(console.log("⏳ Waiting for existing Service Worker registration..."),await is,Ne):(is=(async()=>{try{console.log("🛡️ Registering Service Worker...");const b=`/service-worker.js?v=${Date.now()}`,j=await navigator.serviceWorker.register(b,{scope:"/"});if(console.log("🛡️ Service Worker registered:",j),Ne=j,j.active){console.log("✅ Service Worker already active"),os=!0;return}console.log("⏳ Waiting for Service Worker activation..."),await tr(j),console.log("✅ Service Worker is ready and active"),os=!0;return}catch(s){throw console.error("❌ Service Worker registration failed:",s),s}finally{is=null}})(),await is,Ne)},tr=s=>new Promise((b,j)=>{if(s.active){b();return}s.addEventListener("updatefound",()=>{const f=s.installing;f&&(console.log("🔄 Service Worker installing..."),f.addEventListener("statechange",()=>{console.log(`🔄 Service Worker state: ${f.state}`),f.state==="activated"?(console.log("🚀 Service Worker activated successfully"),b()):f.state==="redundant"&&(console.error("❌ Service Worker became redundant"),j(new Error("Service Worker installation failed")))}))});const x=setTimeout(()=>{console.warn("⏰ Service Worker activation timeout - proceeding anyway"),b()},5e3);setTimeout(()=>clearTimeout(x),0)}),qe=async(s=1e4)=>{if(os){console.log("✅ Service Worker already ready");return}console.log("⏳ Waiting for Service Worker readiness...");const b=new Promise((j,x)=>{setTimeout(()=>x(new Error("Service Worker readiness timeout")),s)});try{await Promise.race([va(),b]),console.log("✅ Service Worker is ready for API calls")}catch(j){console.warn("⚠️ Service Worker not ready, proceeding anyway:",j)}},rr=()=>{console.log("🔍 Service Worker Status:",{ready:os,registration:Ne?{active:!!Ne.active,installing:!!Ne.installing,waiting:!!Ne.waiting,scope:Ne.scope}:null,navigatorSupported:"serviceWorker"in navigator}),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(s=>{console.log("📋 Browser Service Worker Registration:",{active:!!s?.active,installing:!!s?.installing,waiting:!!s?.waiting,scope:s?.scope})}).catch(s=>{console.error("❌ Error getting Service Worker registration:",s)})};typeof window<"u"&&console.log("🛡️ Service Worker utility loaded (production mode)");const ns=s=>({id:s.id,codigo:s.codigo||`EMP${s.id.toString().padStart(3,"0")}`,ruc:s.ruc,razon_social:s.razon_social,nombre_comercial:s.razon_social,email:s.email,telefono:s.celular,direccion:s.direccion,distrito:void 0,provincia:void 0,departamento:void 0,representante_legal:s.representante_legal,dni_representante:s.dni_representante,estado:s.estado||"ACTIVO",tipo_empresa:"SAC",categoria_contratista:s.categoria_contratista,especialidades:s.especialidades||[],activo:!0,created_at:s.created_at,updated_at:s.updated_at}),Rs=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async p=>{x(!0),n(null),console.log("🔍 Service Worker status before API call:"),rr(),console.log("⏰ API call timestamp:",new Date().toISOString());try{console.log("⏳ Waiting for Service Worker before loading empresas..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with API call")}catch(h){console.warn("⚠️ Service Worker not ready, proceeding anyway:",h)}try{console.log("🌐 Making API call to:",G.empresasGuardadas);const h=await fetch(G.empresasGuardadas);if(!h.ok)throw new Error(`HTTP ${h.status}: ${h.statusText}`);const a=await h.json();if(console.log("📊 DEBUG: Respuesta completa del API:",a),a.success&&a.data){const u=a.data.empresas||a.data;console.log("📊 DEBUG: Array de empresas antes de mapear:",u);let d=u.map(ns);if(console.log("📊 DEBUG: Empresas después de mapear:",d),p?.search){const A=p.search.toLowerCase();d=d.filter(y=>y.razon_social.toLowerCase().includes(A)||y.nombre_comercial?.toLowerCase().includes(A)||y.ruc.includes(A))}p?.estado&&(d=d.filter(A=>A.estado===p.estado)),p?.categoria&&(d=d.filter(A=>A.categoria_contratista===p.categoria)),p?.especialidades&&p.especialidades.length>0&&(d=d.filter(A=>A.especialidades?.some(y=>p.especialidades.includes(y)))),b(d)}else b([])}catch(h){console.error("Error loading empresas from database:",h),n("Error al cargar empresas desde el servidor"),b([])}finally{x(!1)}},[]),N=o.useCallback(async p=>{x(!0),n(null);try{console.log("⏳ Waiting for Service Worker before creating empresa..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with create API call")}catch(h){console.warn("⚠️ Service Worker not ready for create, proceeding anyway:",h)}try{console.log("🌐 Making create API call to:",G.empresas);const h=await fetch(G.empresas,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!h.ok)throw new Error(`HTTP ${h.status}: ${h.statusText}`);const a=await h.json();if(a.success&&a.data){const u=ns(a.data);return await l(),u}else throw new Error(a.message||"Error en la respuesta del servidor")}catch(h){const a=h instanceof Error?h.message:"Error al crear empresa";throw n(a),console.error("Error creating empresa:",h),h}finally{x(!1)}},[l]),_=o.useCallback(async(p,h)=>{x(!0),n(null);try{console.log("⏳ Waiting for Service Worker before updating empresa..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with update API call")}catch(a){console.warn("⚠️ Service Worker not ready for update, proceeding anyway:",a)}try{console.log("🌐 Making update API call to:",`${G.empresas}/${p}`);const a=await fetch(`${G.empresas}/${p}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!a.ok)throw a.status===404?new Error("Empresa no encontrada"):new Error(`HTTP ${a.status}: ${a.statusText}`);const u=await a.json();if(u.success&&u.data){const d=ns(u.data);return await l(),d}else throw new Error(u.message||"Error en la respuesta del servidor")}catch(a){const u=a instanceof Error?a.message:"Error al actualizar empresa";throw n(u),console.error("Error updating empresa:",a),a}finally{x(!1)}},[l]),w=o.useCallback(async p=>{x(!0),n(null);try{const h=s.find(d=>d.id===p);if(!h)throw new Error("Empresa no encontrada");const a=await fetch(`${G.empresasGuardadas}/${h.ruc}`,{method:"DELETE"});if(!a.ok)throw a.status===404?new Error("Empresa no encontrada"):new Error(`HTTP ${a.status}: ${a.statusText}`);const u=await a.json();if(u.success)return await l(),!0;throw new Error(u.message||"Error al eliminar empresa")}catch(h){const a=h instanceof Error?h.message:"Error al eliminar empresa";throw n(a),console.error("Error deleting empresa:",h),h}finally{x(!1)}},[s,l]),i=o.useCallback(async p=>{const h=s.find(a=>a.id===p);return h||(console.warn("obtenerEmpresaPorId: Empresa no encontrada en lista local, considere usar obtenerEmpresaPorRuc"),null)},[s]),t=o.useCallback(async p=>{x(!0),n(null);try{console.log("⏳ Waiting for Service Worker before getting empresa by RUC..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with get API call")}catch(h){console.warn("⚠️ Service Worker not ready for get, proceeding anyway:",h)}try{console.log("🌐 Making get API call to:",`${G.empresasGuardadas}/${p}`);const h=await fetch(`${G.empresasGuardadas}/${p}`);if(!h.ok){if(h.status===404)return null;throw new Error(`HTTP ${h.status}: ${h.statusText}`)}const a=await h.json();return a.success&&a.data?ns(a.data):null}catch(h){return console.error("Error getting empresa by RUC:",h),n("Error al obtener empresa por RUC"),null}finally{x(!1)}},[]),r=o.useCallback(async p=>{if(!p.trim())return[];x(!0),n(null);try{console.log("⏳ Waiting for Service Worker before searching empresas..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with search API call")}catch(h){console.warn("⚠️ Service Worker not ready for search, proceeding anyway:",h)}try{console.log("🌐 Making search API call to:",`${G.empresasSearch}?q=${encodeURIComponent(p)}`);const h=await fetch(`${G.empresasSearch}?q=${encodeURIComponent(p)}`);if(!h.ok)throw new Error(`HTTP ${h.status}: ${h.statusText}`);const a=await h.json();if(console.log("🔍 DEBUG: Respuesta de búsqueda:",a),a.success&&a.data){const u=a.data.empresas||a.data;console.log("🔍 DEBUG: Array de empresas en búsqueda:",u);const d=u.map(ns);return console.log("🔍 DEBUG: Empresas mapeadas en búsqueda:",d),d}return[]}catch(h){return console.error("Error searching empresas:",h),n("Error al buscar empresas"),[]}finally{x(!1)}},[]),c=o.useCallback(async()=>{x(!0),n(null);try{console.log("⏳ Waiting for Service Worker before getting stats..."),await qe(5e3),console.log("✅ Service Worker ready, proceeding with stats API call")}catch(p){console.warn("⚠️ Service Worker not ready for stats, proceeding anyway:",p)}try{console.log("🌐 Making stats API call to:",G.empresasStats);const p=await fetch(G.empresasStats);if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const h=await p.json();return h.success&&h.data?h.data:null}catch(p){return console.error("Error getting empresas stats:",p),n("Error al obtener estadísticas de empresas"),null}finally{x(!1)}},[]);return o.useEffect(()=>{(async()=>{{console.log("⏳ useEmpresas: Waiting for Service Worker before initial load...");try{await qe(5e3),console.log("✅ useEmpresas: Service Worker ready, loading empresas...")}catch(h){console.warn("⚠️ useEmpresas: Service Worker not ready, loading anyway:",h)}}await l()})()},[]),{empresas:s,loading:j,error:f,cargarEmpresas:l,crearEmpresa:N,actualizarEmpresa:_,eliminarEmpresa:w,obtenerEmpresaPorId:i,obtenerEmpresaPorRuc:t,buscarEmpresas:r,obtenerEstadisticas:c}},ir=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async w=>{x(!0),n(null);try{b([])}catch(i){n("Error al cargar consorcios"),console.error(i)}finally{x(!1)}},[]),N=o.useCallback(async w=>{x(!0),n(null);try{throw new Error("Funcionalidad de consorcios no implementada aún")}catch(i){const t=i instanceof Error?i.message:"Error al crear consorcio";throw n(t),i}finally{x(!1)}},[]),_=o.useCallback(w=>null,[]);return o.useEffect(()=>{l()},[l]),{consorcios:s,loading:j,error:f,cargarConsorcios:l,crearConsorcio:N,obtenerConsorcioPorId:_}},Te=()=>{const{empresas:s,loading:b,error:j}=Rs(),{consorcios:x,loading:f,error:n}=ir();return{entidades:[...s.map(w=>({id:w.id,tipo_entidad:"EMPRESA",empresa_id:w.id,consorcio_id:void 0,nombre_completo:w.razon_social,ruc_principal:w.ruc,capacidad_contratacion_anual:void 0,experiencia_anos:void 0,estado:w.estado,activo:w.activo,created_at:w.created_at,updated_at:w.updated_at,datos_empresa:{ruc:w.ruc,razon_social:w.razon_social,nombre_comercial:w.nombre_comercial,email:w.email,telefono:w.telefono,direccion:w.direccion,distrito:w.distrito,provincia:w.provincia,departamento:w.departamento,representante_legal:w.representante_legal,dni_representante:w.dni_representante,tipo_empresa:w.tipo_empresa,categoria_contratista:w.categoria_contratista,especialidades:w.especialidades},datos_consorcio:void 0,empresas_participantes:void 0})),...x.map(w=>({id:w.id+1e3,tipo_entidad:"CONSORCIO",empresa_id:void 0,consorcio_id:w.id,nombre_completo:w.nombre,ruc_principal:w.empresa_lider.ruc,capacidad_contratacion_anual:void 0,experiencia_anos:void 0,estado:w.estado,activo:w.activo,created_at:w.created_at,updated_at:w.updated_at,datos_empresa:void 0,datos_consorcio:{nombre:w.nombre,descripcion:w.descripcion,fecha_constitucion:w.fecha_constitucion,empresa_lider_id:w.empresa_lider_id,empresa_lider_nombre:w.empresa_lider.razon_social,especialidades:w.especialidades},empresas_participantes:w.empresas_participantes.map(i=>({empresa_id:i.empresa.id,empresa_nombre:i.empresa.razon_social,empresa_ruc:i.empresa.ruc,porcentaje_participacion:i.participacion.porcentaje_participacion,es_lider:i.participacion.es_lider,responsabilidades:i.participacion.responsabilidades}))}))],loading:b||f,error:j||n}},$s={REGISTRADA:"Registrada",EN_EJECUCION:"En Ejecución",PARALIZADA:"Paralizada",TERMINADA:"Terminada",LIQUIDADA:"Liquidada",CANCELADA:"Cancelada"},Ks={CARRETERA:"Carretera",EDIFICACION:"Edificación",SANEAMIENTO:"Saneamiento",ELECTRICIDAD:"Electricidad",PUENTE:"Puente",VEREDAS_PISTAS:"Veredas y Pistas",PARQUES_JARDINES:"Parques y Jardines",DRENAJE_PLUVIAL:"Drenaje Pluvial",OTROS:"Otros"},nr={ADMINISTRACION_DIRECTA:"Administración Directa",CONTRATA:"Contrata",ENCARGO:"Encargo",CONVENIO:"Convenio"},la={SUMA_ALZADA:"A Suma Alzada (monto fijo global)",PRECIOS_UNITARIOS:"Por Precios Unitarios (cantidades × precios unitarios)",TARIFAS:"Por Tarifas (tarifa por unidad de tiempo)",PORCENTAJE_MONTO:"Por Porcentaje del monto contratado (% del valor ejecutado)",LLAVE_EN_MANO:"Llave en Mano (Design-Build)"},oa={LEY_30225:"Ley N° 30225 (antes del 22/04/2025)",LEY_32069:"Ley N° 32069 (desde el 22/04/2025)"},lr={LICITACION_PUBLICA:"Licitación Pública",CONCURSO_PUBLICO:"Concurso Público",ADJUDICACION_SIMPLIFICADA:"Adjudicación Simplificada",CONTRATACION_DIRECTA:"Contratación Directa",SUBASTA_INVERSA_ELECTRONICA:"Subasta Inversa Electrónica",COMPARACION_PRECIOS:"Comparación de Precios",SELECCION_CONSULTORES_INDIVIDUALES:"Selección de Consultores Individuales",CATALOGO_ELECTRONICO_ACUERDOS_MARCO:"Catálogo Electrónico de Acuerdos Marco"},or={LICITACION_PUBLICA:"Licitación Pública",CONCURSO_PUBLICO:"Concurso Público",COMPARACION_PRECIOS:"Comparación de Precios",SUBASTA_INVERSA_ELECTRONICA:"Subasta Inversa Electrónica",CONTRATACION_DIRECTA:"Contratación Directa",SELECCION_CONSULTORES_INDIVIDUALES:"Selección de Consultores Individuales",COMPRAS_CENTRALIZADAS:"Compras Centralizadas",COMPRAS_CORPORATIVAS:"Compras Corporativas",COMPRAS_CENTRALIZADAS_EMERGENCIA:"Compras Centralizadas de Emergencia"},cr={SUMA_ALZADA:"El contratista se compromete a ejecutar la obra por un monto fijo e invariable, asumiendo los riesgos de variaciones en costos.",PRECIOS_UNITARIOS:"Se paga según las cantidades realmente ejecutadas multiplicadas por precios unitarios predeterminados.",TARIFAS:"El pago se realiza según una tarifa por unidad de tiempo (hora, día, mes) de servicios prestados.",PORCENTAJE_MONTO:"El pago corresponde a un porcentaje del valor de la obra ejecutada, común en supervisión.",LLAVE_EN_MANO:"El contratista se encarga del diseño y construcción completa, entregando la obra funcionando."},ws={patron:/^N\.º\s+\d{1,3}-\d{4}-MDSM\/GM$/,formato:"N.º XX-YYYY-MDSM/GM",ejemplo:"N.º 01-2025-MDSM/GM"},hs=s=>({id:s.id,numero_contrato:s.codigo||`OBR-${s.id}`,nombre:s.nombre,codigo_interno:s.codigo,entidad_ejecutora_id:s.empresa_id,entidad_supervisora_id:0,monto_ejecucion:s.monto_contractual||0,monto_supervision:s.monto_adicionales||0,monto_total:s.monto_total||0,plazo_ejecucion_dias:s.plazo_contractual||0,numero_valorizaciones:s.plazo_contractual?Math.ceil(s.plazo_contractual/30):0,fecha_inicio:s.fecha_inicio||new Date().toISOString().split("T")[0],fecha_fin_prevista:s.fecha_fin_contractual||new Date().toISOString().split("T")[0],fecha_termino:s.fecha_fin_real,ubicacion:s.ubicacion||"",distrito:s.distrito||"",provincia:s.provincia||"",departamento:s.departamento||"",tipo_obra:s.tipo_obra||"OTROS",modalidad_ejecucion:s.modalidad_ejecucion||"CONTRATA",sistema_contratacion:s.sistema_contratacion||"SUMA_ALZADA",estado:s.estado_obra||"REGISTRADA",descripcion:s.descripcion||"",activo:s.activo,created_at:s.created_at,updated_at:s.updated_at,version:s.version,empresa_contratista:s.cliente||"No especificado",porcentaje_avance:s.porcentaje_avance||0,monto_contrato:s.monto_contractual||s.monto_total||0,estado_obra:s.estado_obra,fecha_fin_contractual:s.fecha_fin_contractual,observaciones:s.observaciones}),dr=s=>({codigo:s.numero_contrato,nombre:s.nombre,descripcion:s.descripcion||"",empresa_id:s.entidad_ejecutora_id,cliente:"",ubicacion:s.ubicacion||"",distrito:s.distrito||"",provincia:s.provincia||"",departamento:s.departamento||"",modalidad_ejecucion:s.modalidad_ejecucion,sistema_contratacion:s.sistema_contratacion,tipo_obra:s.tipo_obra,monto_contractual:s.monto_ejecucion,monto_adicionales:s.monto_supervision,monto_total:s.monto_ejecucion+s.monto_supervision,fecha_inicio:s.fecha_inicio,fecha_fin_contractual:s.fecha_termino,plazo_contractual:s.plazo_ejecucion_dias,estado_obra:"REGISTRADA",observaciones:""}),Ce=s=>s instanceof Error||typeof s=="object"&&s?.message?s.message:typeof s=="string"?s:"Error desconocido en la operación",es=async(s,b={})=>{const j=new AbortController,x=setTimeout(()=>j.abort(),ya);try{const f=await fetch(s,{...b,headers:{...Na,...b.headers},signal:j.signal});if(clearTimeout(x),!f.ok){let l=`Error ${f.status}: ${f.statusText}`;try{const N=await f.json();N.detail?l=N.detail:N.message&&(l=N.message)}catch{}throw new Error(l)}return await f.json()}catch(f){throw clearTimeout(x),f instanceof Error&&f.name==="AbortError"?new Error("La operación tardó demasiado tiempo"):f}},Me=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async r=>{x(!0),n(null);try{const c=new URLSearchParams;r?.search&&c.append("search",r.search),r?.estado&&c.append("estado_obra",r.estado),r?.entidad_ejecutora_id&&c.append("empresa_id",r.entidad_ejecutora_id.toString()),r?.tipo_obra&&c.append("tipo_obra",r.tipo_obra);const p=c.toString()?`${G.obras}?${c.toString()}`:G.obras,h=await es(p),a=Array.isArray(h)?h.map(hs):[];b(a)}catch(c){const p=Ce(c);n(`Error al cargar obras: ${p}`),console.error("Error cargando obras:",c),b([])}finally{x(!1)}},[]),N=o.useCallback(async r=>{x(!0),n(null);try{const c=dr(r.obra),p=await es(G.obras,{method:"POST",body:JSON.stringify(c)}),h=hs(p);return r.plantel_profesional.length>0&&console.warn("Creación de plantel profesional no implementada aún. Endpoints de profesionales pendientes."),await l(),h}catch(c){const p=Ce(c);throw n(`Error al crear obra: ${p}`),console.error("Error creando obra:",c),new Error(p)}finally{x(!1)}},[l]),_=o.useCallback(async(r,c)=>{x(!0),n(null);try{const p={};if(c.numero_contrato!==void 0&&(p.codigo=c.numero_contrato),c.nombre!==void 0&&(p.nombre=c.nombre),c.descripcion!==void 0&&(p.descripcion=c.descripcion),c.entidad_ejecutora_id!==void 0&&(p.empresa_id=c.entidad_ejecutora_id),c.ubicacion!==void 0&&(p.ubicacion=c.ubicacion),c.distrito!==void 0&&(p.distrito=c.distrito),c.provincia!==void 0&&(p.provincia=c.provincia),c.departamento!==void 0&&(p.departamento=c.departamento),c.modalidad_ejecucion!==void 0&&(p.modalidad_ejecucion=c.modalidad_ejecucion),c.sistema_contratacion!==void 0&&(p.sistema_contratacion=c.sistema_contratacion),c.tipo_obra!==void 0&&(p.tipo_obra=c.tipo_obra),c.monto_ejecucion!==void 0&&(p.monto_contractual=c.monto_ejecucion),c.monto_supervision!==void 0&&(p.monto_adicionales=c.monto_supervision),c.fecha_inicio!==void 0&&(p.fecha_inicio=c.fecha_inicio),c.fecha_termino!==void 0&&(p.fecha_fin_contractual=c.fecha_termino),c.plazo_ejecucion_dias!==void 0&&(p.plazo_contractual=c.plazo_ejecucion_dias),c.monto_ejecucion!==void 0||c.monto_supervision!==void 0){const u=c.monto_ejecucion??0,d=c.monto_supervision??0;p.monto_total=u+d}const h=await es(`${G.obras}/${r}`,{method:"PUT",body:JSON.stringify(p)}),a=hs(h);return await l(),a}catch(p){const h=Ce(p);throw n(`Error al actualizar obra: ${h}`),console.error("Error actualizando obra:",p),new Error(h)}finally{x(!1)}},[l]),w=o.useCallback(async r=>{x(!0),n(null);try{return await es(`${G.obras}/${r}`,{method:"DELETE"}),await l(),!0}catch(c){const p=Ce(c);return n(`Error al eliminar obra: ${p}`),console.error("Error eliminando obra:",c),!1}finally{x(!1)}},[l]),i=o.useCallback(async r=>{x(!0),n(null);try{const c=await es(`${G.obras}/${r}`);return hs(c)}catch(c){const p=Ce(c);return n(`Error al obtener obra: ${p}`),console.error("Error obteniendo obra por ID:",c),null}finally{x(!1)}},[]),t=o.useCallback(async()=>{x(!0),n(null);try{const r=await es(`${G.obras}/stats`);return{obras_totales:r.total_obras||0,obras_activas:r.obras_activas||0,obras_terminadas:r.obras_terminadas||0,obras_paralizadas:r.obras_paralizadas||0,monto_total_obras:r.monto_total||0,monto_ejecutado_total:r.monto_ejecutado||0,obras_por_estado:{REGISTRADA:r.obras_por_estado?.REGISTRADA||0,EN_EJECUCION:r.obras_por_estado?.EN_EJECUCION||0,PARALIZADA:r.obras_por_estado?.PARALIZADA||0,TERMINADA:r.obras_por_estado?.TERMINADA||0,LIQUIDADA:r.obras_por_estado?.LIQUIDADA||0,CANCELADA:r.obras_por_estado?.CANCELADA||0},obras_por_tipo:{CARRETERA:r.obras_por_tipo?.CARRETERA||0,EDIFICACION:r.obras_por_tipo?.EDIFICACION||0,SANEAMIENTO:r.obras_por_tipo?.SANEAMIENTO||0,ELECTRICIDAD:r.obras_por_tipo?.ELECTRICIDAD||0,PUENTE:r.obras_por_tipo?.PUENTE||0,VEREDAS_PISTAS:r.obras_por_tipo?.VEREDAS_PISTAS||0,PARQUES_JARDINES:r.obras_por_tipo?.PARQUES_JARDINES||0,DRENAJE_PLUVIAL:r.obras_por_tipo?.DRENAJE_PLUVIAL||0,OTROS:r.obras_por_tipo?.OTROS||0},valorizaciones_pendientes:r.valorizaciones_pendientes||0,valorizaciones_vencidas:r.valorizaciones_vencidas||0,profesionales_con_conflictos:r.profesionales_con_conflictos||0,top_ejecutoras:r.top_ejecutoras||[]}}catch(r){const c=Ce(r);return n(`Error al obtener estadísticas: ${c}`),console.error("Error obteniendo estadísticas:",r),{obras_totales:0,obras_activas:0,obras_terminadas:0,obras_paralizadas:0,monto_total_obras:0,monto_ejecutado_total:0,obras_por_estado:{REGISTRADA:0,EN_EJECUCION:0,PARALIZADA:0,TERMINADA:0,LIQUIDADA:0,CANCELADA:0},obras_por_tipo:{CARRETERA:0,EDIFICACION:0,SANEAMIENTO:0,ELECTRICIDAD:0,PUENTE:0,VEREDAS_PISTAS:0,PARQUES_JARDINES:0,DRENAJE_PLUVIAL:0,OTROS:0},valorizaciones_pendientes:0,valorizaciones_vencidas:0,profesionales_con_conflictos:0,top_ejecutoras:[]}}finally{x(!1)}},[]);return o.useEffect(()=>{l()},[l]),{obras:s,loading:j,error:f,cargarObras:l,obtenerObras:l,crearObra:N,actualizarObra:_,eliminarObra:w,obtenerObraPorId:i,obtenerEstadisticas:t,estadisticasObras:t,obtenerObraPorIdSync:r=>s.find(c=>c.id===r)||null}},wa=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async w=>{x(!0),n(null);try{console.warn(`Carga de profesionales para obra ${w} no implementada aún. Endpoints pendientes.`),b([])}catch(i){n("Error al cargar profesionales"),console.error(i)}finally{x(!1)}},[]),N=o.useCallback(async(w,i)=>{x(!0),n(null);try{return console.warn(`Agregar profesional a obra ${w} no implementado aún. Endpoints pendientes.`),null}catch(t){const r=Ce(t);throw n(`Error al agregar profesional: ${r}`),new Error(r)}finally{x(!1)}},[]),_=o.useCallback(async(w,i,t,r)=>(console.warn(`Verificación de disponibilidad para ${w} no implementada aún. Endpoints pendientes.`),{disponible:!0,conflictos:[]}),[]);return{profesionales:s,loading:j,error:f,cargarProfesionalesPorObra:l,agregarProfesional:N,verificarDisponibilidad:_}},mr=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async()=>{x(!0),n(null);try{console.warn("Carga de profesiones no implementada aún. Endpoints pendientes."),b([])}catch(N){const _=Ce(N);n(`Error al cargar profesiones: ${_}`)}finally{x(!1)}},[]);return o.useEffect(()=>{l()},[l]),{profesiones:s,loading:j,error:f,cargarProfesiones:l}},Ea=()=>{const s=o.useCallback(l=>l?ws.patron.test(l)?null:{campo:"numero_contrato",mensaje:`El formato debe ser: ${ws.formato}`,codigo:"FORMATO_INVALIDO"}:{campo:"numero_contrato",mensaje:"El número de contrato es obligatorio"},[]),b=o.useCallback((l,N)=>{const _=[];return l<=0&&_.push({campo:"monto_ejecucion",mensaje:"El monto de ejecución debe ser mayor a cero"}),N<0&&_.push({campo:"monto_supervision",mensaje:"El monto de supervisión no puede ser negativo"}),N>l*.2&&_.push({campo:"monto_supervision",mensaje:"El monto de supervisión no debería exceder el 20% del monto de ejecución"}),_},[]),j=o.useCallback((l,N,_)=>{const w=[],i=new Date(l),t=new Date;if(t.setHours(0,0,0,0),i<t&&w.push({campo:"fecha_inicio",mensaje:"La fecha de inicio no puede ser anterior a hoy"}),N<=0&&w.push({campo:"plazo_ejecucion_dias",mensaje:"El plazo de ejecución debe ser mayor a cero días"}),N>1095&&w.push({campo:"plazo_ejecucion_dias",mensaje:"El plazo de ejecución no debería exceder los 3 años (1095 días)"}),_){const r=new Date(_);r<=i&&w.push({campo:"fecha_termino",mensaje:"La fecha de término debe ser posterior a la fecha de inicio"});const c=new Date(i);c.setFullYear(c.getFullYear()+5),r>c&&w.push({campo:"fecha_termino",mensaje:"La fecha de término no debería exceder los 5 años desde la fecha de inicio"})}return w},[]),x=o.useCallback((l,N)=>{const _=[];return l||_.push({campo:"entidad_ejecutora_id",mensaje:"Debe seleccionar una entidad ejecutora"}),N||_.push({campo:"entidad_supervisora_id",mensaje:"Debe seleccionar una entidad supervisora"}),l&&N&&l===N&&_.push({campo:"entidad_supervisora_id",mensaje:"La entidad ejecutora y supervisora deben ser diferentes"}),_},[]),f=o.useCallback(l=>{const N=[];return(l<=0||l>100)&&N.push({campo:"porcentaje_participacion",mensaje:"El porcentaje debe estar entre 1 y 100"}),N},[]),n=o.useCallback(l=>{const N=[],_=s(l.numero_contrato);_&&N.push(_),l.nombre?.trim()||N.push({campo:"nombre",mensaje:"El nombre de la obra es obligatorio"});const w=b(l.monto_ejecucion,l.monto_supervision);N.push(...w);const i=j(l.fecha_inicio,l.plazo_ejecucion_dias,l.fecha_termino);N.push(...i);const t=x(l.entidad_ejecutora_id,l.entidad_supervisora_id);return N.push(...t),{valido:N.length===0,errores:N}},[s,b,j,x]);return{validarNumeroContrato:s,validarMontos:b,validarFechas:j,validarEntidadesContratistas:x,validarPorcentajeProfesional:f,validarObraForm:n}},xr=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=o.useCallback(async N=>{x(!0),n(null);try{console.warn(`Carga de valorizaciones para obra ${N} no implementada aún. Endpoints pendientes.`),b([])}catch(_){const w=Ce(_);n(`Error al cargar valorizaciones: ${w}`)}finally{x(!1)}},[]);return{valorizaciones:s,loading:j,error:f,cargarValorizacionesPorObra:l}},gs=s=>({...s,estado:s.estado_valorizacion}),ca=s=>({obra_id:s.obra_id,numero_valorizacion:s.numero_valorizacion,periodo:s.periodo,fecha_inicio:s.fecha_inicio,fecha_fin:s.fecha_fin,fecha_presentacion:s.fecha_presentacion,tipo_valorizacion:s.tipo_valorizacion,monto_ejecutado:s.monto_ejecutado,monto_materiales:s.monto_materiales,monto_mano_obra:s.monto_mano_obra,monto_equipos:s.monto_equipos,monto_subcontratos:s.monto_subcontratos,monto_gastos_generales:s.monto_gastos_generales,monto_utilidad:s.monto_utilidad,observaciones:s.observaciones,archivos_adjuntos:s.archivos_adjuntos,metrado_ejecutado:s.metrado_ejecutado,partidas_ejecutadas:s.partidas_ejecutadas,estado_valorizacion:"BORRADOR",activo:!0}),zs=s=>{const b=s.monto_ejecutado||0,j=s.monto_materiales||0,x=s.monto_mano_obra||0,f=s.monto_equipos||0,n=s.monto_subcontratos||0,l=s.monto_gastos_generales||0,N=s.monto_utilidad||0,_=b>0?b:j+x+f+n+l+N,w=_*.18,i=_+w;return{...s,monto_ejecutado:_,igv:w,monto_total:i}},Ls=s=>{if(!s||!/^\d{4}-\d{2}$/.test(s))return!1;const[j,x]=s.split("-").map(Number);return j>=2020&&j<=2030&&x>=1&&x<=12},bs=(s,b)=>!s||!b?!1:new Date(s)<=new Date(b),rs=()=>{const[s,b]=o.useState([]),[j,x]=o.useState(!1),[f,n]=o.useState(null),l=async(a,u={})=>{const d=new AbortController,A=setTimeout(()=>d.abort(),ya);try{const y=await fetch(a,{...u,headers:{...Na,...u.headers},signal:d.signal});if(clearTimeout(A),!y.ok){const k=await y.json().catch(()=>({}));throw new Error(k.detail||k.message||`HTTP ${y.status}: ${y.statusText}`)}return await y.json()}catch(y){throw clearTimeout(A),y instanceof Error&&y.name==="AbortError"?new Error("Request timeout - El servidor tardó demasiado en responder"):y}},N=o.useCallback(async a=>{x(!0),n(null);try{const u=new URLSearchParams;a?.obra_id&&u.append("obra_id",a.obra_id.toString()),a?.estado&&u.append("estado",a.estado),a?.fecha_desde&&u.append("fecha_desde",a.fecha_desde),a?.fecha_hasta&&u.append("fecha_hasta",a.fecha_hasta),a?.periodo&&u.append("periodo",a.periodo),a?.tipo_valorizacion&&u.append("tipo_valorizacion",a.tipo_valorizacion),a?.solo_con_atraso&&u.append("solo_con_atraso","true");const d=u.toString(),A=d?`${G.valorizaciones}?${d}`:G.valorizaciones,k=(await l(A)).map(gs);return b(k),k}catch(u){const d=u instanceof Error?u.message:"Error al cargar valorizaciones";throw n(d),console.error("Error cargando valorizaciones:",u),new Error(d)}finally{x(!1)}},[]),_=o.useCallback(async a=>{x(!0),n(null);try{if(!a.obra_id)throw new Error("ID de obra es requerido");if(!Ls(a.periodo))throw new Error("Período debe estar en formato YYYY-MM");if(!bs(a.fecha_inicio,a.fecha_fin))throw new Error("Las fechas no son válidas");const u=zs(a),d=ca(u),A=await l(G.valorizaciones,{method:"POST",body:JSON.stringify(d)}),y=gs(A);return b(k=>[y,...k]),y}catch(u){const d=u instanceof Error?u.message:"Error al crear valorización";throw n(d),console.error("Error creando valorización:",u),new Error(d)}finally{x(!1)}},[]),w=o.useCallback(async(a,u)=>{x(!0),n(null);try{if(!a)throw new Error("ID de valorización es requerido");const d=s.find(P=>P.id===a);if(!d)throw new Error("Valorización no encontrada");const A={...d,...u};if(u.periodo&&!Ls(u.periodo))throw new Error("Período debe estar en formato YYYY-MM");if(u.fecha_inicio||u.fecha_fin){const P=u.fecha_inicio||d.fecha_inicio,M=u.fecha_fin||d.fecha_fin;if(!bs(P,M))throw new Error("Las fechas no son válidas")}const y=["monto_ejecutado","monto_materiales","monto_mano_obra","monto_equipos","monto_subcontratos","monto_gastos_generales","monto_utilidad"].some(P=>P in u);let k=A;y&&(k=zs(A));const O=ca(k),D=await l(`${G.valorizaciones}/${a}`,{method:"PUT",body:JSON.stringify(O)}),C=gs(D);return b(P=>P.map(M=>M.id===a?C:M)),C}catch(d){const A=d instanceof Error?d.message:"Error al actualizar valorización";throw n(A),console.error("Error actualizando valorización:",d),new Error(A)}finally{x(!1)}},[s]),i=o.useCallback(async a=>{x(!0),n(null);try{if(!a)throw new Error("ID de valorización es requerido");return await l(`${G.valorizaciones}/${a}`,{method:"DELETE"}),b(u=>u.filter(d=>d.id!==a)),!0}catch(u){const d=u instanceof Error?u.message:"Error al eliminar valorización";throw n(d),console.error("Error eliminando valorización:",u),new Error(d)}finally{x(!1)}},[]),t=o.useCallback(async a=>{x(!0),n(null);try{if(!a)throw new Error("ID de valorización es requerido");const u=s.find(y=>y.id===a);if(u)return x(!1),u;const d=await l(`${G.valorizaciones}/${a}`),A=gs(d);return b(y=>y.find(O=>O.id===a)?y:[A,...y]),A}catch(u){const d=u instanceof Error?u.message:"Error al obtener valorización";throw n(d),console.error("Error obteniendo valorización:",u),new Error(d)}finally{x(!1)}},[s]),r=o.useCallback(async()=>{x(!0),n(null);try{const a=await l(`${G.valorizaciones}/stats`);return{total_valorizaciones:a.total_valorizaciones||0,monto_total_valorizado:a.monto_total_valorizado||0,monto_total_pagado:a.monto_total_pagado||0,por_estado:a.por_estado||{},por_mes:a.por_mes||[],promedio_dias_aprobacion:a.promedio_dias_aprobacion||0,con_atraso:a.con_atraso||0}}catch(a){const u=a instanceof Error?a.message:"Error al obtener estadísticas";throw n(u),console.error("Error obteniendo estadísticas:",a),new Error(u)}finally{x(!1)}},[]),c=o.useCallback(a=>zs(a),[]),p=o.useCallback(a=>Ls(a),[]),h=o.useMemo(()=>{if(!s.length)return{total:0,montoTotal:0,porEstado:{},promedioDias:0};const a=s.length,u=s.reduce((k,O)=>k+(O.monto_total||0),0),d=s.reduce((k,O)=>{const D=O.estado||"BORRADOR";return k[D]=(k[D]||0)+1,k},{}),A=s.filter(k=>k.fecha_aprobacion&&k.fecha_presentacion);let y=0;return A.length>0&&(y=A.reduce((O,D)=>{const C=new Date(D.fecha_presentacion).getTime(),P=new Date(D.fecha_aprobacion).getTime();return O+Math.ceil((P-C)/864e5)},0)/A.length),{total:a,montoTotal:u,porEstado:d,promedioDias:y}},[s]);return{valorizaciones:s,loading:j,error:f,cargarValorizaciones:N,obtenerValorizaciones:N,crearValorizacion:_,actualizarValorizacion:w,eliminarValorizacion:i,obtenerValorizacionPorId:t,obtenerEstadisticas:r,obtenerEstadisticasValorizaciones:r,calcularTotales:c,validarPeriodo:p,estadisticasLocales:h,validarFechas:(a,u)=>bs(a,u),valorizacionesEjecucion:s,valorizacionesSupervision:s.filter(a=>a.tipo_valorizacion==="SUPERVISION"),estadisticasDashboard:{...h,totalValorizado:h.montoTotal,aprobadas:h.porEstado.APROBADA||0,pendientes:h.porEstado.PRESENTADA||0,pagadas:h.porEstado.PAGADA||0,conAtraso:0},cambiarEstadoValorizacion:async(a,u)=>await w(a,{estado_valorizacion:u}),formatearMoneda:a=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),partidas:[],cargarPartidasPorObra:async a=>{console.warn(`Carga de partidas para obra ${a} no implementada aún`)},crearValorizacionEjecucion:_,crearValorizacionSupervision:_,calcularMontos:c,validarValorizacion:a=>a.obra_id?a.periodo?!a.fecha_inicio||!a.fecha_fin?{valido:!1,errores:["Fechas requeridas"]}:bs(a.fecha_inicio,a.fecha_fin)?{valido:!0,errores:[]}:{valido:!1,errores:["Fechas inválidas"]}:{valido:!1,errores:["Período requerido"]}:{valido:!1,errores:["Obra requerida"]}}},ur=()=>{const[s,b]=o.useState(new Date),[j,x]=o.useState("month"),{obtenerEstadisticas:f}=Rs(),{obras:n,obtenerObras:l}=Me(),{valorizaciones:N,obtenerValorizaciones:_}=rs(),[w,i]=o.useState([]),[t,r]=o.useState(null),[c,p]=o.useState(!0),[h]=o.useState([{id:"obras-activas",title:"Obras Activas",value:24,previousValue:22,change:9.09,changeType:"increase",icon:"Building2",color:"bg-gradient-to-r from-blue-500 to-blue-600",format:"number",sparklineData:[18,19,22,21,23,24,24]},{id:"inversion-total",title:"Inversión Total",value:285e4,previousValue:25e5,change:14,changeType:"increase",icon:"DollarSign",color:"bg-gradient-to-r from-emerald-500 to-emerald-600",format:"currency",sparklineData:[22e5,23e5,24e5,235e4,26e5,28e5,285e4]},{id:"valorizaciones-mes",title:"Valorizaciones del Mes",value:156,previousValue:142,change:9.86,changeType:"increase",icon:"FileText",color:"bg-gradient-to-r from-purple-500 to-purple-600",format:"number",sparklineData:[120,125,135,140,145,150,156]},{id:"eficiencia-general",title:"Eficiencia General",value:87,previousValue:82,change:6.1,changeType:"increase",icon:"TrendingUp",color:"bg-gradient-to-r from-orange-500 to-orange-600",format:"percentage",sparklineData:[75,78,80,82,85,86,87]},{id:"obras-completadas",title:"Obras Completadas",value:8,previousValue:6,change:33.33,changeType:"increase",icon:"CheckCircle",color:"bg-gradient-to-r from-teal-500 to-teal-600",format:"number",sparklineData:[4,4,5,6,6,7,8]},{id:"dias-promedio",title:"Días Promedio Valorización",value:12,previousValue:15,change:-20,changeType:"increase",icon:"Clock",color:"bg-gradient-to-r from-indigo-500 to-indigo-600",format:"number",sparklineData:[18,16,15,14,13,13,12]}]);o.useEffect(()=>{(async()=>{try{p(!0),await Promise.all([l(),_()]);const F=await f();r(F)}catch(F){console.error("Error cargando datos del dashboard:",F)}finally{p(!1)}})()},[]);const a=n.map(I=>({id:I.id?.toString()||"",nombre:I.nombre,contratista:I.empresa_contratista||"No especificado",avance:I.porcentaje_avance||0,presupuesto:Number(I.monto_contrato)||0,estado:I.estado_obra==="EJECUCION"?"En ejecución":I.estado_obra==="PARALIZADA"?"Pausada":I.estado_obra==="TERMINADA"?"Finalizada":I.estado_obra==="OBSERVADA"?"Retrasada":"En ejecución",fechaInicio:I.fecha_inicio?.split("T")[0]||new Date().toISOString().split("T")[0],fechaVencimiento:I.fecha_fin_prevista?.split("T")[0]||new Date().toISOString().split("T")[0],distrito:I.ubicacion||"No especificado",categoria:I.tipo_obra||"General"})),[u]=o.useState([{id:"1",nombre:"Construcción Centro de Salud Huaripampa",contratista:"Constructora GEMSA S.A.C.",avance:75,presupuesto:85e4,estado:"En ejecución",fechaInicio:"2024-01-15",fechaVencimiento:"2024-08-30",distrito:"C.P. Huaripampa",categoria:"Salud"},{id:"2",nombre:"Mejoramiento Carretera San Marcos - Challhuayaco",contratista:"Consorcio Vial Norte",avance:45,presupuesto:12e5,estado:"En ejecución",fechaInicio:"2024-03-01",fechaVencimiento:"2024-12-15",distrito:"C.P. Challhuayaco",categoria:"Vías"},{id:"3",nombre:"Parque Recreacional Barrio San Francisco",contratista:"Green Spaces S.A.C.",avance:90,presupuesto:45e4,estado:"En ejecución",fechaInicio:"2024-02-10",fechaVencimiento:"2024-07-20",distrito:"Zona Urbana - B. San Francisco",categoria:"Recreación"},{id:"4",nombre:"Remodelación Mercado Central San Marcos",contratista:"Constructora ABC Ltda.",avance:30,presupuesto:68e4,estado:"Retrasada",fechaInicio:"2024-04-05",fechaVencimiento:"2024-10-10",distrito:"Zona Urbana - Centro",categoria:"Comercio"},{id:"5",nombre:"Complejo Deportivo Gaucho",contratista:"Sports Construcciones E.I.R.L.",avance:60,presupuesto:92e4,estado:"En ejecución",fechaInicio:"2024-01-20",fechaVencimiento:"2024-09-15",distrito:"C.P. Gaucho",categoria:"Deporte"},{id:"6",nombre:"Sistema de Agua Potable Carhuayoc",contratista:"Consorcio Hidráulico San Marcos",avance:55,presupuesto:11e5,estado:"En ejecución",fechaInicio:"2024-02-20",fechaVencimiento:"2024-11-30",distrito:"C.P. Carhuayoc",categoria:"Saneamiento"},{id:"7",nombre:"I.E. Primaria Pujun",contratista:"Constructora Educativa SAC",avance:80,presupuesto:75e4,estado:"En ejecución",fechaInicio:"2024-01-10",fechaVencimiento:"2024-07-15",distrito:"Caserío Pujun",categoria:"Educación"},{id:"8",nombre:"Puente Peatonal Barrio Santa Rosa",contratista:"Ingeniería Civil Norte",avance:40,presupuesto:32e4,estado:"En ejecución",fechaInicio:"2024-03-15",fechaVencimiento:"2024-09-20",distrito:"Zona Urbana - B. Santa Rosa",categoria:"Vías"},{id:"9",nombre:"Centro Comunal Huanico",contratista:"Constructora GEMSA S.A.C.",avance:65,presupuesto:48e4,estado:"En ejecución",fechaInicio:"2024-02-05",fechaVencimiento:"2024-08-10",distrito:"Caserío Huanico",categoria:"Social"},{id:"10",nombre:"Mejoramiento Plaza de Armas San Marcos",contratista:"Green Spaces S.A.C.",avance:95,presupuesto:68e4,estado:"En ejecución",fechaInicio:"2024-01-05",fechaVencimiento:"2024-06-30",distrito:"Zona Urbana - Centro",categoria:"Recreación"}]),d=a.length>0?a:u;o.useEffect(()=>{if(!c&&n.length>0){const I=n.filter(W=>W.estado_obra==="EJECUCION"||W.estado_obra==="PENDIENTE").length,F=n.reduce((W,J)=>W+(Number(J.monto_contrato)||0),0),L=N.filter(W=>{const J=new Date(W.created_at),_e=new Date;return J.getMonth()===_e.getMonth()&&J.getFullYear()===_e.getFullYear()}).length,U=n.filter(W=>W.estado_obra!=="OBSERVADA").length,q=n.length>0?Math.round(U/n.length*100):0,ee=n.filter(W=>W.estado_obra==="TERMINADA").length;i([{id:"obras-activas",title:"Obras Activas",value:I,previousValue:h[0].previousValue,change:(I-Number(h[0].previousValue))/Number(h[0].previousValue)*100,changeType:I>=Number(h[0].previousValue)?"increase":"decrease",icon:"Building2",color:"bg-gradient-to-r from-blue-500 to-blue-600",format:"number",sparklineData:h[0].sparklineData},{id:"inversion-total",title:"Inversión Total",value:F,previousValue:h[1].previousValue,change:(F-Number(h[1].previousValue))/Number(h[1].previousValue)*100,changeType:F>=Number(h[1].previousValue)?"increase":"decrease",icon:"DollarSign",color:"bg-gradient-to-r from-emerald-500 to-emerald-600",format:"currency",sparklineData:h[1].sparklineData},{id:"valorizaciones-mes",title:"Valorizaciones del Mes",value:L,previousValue:h[2].previousValue,change:(L-Number(h[2].previousValue))/Number(h[2].previousValue)*100,changeType:L>=Number(h[2].previousValue)?"increase":"decrease",icon:"FileText",color:"bg-gradient-to-r from-purple-500 to-purple-600",format:"number",sparklineData:h[2].sparklineData},{id:"eficiencia-general",title:"Eficiencia General",value:q,previousValue:h[3].previousValue,change:(q-Number(h[3].previousValue))/Number(h[3].previousValue)*100,changeType:q>=Number(h[3].previousValue)?"increase":"decrease",icon:"TrendingUp",color:"bg-gradient-to-r from-orange-500 to-orange-600",format:"percentage",sparklineData:h[3].sparklineData},{id:"obras-completadas",title:"Obras Completadas",value:ee,previousValue:h[4].previousValue,change:(ee-Number(h[4].previousValue))/Number(h[4].previousValue)*100,changeType:ee>=Number(h[4].previousValue)?"increase":"decrease",icon:"CheckCircle",color:"bg-gradient-to-r from-teal-500 to-teal-600",format:"number",sparklineData:h[4].sparklineData},{id:"dias-promedio",title:"Días Promedio Valorización",value:12,previousValue:h[5].previousValue,change:-20,changeType:"increase",icon:"Clock",color:"bg-gradient-to-r from-indigo-500 to-indigo-600",format:"number",sparklineData:h[5].sparklineData}])}},[n,N,c]);const[A,y]=o.useState([{id:"1",type:"critical",title:"Obra con retraso crítico",message:"Remodelación Mercado Central lleva 15 días de retraso",timestamp:new Date(Date.now()-7200*1e3),read:!1},{id:"2",type:"warning",title:"Valorización pendiente",message:"3 valorizaciones vencen en las próximas 48 horas",timestamp:new Date(Date.now()-14400*1e3),read:!1},{id:"3",type:"info",title:"Nueva obra registrada",message:'Se registró la obra "Puente Peatonal Surquillo"',timestamp:new Date(Date.now()-360*60*1e3),read:!0},{id:"4",type:"warning",title:"Presupuesto alcanzando límite",message:"Obra Centro de Salud San Juan al 95% del presupuesto",timestamp:new Date(Date.now()-1440*60*1e3),read:!1}]),[k]=o.useState([{id:"1",nombre:"Constructora GEMSA S.A.C.",obrasCompletadas:12,eficiencia:94,valorTotal:28e5,rank:1,change:0},{id:"2",nombre:"Consorcio Vial Norte",obrasCompletadas:8,eficiencia:91,valorTotal:22e5,rank:2,change:1},{id:"3",nombre:"Sports Construcciones E.I.R.L.",obrasCompletadas:6,eficiencia:88,valorTotal:185e4,rank:3,change:-1},{id:"4",nombre:"Green Spaces S.A.C.",obrasCompletadas:5,eficiencia:86,valorTotal:12e5,rank:4,change:0},{id:"5",nombre:"Constructora ABC Ltda.",obrasCompletadas:4,eficiencia:72,valorTotal:98e4,rank:5,change:0}]),[O]=o.useState([{id:"1",obra:"Centro de Salud San Juan",contratista:"Constructora GEMSA S.A.C.",monto:125e3,fechaVencimiento:new Date(Date.now()+2880*60*1e3),diasRestantes:2,estado:"Próxima"},{id:"2",obra:"Mejoramiento Av. Los Proceres",contratista:"Consorcio Vial Norte",monto:18e4,fechaVencimiento:new Date(Date.now()+7200*60*1e3),diasRestantes:5,estado:"Próxima"},{id:"3",obra:"Parque Recreacional Villa El Salvador",contratista:"Green Spaces S.A.C.",monto:45e3,fechaVencimiento:new Date(Date.now()+1440*60*1e3),diasRestantes:1,estado:"Crítica"},{id:"4",obra:"Complejo Deportivo Ate",contratista:"Sports Construcciones E.I.R.L.",monto:92e3,fechaVencimiento:new Date(Date.now()-1440*60*1e3),diasRestantes:-1,estado:"Vencida"}]),[D]=o.useState([{mes:"Ene",presupuestado:22e5,ejecutado:21e5,valorizacion:195e4},{mes:"Feb",presupuestado:24e5,ejecutado:235e4,valorizacion:22e5},{mes:"Mar",presupuestado:26e5,ejecutado:258e4,valorizacion:245e4},{mes:"Abr",presupuestado:27e5,ejecutado:265e4,valorizacion:258e4},{mes:"May",presupuestado:28e5,ejecutado:278e4,valorizacion:272e4},{mes:"Jun",presupuestado:285e4,ejecutado:283e4,valorizacion:28e5},{mes:"Jul",presupuestado:285e4,ejecutado:285e4,valorizacion:285e4}]),[C]=o.useState([{categoria:"Salud",valor:125e4,porcentaje:35,obras:8},{categoria:"Vías",valor:98e4,porcentaje:28,obras:6},{categoria:"Educación",valor:65e4,porcentaje:18,obras:4},{categoria:"Recreación",valor:42e4,porcentaje:12,obras:3},{categoria:"Comercio",valor:25e4,porcentaje:7,obras:3}]);o.useEffect(()=>{const I=setInterval(()=>{b(new Date),c||(l(),_())},3e4);return()=>clearInterval(I)},[c,l,_]);const P=o.useCallback((I=5)=>d.sort((F,L)=>L.avance-F.avance).slice(0,I),[d]),M=o.useCallback(I=>I?A.filter(F=>F.type===I):A,[A]),v=o.useCallback(()=>A.filter(I=>!I.read).length,[A]),R=o.useCallback(I=>{y(F=>F.map(L=>L.id===I?{...L,read:!0}:L))},[]),E=o.useCallback(()=>{const I=d.filter(U=>U.estado!=="Retrasada").length,F=d.length;if(F===0)return 0;const L=I/F*100;return Math.round(L)},[d]),m=o.useCallback(()=>{const I=d.reduce((F,L)=>{const U=L.distrito;return F[U]||(F[U]={count:0,investment:0,efficiency:0,tipo:""}),U.includes("C.P.")?F[U].tipo="Centro Poblado":U.includes("Caserío")?F[U].tipo="Caserío":U.includes("Zona Urbana")&&(F[U].tipo="Zona Urbana"),F[U].count+=1,F[U].investment+=L.presupuesto,F[U].efficiency+=L.avance,F},{});return Object.entries(I).map(([F,L])=>({distrito:F,obras:L.count,inversion:L.investment,eficiencia:Math.round(L.efficiency/L.count),tipo:L.tipo}))},[d]),g=o.useCallback(I=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0,maximumFractionDigits:0}).format(I),[]),T=o.useCallback(I=>new Intl.NumberFormat("es-PE").format(I),[]),V=o.useCallback(()=>d.map(I=>({id:I.id,nombre:I.nombre,fechaInicio:new Date(I.fechaInicio),fechaVencimiento:new Date(I.fechaVencimiento),avance:I.avance,estado:I.estado,contratista:I.contratista})).sort((I,F)=>I.fechaVencimiento.getTime()-F.fechaVencimiento.getTime()),[d]);return{lastUpdate:s,currentPeriod:j,setCurrentPeriod:x,metrics:w.length>0?w:h,obras:d,alerts:A,contratistasRanking:k,valorizacionesProximas:(()=>{const I=d.filter(F=>F.estado==="En ejecución").slice(0,6).map((F,L)=>{const U=[2,5,1,-1,7,3][L]||1,q=new Date;return q.setDate(q.getDate()+U),{id:F.id,obra:F.nombre,contratista:F.contratista,monto:Math.round(F.presupuesto*.15),fechaVencimiento:q,diasRestantes:U,estado:U<0?"Vencida":U<=1?"Crítica":"Próxima"}});return I.length>0?I:O})(),inversionTiempo:(()=>{if(N.length===0)return D;const I=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dec"],F=[];for(let L=6;L>=0;L--){const U=new Date;U.setMonth(U.getMonth()-L);const q=U.getMonth(),ee=U.getFullYear(),J=N.filter(ze=>{const Z=new Date(ze.created_at);return Z.getMonth()===q&&Z.getFullYear()===ee}).reduce((ze,Z)=>ze+(Number(Z.monto_total)||0),0),_e=J*1.1,Ye=J*1.05;F.push({mes:I[q],presupuestado:Math.round(_e),ejecutado:Math.round(Ye),valorizacion:Math.round(J)})}return F.length>0?F:D})(),distributionData:(()=>{if(d.length===0)return C;const I=d.reduce((L,U)=>{const q=U.categoria;return L[q]||(L[q]={valor:0,obras:0}),L[q].valor+=U.presupuesto,L[q].obras+=1,L},{}),F=Object.values(I).reduce((L,U)=>L+U.valor,0);return Object.entries(I).map(([L,U])=>({categoria:L,valor:U.valor,porcentaje:Math.round(U.valor/F*100),obras:U.obras})).sort((L,U)=>U.valor-L.valor).slice(0,5)})(),getObrasTopRanking:P,getAlertsByType:M,getUnreadAlertsCount:v,markAlertAsRead:R,getEfficiencyGaugeData:E,getDistrictHeatMapData:m,formatCurrency:g,formatNumber:T,getTimelineData:V,totalInversion:(w.length>0?w:h).find(I=>I.id==="inversion-total")?.value||0,obrasActivas:(w.length>0?w:h).find(I=>I.id==="obras-activas")?.value||0,loading:c,eficienciaGeneral:E(),alertasCriticas:M("critical").length,alertasNoLeidas:v()}},pr=()=>{const[s,b]=o.useState(!1),[j,x]=o.useState(!1),{lastUpdate:f,currentPeriod:n,setCurrentPeriod:l,metrics:N,alerts:_,contratistasRanking:w,valorizacionesProximas:i,inversionTiempo:t,distributionData:r,markAlertAsRead:c,getDistrictHeatMapData:p,formatCurrency:h,getTimelineData:a,totalInversion:u,obrasActivas:d,eficienciaGeneral:A,alertasCriticas:y}=ur(),k=async()=>{x(!0),await new Promise(R=>setTimeout(R,1500)),x(!1)},O=()=>{b(!s),document.documentElement.classList.toggle("dark")},D=a(),C=p(),P=["#8B5CF6","#06B6D4","#10B981","#F59E0B","#EF4444"],M=()=>{const R=new Date().getHours();return R<12?"Buenos días":R<18?"Buenas tardes":"Buenas noches"},v=`min-h-screen transition-colors duration-300 ${s?"bg-gray-900 text-white":"bg-gradient-to-br from-blue-50 via-white to-purple-50"}`;return e.jsx("div",{className:v,children:e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 opacity-10 animate-pulse"}),e.jsxs("div",{className:"relative p-8 rounded-3xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S.h1,{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},children:[M(),", Administrador"]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:new Date().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:["Última actualización: ",f.toLocaleTimeString("es-ES")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-1 p-1 bg-gray-100 rounded-lg",children:["today","week","month","year"].map(R=>e.jsxs("button",{onClick:()=>l(R),className:`px-3 py-2 text-sm font-medium rounded-md transition-all ${n===R?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[R==="today"&&"Hoy",R==="week"&&"Semana",R==="month"&&"Mes",R==="year"&&"Año"]},R))}),e.jsx(S.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:k,disabled:j,className:"p-3 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:e.jsx(Qa,{className:`w-5 h-5 ${j?"animate-spin":""}`})}),e.jsx(S.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:O,className:"p-3 bg-gray-200 text-gray-700 rounded-xl shadow-lg hover:bg-gray-300 transition-colors",children:s?e.jsx(et,{className:"w-5 h-5"}):e.jsx(st,{className:"w-5 h-5"})})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx(at,{className:"w-5 h-5 text-blue-600 mx-auto mb-1"}),e.jsxs("div",{className:"text-xl font-bold text-blue-600",children:[A,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Eficiencia"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx(Je,{className:"w-5 h-5 text-purple-600 mx-auto mb-1"}),e.jsx("div",{className:"text-xl font-bold text-purple-600",children:d}),e.jsx("div",{className:"text-xs text-gray-600",children:"Obras Activas"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(ce,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:h(Number(u)).replace("PEN","").trim()}),e.jsx("div",{className:"text-xs text-gray-600",children:"Inversión Total"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(As,{className:"w-5 h-5 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-xl font-bold text-red-600",children:y}),e.jsx("div",{className:"text-xs text-gray-600",children:"Alertas Críticas"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:N.map((R,E)=>e.jsx(Kt,{metric:R,index:E},R.id))}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"xl:col-span-2 p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Evolución de Inversión"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Presupuestado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),e.jsx("span",{children:"Ejecutado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Valorizado"})]})]})]}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Mt,{data:t,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorPresupuestado",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"colorEjecutado",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8B5CF6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8B5CF6",stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"colorValorizacion",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:.1})]})]}),e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(Be,{dataKey:"mes",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#6B7280"}}),e.jsx(Re,{axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#6B7280"},tickFormatter:R=>`${(R/1e6).toFixed(1)}M`}),e.jsx(he,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"12px",color:"#F9FAFB"},formatter:R=>[h(Number(R)),""]}),e.jsx(fs,{type:"monotone",dataKey:"presupuestado",stroke:"#3B82F6",strokeWidth:3,fillOpacity:1,fill:"url(#colorPresupuestado)"}),e.jsx(fs,{type:"monotone",dataKey:"ejecutado",stroke:"#8B5CF6",strokeWidth:3,fillOpacity:1,fill:"url(#colorEjecutado)"}),e.jsx(fs,{type:"monotone",dataKey:"valorizacion",stroke:"#10B981",strokeWidth:3,fillOpacity:1,fill:"url(#colorValorizacion)"})]})})})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:e.jsx(Xt,{value:A,title:"Eficiencia General",subtitle:"Obras en tiempo vs total",size:"md",animated:!0})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8},className:"p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Distribución por Categoría"}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Ps,{children:[e.jsx(Ds,{data:r,cx:"50%",cy:"50%",outerRadius:100,dataKey:"valor",label:({categoria:R,porcentaje:E})=>`${R} ${E}%`,labelLine:!1,children:r.map((R,E)=>e.jsx(ds,{fill:P[E%P.length]},`cell-${E}`))}),e.jsx(he,{formatter:R=>[h(Number(R)),"Inversión"]})]})})})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.9},className:"p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Top 5 Contratistas"}),e.jsx("div",{className:"space-y-4",children:w.map((R,E)=>e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.9+E*.1},className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${E===0?"bg-yellow-500":E===1?"bg-gray-400":E===2?"bg-amber-600":"bg-blue-500"}`,children:E+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:R.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:[R.obrasCompletadas," obras • ",R.eficiencia,"% eficiencia"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:h(R.valorTotal)}),e.jsx("div",{className:`text-xs flex items-center gap-1 ${R.change>0?"text-green-600":R.change<0?"text-red-600":"text-gray-500"}`,children:R.change!==0&&e.jsxs("span",{children:[R.change>0?"↑":"↓"," ",Math.abs(R.change)]})})]})]},R.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:e.jsx(Yt,{alerts:_,onMarkAsRead:c,maxVisible:4})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.1},className:"xl:col-span-2 p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:e.jsx(Qt,{obras:D,maxVisible:6})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.2},className:"xl:col-span-2 p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:e.jsx(er,{data:C,metric:"inversion"})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.3},className:"p-6 rounded-2xl bg-white/80 backdrop-blur-sm border border-white/20 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Próximas Valorizaciones"]}),e.jsx("div",{className:"space-y-4",children:i.slice(0,5).map((R,E)=>e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:1.3+E*.1},className:`p-4 rounded-xl border-l-4 ${R.estado==="Vencida"?"bg-red-50 border-red-500":R.estado==="Crítica"?"bg-amber-50 border-amber-500":"bg-blue-50 border-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:R.obra}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${R.estado==="Vencida"?"bg-red-100 text-red-700":R.estado==="Crítica"?"bg-amber-100 text-amber-700":"bg-blue-100 text-blue-700"}`,children:R.estado})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:R.contratista}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:h(R.monto)}),e.jsx("span",{className:`text-xs font-medium ${R.diasRestantes<0?"text-red-600":R.diasRestantes<=1?"text-amber-600":"text-blue-600"}`,children:R.diasRestantes<0?`${Math.abs(R.diasRestantes)} días vencida`:R.diasRestantes===0?"Vence hoy":`${R.diasRestantes} días restantes`})]})]},R.id))})]})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.4},className:"p-6 rounded-2xl bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white shadow-2xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Centro de Comando Activo"}),e.jsx("p",{className:"text-blue-100",children:"Sistema de monitoreo en tiempo real • Actualización automática cada 30 segundos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Gestionar Equipos"})]}),e.jsxs("button",{className:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{children:"Configuración"})]})]})]})}),!1]})})},_a=s=>s.startsWith("10")?"NATURAL":s.startsWith("20")?"JURIDICA":"UNKNOWN",He=s=>_a(s)==="NATURAL",js=s=>_a(s)==="JURIDICA",hr=s=>s.length===11&&s.startsWith("10")?s.substring(2,10):"",Aa=({isOpen:s,onClose:b,onSubmit:j,loading:x=!1,title:f="Nueva Empresa Ejecutora"})=>{const[n,l]=o.useState({ruc:"",razon_social:"",dni:"",tipo_empresa:"SAC",email:"",celular:"",direccion:"",representantes:[],representante_principal_id:0,estado:"ACTIVO",especialidades_oece:[],fuentes_consultadas:[]}),[N,_]=o.useState(!1),[w,i]=o.useState(!1),[t,r]=o.useState(""),[c,p]=o.useState(1),[h,a]=o.useState(""),[u,d]=o.useState(0),A=o.useRef(!1);o.useEffect(()=>{s&&!A.current&&(A.current=!0,l({ruc:"",razon_social:"",dni:"",tipo_empresa:"SAC",email:"",celular:"",direccion:"",representantes:[],representante_principal_id:0,estado:"ACTIVO",especialidades_oece:[],fuentes_consultadas:[]}),i(!1),r(""),p(1),a(""),d(0))},[s]),o.useEffect(()=>{s||(A.current=!1)},[s]),o.useCallback((v,R)=>{A.current||(A.current=!0);const E=v.tipo_persona==="NATURAL"||v.ruc?.startsWith("10");let m="",g="",T="",V="";E?(m=v.email||"",g=v.telefono||"",T=v.direccion||"",V=v.dni||""):(m=v.email||v.contactos?.[0]?.email||"",g=(v.telefono||v.contactos?.[0]?.telefono||"").replace(/^[^:]*:\s*/,"").replace(/\n/g,"").trim(),T=v.direccion||v.contactos?.[0]?.domicilio_fiscal||v.contactos?.[0]?.direccion||"");const I={ruc:v.ruc||"",razon_social:v.razon_social||"",dni:V,email:m,celular:g,direccion:T,representantes:(v.miembros||[]).map(F=>({nombre:F.nombre||"",cargo:F.cargo||"REPRESENTANTE",numero_documento:F.numero_documento||"",tipo_documento:F.tipo_documento||"DNI",fuente:F.fuente||"SUNAT",es_principal:!1,activo:!0})),representante_principal_id:0,especialidades_oece:v.especialidades||[],estado_sunat:v.registro?.estado_sunat,estado_osce:v.registro?.estado_osce,fuentes_consultadas:v.fuentes_consultadas||[],capacidad_contratacion:v.registro?.capacidad_contratacion};Rt.startTransition(()=>{l(F=>({...F,...I})),i(!0),p(2),a("CONSOLIDADO"),r("")})},[]);const y=async()=>{if(!n.ruc||n.ruc.length!==11){r("Ingrese un RUC válido de 11 dígitos");return}_(!0),r("");try{const v=n.ruc.startsWith("10"),R=n.ruc.startsWith("20");if(!v&&!R){r("RUC debe comenzar con 10 (persona natural) o 20 (persona jurídica)");return}let E="",m="",g={};v?(E=`${G.consultaRucConsolidada}/${n.ruc}`,m="CONSOLIDADO",g={method:"GET",headers:{Accept:"application/json"}}):(E=`${G.consultaRucConsolidada}/${n.ruc}`,m="CONSOLIDADO",g={method:"GET",headers:{Accept:"application/json"}});const T=new AbortController,V=setTimeout(()=>T.abort(),45e3),I=await fetch(E,{...g,signal:T.signal});if(clearTimeout(V),!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);const F=await I.json(),L=F.success?F.data:F;if(v)if(L.ruc&&L.razon_social){const U=hr(L.ruc),q=L.contactos?.[0]||{},ee=q.telefono?q.telefono.replace(/^[^:]*:\s*/,"").replace(/\n/g,"").trim():"";l(W=>({...W,ruc:L.ruc,razon_social:L.razon_social,dni:U,email:L.email||q.email||"",celular:L.telefono||ee||"",direccion:L.direccion||"",representantes:[],representante_principal_id:0,especialidades_oece:[],estado:L.estado==="ACTIVO"?"ACTIVO":L.estado==="INACTIVO"?"INACTIVO":"SUSPENDIDO",estado_sunat:"ACTIVO",fuentes_consultadas:L.fuentes||["SUNAT","OSCE"],capacidad_contratacion:L.capacidad_contratacion||void 0})),i(!0),p(2),a("CONSOLIDADO"),r("")}else r(F.message||"No se pudo obtener información de SUNAT para este RUC");else if(L.ruc&&L.razon_social){const U=L.contactos?.[0]||{},q=U.telefono?U.telefono.replace(/^[^:]*:\s*/,"").replace(/\n/g,"").trim():"",ee=(L.representantes||[]).map(J=>({nombre:J.nombre||"",cargo:J.cargo||"SOCIO",numero_documento:J.documento||J.numero_documento||"",tipo_documento:"DNI",fuente:J.fuente||"OECE",es_principal:!1,activo:!0})),W=ee.length>0?0:-1;l(J=>({...J,ruc:L.ruc,razon_social:L.razon_social,email:L.email||U.email||"",celular:L.telefono||q||"",direccion:L.direccion||"",representantes:ee,representante_principal_id:W,especialidades_oece:L.especialidades||[],estado:L.estado==="ACTIVO"?"ACTIVO":L.estado==="INACTIVO"?"INACTIVO":"SUSPENDIDO",estado_sunat:"ACTIVO",estado_osce:"",fuentes_consultadas:L.fuentes||["SUNAT","OSCE"],capacidad_contratacion:L.capacidad_contratacion||""})),i(!0),p(2),a("CONSOLIDADO"),r("")}else r(F.message||"No se pudo obtener información de SUNAT para este RUC")}catch(v){v.name==="AbortError"?r("⏱️ La consulta está tomando demasiado tiempo. El scraping puede tardar hasta 45 segundos. Por favor espere o intente nuevamente."):v.message.includes("HTTP 404")?r("❌ RUC no encontrado en los registros de SUNAT/OSCE."):v.message.includes("HTTP 5")?r("🔧 Error en el servidor de scraping. Por favor intente nuevamente en unos minutos."):v.message.includes("Failed to fetch")||v.message.includes("NetworkError")?r("🌐 Error de conexión. Verifique su conexión a internet."):r(`❌ Error de conexión: ${v.message||"Verifique que la API esté ejecutándose."}`)}finally{_(!1)}},k=v=>{l(R=>({...R,representante_principal_id:v}))},O=async v=>{if(v.preventDefault(),!n.ruc||!n.razon_social){r("RUC y Razón Social son obligatorios");return}if(js(n.ruc)&&n.representantes.length===0){r("Debe obtener los datos y tener al menos un representante para personas jurídicas");return}try{const R={ruc:n.ruc,razon_social:n.razon_social,dni:n.dni||null,tipo_empresa:n.tipo_empresa,email:n.email||null,celular:n.celular||null,direccion:n.direccion||null,representantes:He(n.ruc)?[]:n.representantes.map(E=>({nombre:E.nombre,cargo:E.cargo||"REPRESENTANTE",numero_documento:E.numero_documento,tipo_documento:E.tipo_documento||"DNI",fuente:E.fuente||"MANUAL",es_principal:E.es_principal||!1,activo:E.activo??!0})),representante_principal_id:He(n.ruc)?0:n.representante_principal_id,estado:n.estado,especialidades_oece:n.especialidades_oece||[],estado_sunat:n.estado_sunat||null,estado_osce:n.estado_osce||null,fuentes_consultadas:n.fuentes_consultadas||[],capacidad_contratacion:n.capacidad_contratacion||null};console.log("📤 Enviando datos al backend:",R),await j(R),b()}catch{r("Error al guardar la empresa")}},D=()=>e.jsx("div",{className:"flex items-center justify-between mb-8",children:[1,2,3].map(v=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
            w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
            ${c>=v?"bg-gradient-to-r from-blue-600 to-purple-600 text-white":"bg-gray-200 text-gray-600"}
          `,children:v}),e.jsx("div",{className:`ml-3 ${c>=v?"text-blue-600":"text-gray-500"}`,children:e.jsxs("div",{className:"font-medium",children:[v===1&&"Consultar RUC",v===2&&"Verificar Datos",v===3&&"Guardar"]})}),v<3&&e.jsx("div",{className:`w-16 h-0.5 mx-4 ${c>v?"bg-blue-600":"bg-gray-300"}`})]},v))}),C=()=>{const v=t&&t.startsWith("⚠️ Consolidación parcial:");return e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:`rounded-xl p-6 mb-6 ${v?"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200":"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:v?e.jsx(Q,{className:"w-8 h-8 text-amber-600"}):e.jsx(B,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-bold text-lg mb-2 ${v?"text-amber-800":"text-green-800"}`,children:v?"⚠️ Datos Parciales Obtenidos":"🎉 ¡Datos Obtenidos Exitosamente!"}),e.jsxs("div",{className:"mb-4",children:[h==="SUNAT"&&e.jsxs("div",{className:"flex items-center gap-2 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx(vs,{className:"w-4 h-4"}),"Consulta únicamente (Persona Natural)"]}),h==="CONSOLIDADO"&&e.jsxs("div",{className:"flex items-center gap-2 bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx(tt,{className:"w-4 h-4"}),"Consulta Consolidada + OSCE (Persona Jurídica)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[js(n.ruc)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:v?"text-amber-700":"text-green-700",children:[n.representantes.length," Representantes"]})]}),He(n.ruc)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:v?"text-amber-700":"text-green-700",children:"Persona Natural"})]}),h==="CONSOLIDADO"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:v?"text-amber-700":"text-green-700",children:[n.especialidades_oece.length," Especialidades"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:v?"text-amber-700":"text-green-700",children:["Estado: ",v?"Parcial":"Verificado"]})]})]})]})]})})},P=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-6 h-6 text-purple-600"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Representantes Legales (",n.representantes.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.representantes.map((v,R)=>e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:R*.1},onClick:()=>k(R),className:`
              relative p-6 border-2 rounded-xl cursor-pointer transition-all duration-300
              ${n.representante_principal_id===R?"border-blue-500 bg-gradient-to-br from-blue-50 to-indigo-50 shadow-lg ring-4 ring-blue-100":"border-gray-200 hover:border-blue-300 hover:shadow-md"}
            `,children:[n.representante_principal_id===R&&e.jsx("div",{className:"absolute -top-3 left-6",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1",children:[e.jsx(as,{className:"w-3 h-3"}),"REPRESENTANTE PRINCIPAL"]})}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-lg leading-tight",children:v.nombre}),e.jsx(rt,{className:`w-5 h-5 ${n.representante_principal_id===R?"text-blue-600":"text-gray-400"}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${v.cargo==="GERENTE GENERAL"?"bg-blue-100 text-blue-800":v.cargo==="SOCIO"?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:v.cargo||"SOCIO"})}),e.jsxs("p",{className:"text-sm text-gray-600 font-mono",children:["DNI: ",v.numero_documento]}),v.fecha_desde&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Desde: ",v.fecha_desde]})]})]})]},R))}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Selecciona el representante que actuará como representante legal principal de la empresa."]})})]}),M=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-6 h-6 text-orange-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Especialidades y Capacidades"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-yellow-50 border border-orange-200 rounded-xl p-6",children:[n.estado_osce&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-orange-600"}),"Estado de Registro"]}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:e.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-medium leading-relaxed",children:n.estado_osce})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-600"}),"Especialidades (",n.especialidades_oece.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:n.especialidades_oece.map((v,R)=>e.jsx(S.span,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:R*.05},className:"px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-full text-sm font-bold shadow-md",children:v},R))}),n.capacidad_contratacion&&e.jsx("div",{className:"mt-4 p-3 bg-white rounded-lg border border-orange-200",children:e.jsxs("span",{className:"text-sm text-gray-600 font-medium",children:["Capacidad: ",n.capacidad_contratacion]})})]})]})]});return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs(S.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden",children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white p-8",children:[e.jsx("button",{onClick:b,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Ie,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-xl",children:e.jsx(le,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:f}),e.jsx("p",{className:"text-blue-100 mt-1",children:"Registro de empresa con datos automáticos"})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(D,{})})]}),e.jsxs("form",{onSubmit:O,className:"p-8 space-y-8 overflow-y-auto max-h-[calc(95vh-280px)]",children:[e.jsx(we,{children:w&&e.jsx(C,{})}),e.jsx(we,{children:t&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"text-red-800 font-medium",children:t})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Consulta de RUC"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"RUC Empresarial *"}),e.jsx("input",{type:"text",value:n.ruc,onChange:v=>l(R=>({...R,ruc:v.target.value.replace(/\D/g,"").slice(0,11)})),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 text-lg font-mono",placeholder:"10123456789 ó 20123456789",maxLength:11}),n.ruc.length>=2&&e.jsxs("div",{className:"mt-2",children:[n.ruc.startsWith("10")&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Persona Natural - Consulta directa únicamente"})]}),n.ruc.startsWith("20")&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-purple-600 font-medium",children:"Persona Jurídica - Consulta Consolidada + OSCE"})]}),!n.ruc.startsWith("10")&&!n.ruc.startsWith("20")&&n.ruc.length>=2&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-red-600 font-medium",children:"RUC inválido - Debe comenzar con 10 ó 20"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:[He(n.ruc)?"NOMBRE:":"Razón Social"," *"]}),e.jsx("input",{type:"text",value:n.razon_social,onChange:v=>{l(R=>({...R,razon_social:v.target.value}))},className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500",placeholder:"Se completará automáticamente..."})]}),He(n.ruc)&&w&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"DNI:"}),e.jsx("input",{type:"text",value:n.dni,onChange:v=>l(R=>({...R,dni:v.target.value.replace(/\D/g,"").slice(0,8)})),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 font-mono",placeholder:"12345678",maxLength:8}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Extraído automáticamente del RUC o ingrese manualmente"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:y,disabled:N||!n.ruc,className:"px-12 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 font-bold shadow-lg hover:shadow-xl transition-all text-lg",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{children:n.ruc.startsWith("10")?"Consultando SUNAT...":"Scraping SUNAT + OSCE..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-6 h-6"}),"OBTENER DATOS"]})})})]}),w&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Información de Contacto"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Email Corporativo"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",value:n.email,onChange:v=>{l(R=>({...R,email:v.target.value}))},className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-500",placeholder:"contacto@empresa.com"},`email-${u}`)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Teléfono / Celular"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:n.celular,onChange:v=>{l(R=>({...R,celular:v.target.value}))},className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-500",placeholder:"912345678"},`celular-${u}`)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:He(n.ruc)?"DIRECCIÓN:":"Dirección Completa"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-4 w-5 h-5 text-gray-400"}),e.jsx("textarea",{value:n.direccion,onChange:v=>{l(R=>({...R,direccion:v.target.value}))},rows:3,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-green-100 focus:border-green-500 resize-none",placeholder:"Dirección completa obtenida automáticamente..."})]})]})]}),js(n.ruc)&&n.representantes.length>0&&e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(P,{})}),js(n.ruc)&&h==="CONSOLIDADO"&&n.especialidades_oece.length>0&&e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(M,{})}),He(n.ruc)&&h==="SUNAT"&&e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 text-lg mb-2",children:"Información para Personas Naturales"}),e.jsxs("p",{className:"text-blue-800 text-sm leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Personas Naturales:"})," Como persona natural, usted actúa como su propio representante legal. La información de especialidades y capacidades está disponible principalmente para personas jurídicas y empresas."]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600 bg-blue-100 px-3 py-1 rounded-full inline-block",children:"💡 Para especialidades OSCE, se requiere registro como persona jurídica"})]})]})}),w&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Clasificación Local"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Estado"}),e.jsxs("select",{value:n.estado,onChange:v=>l(R=>({...R,estado:v.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500",children:[e.jsx("option",{value:"ACTIVO",children:"✅ Activo"}),e.jsx("option",{value:"INACTIVO",children:"⏸️ Inactivo"}),e.jsx("option",{value:"SUSPENDIDO",children:"⚠️ Suspendido"})]})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 px-8 py-6 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:w?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-green-600"}),"Datos consolidados listos para guardar"]}):"Complete la consulta RUC para continuar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-3 text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",onClick:O,disabled:x||!w,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-bold shadow-lg hover:shadow-xl transition-all",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-5 h-5 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-5 h-5"}),"Guardar Empresa"]})})]})]})]})}):null};G.consultaRuc.replace("/consulta-ruc","");const da=[{value:"ACTIVO",label:"Activo",color:"bg-green-100 text-green-800"},{value:"INACTIVO",label:"Inactivo",color:"bg-gray-100 text-gray-800"},{value:"SUSPENDIDO",label:"Suspendido",color:"bg-red-100 text-red-800"}],gr=[{value:"A",label:"Categoría A"},{value:"B",label:"Categoría B"},{value:"C",label:"Categoría C"},{value:"D",label:"Categoría D"},{value:"E",label:"Categoría E"}],br=["EDIFICACIONES","CARRETERAS","SANEAMIENTO","ELECTRICIDAD","TELECOMUNICACIONES","PUENTES"],Ca=({entidades:s,loading:b,filtros:j,onFiltrosChange:x,onVerDetalle:f,onEditar:n,onEliminar:l})=>{const[N,_]=o.useState(!1),[w,i]=o.useState(null),t=o.useMemo(()=>s.filter(a=>{if(j.search){const u=j.search.toLowerCase();if(!(a.nombre_completo.toLowerCase().includes(u)||a.ruc_principal?.toLowerCase().includes(u)||a.datos_empresa?.razon_social?.toLowerCase().includes(u)||a.datos_empresa?.nombre_comercial?.toLowerCase().includes(u)||a.datos_consorcio?.nombre?.toLowerCase().includes(u)))return!1}if(j.tipo_entidad&&a.tipo_entidad!==j.tipo_entidad||j.estado&&a.estado!==j.estado||j.categoria&&a.tipo_entidad==="EMPRESA"&&a.datos_empresa?.categoria_contratista_capacidad!==j.categoria)return!1;if(j.especialidades&&j.especialidades.length>0){const u=a.tipo_entidad==="EMPRESA"?a.datos_empresa?.especialidades||[]:a.datos_consorcio?.especialidades||[];if(!j.especialidades.some(A=>u.includes(A)))return!1}return!0}),[s,j]),r=(a,u)=>{x({...j,[a]:u})},c=a=>{const u=j.especialidades||[],d=u.includes(a)?u.filter(A=>A!==a):[...u,a];r("especialidades",d)},p=()=>{x({search:"",tipo_entidad:void 0,estado:void 0,categoria:void 0,especialidades:[]})},h=a=>da.find(u=>u.value===a)?.color||"bg-gray-100 text-gray-800";return b?e.jsx("div",{className:"space-y-4",children:[...Array(6)].map((a,u)=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-20"})]})]})]})})},u))}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, RUC o razón social...",value:j.search||"",onChange:a=>r("search",a.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:()=>_(!N),className:`px-4 py-3 border border-gray-300 rounded-lg flex items-center gap-2 transition-colors ${N?"bg-primary-50 border-primary-300 text-primary-700":"hover:bg-gray-50"}`,children:[e.jsx(Ke,{className:"w-5 h-5"}),"Filtros"]})]}),N&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Entidad"}),e.jsxs("select",{value:j.tipo_entidad||"",onChange:a=>r("tipo_entidad",a.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"EMPRESA",children:"Empresas"}),e.jsx("option",{value:"CONSORCIO",children:"Consorcios"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),e.jsxs("select",{value:j.estado||"",onChange:a=>r("estado",a.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),da.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoría"}),e.jsxs("select",{value:j.categoria||"",onChange:a=>r("categoria",a.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas"}),gr.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:p,className:"w-full px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Limpiar Filtros"})}),e.jsxs("div",{className:"lg:col-span-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:br.map(a=>e.jsx("button",{onClick:()=>c(a),className:`px-3 py-1 text-sm rounded-full transition-colors ${j.especialidades?.includes(a)?"bg-primary-100 text-primary-800 border border-primary-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:a},a))})]})]})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"text-gray-600",children:[t.length," ",t.length===1?"resultado":"resultados"]})}),t.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron resultados"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Intenta ajustar los filtros de búsqueda para encontrar lo que buscas."}),e.jsx("button",{onClick:p,className:"btn-secondary",children:"Limpiar Filtros"})]}):e.jsx("div",{className:"space-y-4",children:t.map((a,u)=>e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:u*.05},className:"bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center ${a.tipo_entidad==="EMPRESA"?"bg-blue-100 text-blue-600":"bg-purple-100 text-purple-600"}`,children:a.tipo_entidad==="EMPRESA"?e.jsx(le,{className:"w-6 h-6"}):e.jsx(de,{className:"w-6 h-6"})}),a.tipo_entidad==="EMPRESA"&&a.datos_empresa?.categoria_contratista&&(a.datos_empresa.categoria_contratista==="EJECUTORA"?e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",title:"Empresa Ejecutora",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"E"})}):e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",title:"Empresa Supervisora",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"S"})}))]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:a.nombre_completo}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.tipo_entidad==="EMPRESA"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:a.tipo_entidad==="EMPRESA"?"Empresa":"Consorcio"}),a.tipo_entidad==="EMPRESA"&&a.datos_empresa?.categoria_contratista&&e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white ${a.datos_empresa.categoria_contratista==="EJECUTORA"?"bg-blue-500":"bg-green-500"}`,children:a.datos_empresa.categoria_contratista}),a.tipo_entidad==="CONSORCIO"&&a.empresas_participantes?.some(d=>d.es_lider)&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:[e.jsx(as,{className:"w-3 h-3"}),"Con Líder"]})]}),a.tipo_entidad==="EMPRESA"&&a.datos_empresa&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"font-mono",children:["RUC: ",a.datos_empresa.ruc]}),a.datos_empresa.categoria_contratista&&e.jsxs("span",{className:"px-2 py-1 bg-gradient-to-r from-orange-100 to-yellow-100 text-orange-800 rounded text-xs font-medium border border-orange-200",children:["Categoría ",a.datos_empresa.categoria_contratista]}),Math.random()>.7&&e.jsx("span",{className:"px-2 py-1 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 rounded text-xs font-medium border border-purple-200",children:"⭐ Especializada"})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[a.datos_empresa.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),a.datos_empresa.email]}),a.datos_empresa.telefono&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),a.datos_empresa.telefono]}),a.datos_empresa.direccion&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-4 h-4"}),a.datos_empresa.direccion]})]}),a.datos_empresa.especialidades&&a.datos_empresa.especialidades.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[a.datos_empresa.especialidades.slice(0,3).map((d,A)=>e.jsx("span",{className:`px-2 py-1 text-xs rounded font-medium ${A===0?"bg-blue-100 text-blue-800 border border-blue-200":A===1?"bg-green-100 text-green-800 border border-green-200":"bg-purple-100 text-purple-800 border border-purple-200"}`,children:d.replace("_"," ")},d)),a.datos_empresa.especialidades.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 text-xs rounded font-medium border border-gray-300",children:["+",a.datos_empresa.especialidades.length-3," más"]})]})]}),a.tipo_entidad==="CONSORCIO"&&a.datos_consorcio&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:a.empresas_participantes?.length||0})," empresas"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4"}),"Constituido: ",e.jsx("span",{className:"font-medium",children:new Date(a.datos_consorcio.fecha_constitucion).toLocaleDateString()})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Líder: ",a.datos_consorcio.empresa_lider_nombre]}),a.datos_consorcio.descripcion&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.datos_consorcio.descripcion}),a.empresas_participantes&&a.empresas_participantes.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[a.empresas_participantes.slice(0,2).map(d=>e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded flex items-center gap-1",children:[d.es_lider&&e.jsx(as,{className:"w-3 h-3 text-yellow-600"}),d.empresa_nombre," (",d.porcentaje_participacion,"%)"]},d.empresa_id)),a.empresas_participantes.length>2&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["+",a.empresas_participantes.length-2," más"]})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${h(a.estado)}`,children:a.estado}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(w===a.id?null:a.id),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(it,{className:"w-4 h-4"})}),w===a.id&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{f(a),i(null)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(ke,{className:"w-4 h-4"}),"Ver Detalle"]}),n&&e.jsxs("button",{onClick:()=>{n(a),i(null)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(ts,{className:"w-4 h-4"}),"Editar"]}),l&&e.jsxs("button",{onClick:()=>{l(a),i(null)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(Cs,{className:"w-4 h-4"}),"Eliminar"]})]})})]})]})]})})},a.id))})]})},Sa=({entidad:s,isOpen:b,onClose:j,onEditar:x})=>{if(!s||!b)return null;const f=n=>{switch(n){case"ACTIVO":return"bg-green-100 text-green-800";case"INACTIVO":return"bg-gray-100 text-gray-800";case"SUSPENDIDO":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsx(we,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center ${s.tipo_entidad==="EMPRESA"?"bg-blue-100 text-blue-600":"bg-purple-100 text-purple-600"}`,children:s.tipo_entidad==="EMPRESA"?e.jsx(le,{className:"w-6 h-6"}):e.jsx(de,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s.nombre_completo}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.tipo_entidad==="EMPRESA"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.tipo_entidad==="EMPRESA"?"Empresa Individual":"Consorcio"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f(s.estado)}`,children:s.estado})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsxs("button",{onClick:x,className:"btn-secondary flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Editar"]}),e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ie,{className:"w-5 h-5 text-gray-500"})})]})]}),e.jsx("div",{className:"px-6 py-6",children:s.tipo_entidad==="EMPRESA"&&s.datos_empresa?e.jsx(jr,{entidad:s}):s.tipo_entidad==="CONSORCIO"&&s.datos_consorcio?e.jsx(fr,{entidad:s}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No se pudo cargar la información de la entidad"})]})})]})})})},jr=({entidad:s})=>{const b=s.datos_empresa;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información General"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"RUC"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(nt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-mono",children:b.ruc})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Categoría"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:b.categoria_contratista?`Categoría ${b.categoria_contratista}`:"No especificada"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Razón Social"}),e.jsx("p",{className:"mt-1 text-gray-900 font-medium",children:b.razon_social})]}),b.nombre_comercial&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Nombre Comercial"}),e.jsx("p",{className:"mt-1 text-gray-900",children:b.nombre_comercial})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Fechas"}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4"}),"Registrado: ",new Date(s.created_at).toLocaleDateString("es-PE")]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4"}),"Actualizado: ",new Date(s.updated_at).toLocaleDateString("es-PE")]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Representante Legal"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.representante_legal||"No especificado"}),b.dni_representante&&e.jsxs("p",{className:"text-sm text-gray-600",children:["DNI: ",b.dni_representante]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contacto"}),e.jsxs("div",{className:"space-y-3",children:[b.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{children:e.jsx("a",{href:`mailto:${b.email}`,className:"text-primary-600 hover:text-primary-700",children:b.email})})]}),b.telefono&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{children:e.jsx("a",{href:`tel:${b.telefono}`,className:"text-primary-600 hover:text-primary-700",children:b.telefono})})]}),b.direccion&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900",children:b.direccion}),(b.distrito||b.provincia)&&e.jsx("p",{className:"text-sm text-gray-600",children:[b.distrito,b.provincia].filter(Boolean).join(", ")})]})]})]})]}),b.especialidades&&b.especialidades.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Especialidades"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.especialidades.map(j=>e.jsx("span",{className:"px-3 py-2 bg-primary-100 text-primary-800 text-sm rounded-lg font-medium",children:j.replace("_"," ")},j))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(us,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Tipo de Empresa"}),e.jsx("p",{className:"text-blue-700 text-sm",children:b.tipo_empresa||"No especificado"})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ws,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900",children:"Estado"}),e.jsx("p",{className:"text-green-700 text-sm",children:s.estado})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-900",children:"Categoría"}),e.jsx("p",{className:"text-purple-700 text-sm",children:b.categoria_contratista?`Categoría ${b.categoria_contratista}`:"No especificada"})]})]})})]})]})},fr=({entidad:s})=>{const b=s.datos_consorcio,j=s.empresas_participantes||[];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información General"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Nombre del Consorcio"}),e.jsx("p",{className:"mt-1 text-gray-900 font-medium",children:b.nombre})]}),b.descripcion&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Descripción"}),e.jsx("p",{className:"mt-1 text-gray-700",children:b.descripcion})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Fecha de Constitución"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:new Date(b.fecha_constitucion).toLocaleDateString("es-PE")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Total de Empresas"}),e.jsx("span",{className:"text-2xl font-bold text-primary-600",children:j.length})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Fechas de Sistema"}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4"}),"Registrado: ",new Date(s.created_at).toLocaleDateString("es-PE")]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4"}),"Actualizado: ",new Date(s.updated_at).toLocaleDateString("es-PE")]})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Empresa Líder"}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(as,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.empresa_lider_nombre}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Empresa que lidera y representa al consorcio"})]})]})})]}),b.especialidades&&b.especialidades.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Especialidades del Consorcio"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.especialidades.map(x=>e.jsx("span",{className:"px-3 py-2 bg-primary-100 text-primary-800 text-sm rounded-lg font-medium",children:x.replace("_"," ")},x))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Empresas Participantes"}),j.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"No hay empresas participantes registradas"})]}):e.jsxs("div",{className:"space-y-4",children:[j.map(x=>e.jsx("div",{className:`border rounded-lg p-6 ${x.es_lider?"border-yellow-200 bg-yellow-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${x.es_lider?"bg-yellow-100 text-yellow-600":"bg-blue-100 text-blue-600"}`,children:x.es_lider?e.jsx(as,{className:"w-6 h-6"}):e.jsx(le,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:x.empresa_nombre}),x.es_lider&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:[e.jsx(as,{className:"w-3 h-3"}),"Líder"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["RUC: ",x.empresa_ruc]}),x.responsabilidades&&x.responsabilidades.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Responsabilidades:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.responsabilidades.map(f=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:f.replace("_"," ")},f))})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[x.porcentaje_participacion,"%"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Participación"})]})]})},x.empresa_id)),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total de participación:"}),e.jsxs("span",{className:"text-lg font-bold text-primary-600",children:[j.reduce((x,f)=>x+f.porcentaje_participacion,0).toFixed(2),"%"]})]})})]})]})]})},Pa=({tipo:s,onNavigate:b})=>{const j=[{label:"Dashboard",icon:ys,onClick:()=>b("dashboard"),isActive:!1},{label:"Empresas Contratistas",icon:le,onClick:()=>b("dashboard"),isActive:!s}];return s==="ejecutoras"&&j.push({label:"Empresas Ejecutoras",icon:us,onClick:()=>b("ejecutoras"),isActive:!0}),s==="supervisoras"&&j.push({label:"Empresas Supervisoras",icon:ge,onClick:()=>b("supervisoras"),isActive:!0}),e.jsx("nav",{className:"flex items-center space-x-1 text-sm text-gray-500","aria-label":"Breadcrumb",children:j.map((x,f)=>{const n=x.icon;return e.jsxs("div",{className:"flex items-center",children:[f>0&&e.jsx("span",{className:"mx-2 text-gray-400",children:"/"}),e.jsxs("button",{onClick:x.onClick,className:`flex items-center gap-1.5 px-2 py-1 rounded-md transition-colors ${x.isActive?s==="ejecutoras"?"text-blue-600 bg-blue-50 font-medium":s==="supervisoras"?"text-green-600 bg-green-50 font-medium":"text-gray-900 bg-gray-50 font-medium":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:x.label})]})]},x.label)})})},ma=({onVolverADashboard:s,onMostrarMensaje:b}={})=>{const{entidades:j,loading:x,error:f}=Te(),{crearEmpresa:n,eliminarEmpresa:l,loading:N}=Rs(),[_,w]=o.useState(null),[i,t]=o.useState(null),[r,c]=o.useState(null),[p,h]=o.useState({search:"",tipo_entidad:void 0,estado:void 0,categoria:void 0,especialidades:[]}),a=j.filter(D=>D.tipo_entidad==="EMPRESA"&&D.datos_empresa?D.datos_empresa.categoria_contratista==="EJECUTORA"||D.datos_empresa.categoria_contratista===null||D.datos_empresa.categoria_contratista===void 0:D.tipo_entidad==="CONSORCIO"),u={totalEjecutoras:a.length,empresasEjecutoras:a.filter(D=>D.tipo_entidad==="EMPRESA").length,consorciosEjecutores:a.filter(D=>D.tipo_entidad==="CONSORCIO").length,activasEjecutoras:a.filter(D=>D.estado==="ACTIVO").length},d=D=>{if(D&&D.tipo_entidad==="EMPRESA"&&D.datos_empresa){const C={ruc:D.datos_empresa.ruc,razon_social:D.datos_empresa.razon_social,nombre_comercial:D.datos_empresa.nombre_comercial,email:D.datos_empresa.email,telefono:D.datos_empresa.telefono,direccion:D.datos_empresa.direccion,estado:D.estado,tipo_empresa:"SAC",categoria_contratista:D.datos_empresa.categoria_contratista,especialidades:D.datos_empresa.especialidades};c(C)}else c(null);w("empresa")},A=D=>{t(D),w("detalle")},y=()=>{w(null),t(null),c(null)},k=async D=>{try{const C={...D,categoria_contratista:"EJECUTORA"};r?b?.("success","Empresa ejecutora actualizada correctamente"):(await n(C),b?.("success","Empresa ejecutora registrada correctamente")),y()}catch(C){const P=C instanceof Error?C.message:"Error al procesar empresa ejecutora";throw b?.("error",P),C}},O=async D=>{const C=D.tipo_entidad==="EMPRESA"?"empresa ejecutora":"consorcio ejecutor";if(confirm(`¿Estás seguro de que quieres eliminar esta ${C} "${D.nombre_completo}"?`))try{D.tipo_entidad==="EMPRESA"&&D.empresa_id?(await l(D.empresa_id),b?.("success","Empresa ejecutora eliminada correctamente")):b?.("error","La eliminación de consorcios aún no está implementada")}catch(P){const M=P instanceof Error?P.message:"Error al eliminar";b?.("error",M)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:e.jsx(us,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-blue-900",children:"Empresas Ejecutoras"})]}),e.jsx("p",{className:"text-blue-700 ml-13",children:"Gestión integral de empresas y consorcios responsables de la ejecución de obras"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>d(),className:"flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 border border-blue-300 rounded-lg transition-colors",children:[e.jsx(le,{className:"w-5 h-5"}),"Nueva Empresa Ejecutora"]})})]}),e.jsx(Pa,{tipo:"ejecutoras",onNavigate:D=>{D==="dashboard"&&s()}}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:u.totalEjecutoras}),e.jsx("p",{className:"text-sm text-blue-700",children:"Total Ejecutoras"})]})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-500 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:u.empresasEjecutoras}),e.jsx("p",{className:"text-sm text-blue-700",children:"Empresas Ejecutoras"})]})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:u.activasEjecutoras}),e.jsx("p",{className:"text-sm text-blue-700",children:"Activas"})]})]})})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Error al cargar empresas ejecutoras: ",f]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-blue-200",children:[e.jsxs("div",{className:"border-b border-blue-100 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:"Registro de Empresas Ejecutoras"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Empresas y consorcios habilitados para ejecutar obras de infraestructura municipal"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ca,{entidades:a,loading:x,filtros:p,onFiltrosChange:h,onVerDetalle:A,onEditar:d,onEliminar:O})})]}),e.jsx(Aa,{isOpen:_==="empresa",onClose:y,onSubmit:k,empresa:r||void 0,loading:N,title:r?"Editar Empresa Ejecutora":"Nueva Empresa Ejecutora"}),e.jsx(Sa,{entidad:i,isOpen:_==="detalle",onClose:y,onEditar:()=>{i&&(y(),d(i))}})]})},Nr=({onVolverADashboard:s,onMostrarMensaje:b}={})=>{const{entidades:j,loading:x,error:f}=Te(),{crearEmpresa:n,eliminarEmpresa:l,loading:N}=Rs(),[_,w]=o.useState(null),[i,t]=o.useState(null),[r,c]=o.useState(null),[p,h]=o.useState({search:"",tipo_entidad:void 0,estado:void 0,categoria:void 0,especialidades:[]}),a=j.filter(D=>D.tipo_entidad==="EMPRESA"&&D.datos_empresa?D.datos_empresa.categoria_contratista==="SUPERVISORA":D.tipo_entidad==="CONSORCIO"),u={totalSupervisoras:a.length,empresasSupervisoras:a.filter(D=>D.tipo_entidad==="EMPRESA").length,activasSupervisoras:a.filter(D=>D.estado==="ACTIVO").length},d=D=>{if(D&&D.tipo_entidad==="EMPRESA"&&D.datos_empresa){const C={ruc:D.datos_empresa.ruc,razon_social:D.datos_empresa.razon_social,nombre_comercial:D.datos_empresa.nombre_comercial,email:D.datos_empresa.email,telefono:D.datos_empresa.telefono,direccion:D.datos_empresa.direccion,estado:D.estado,tipo_empresa:"SAC",categoria_contratista:D.datos_empresa.categoria_contratista,especialidades:D.datos_empresa.especialidades};c(C)}else c(null);w("empresa")},A=D=>{t(D),w("detalle")},y=()=>{w(null),t(null),c(null)},k=async D=>{try{const C={...D,categoria_contratista:"SUPERVISORA"};r?b?.("success","Empresa supervisora actualizada correctamente"):(await n(C),b?.("success","Empresa supervisora registrada correctamente")),y()}catch(C){const P=C instanceof Error?C.message:"Error al procesar empresa supervisora";throw b?.("error",P),C}},O=async D=>{const C=D.tipo_entidad==="EMPRESA"?"empresa supervisora":"consorcio supervisor";if(confirm(`¿Estás seguro de que quieres eliminar esta ${C} "${D.nombre_completo}"?`))try{D.tipo_entidad==="EMPRESA"&&D.empresa_id?(await l(D.empresa_id),b?.("success","Empresa supervisora eliminada correctamente")):b?.("error","La eliminación de consorcios aún no está implementada")}catch(P){const M=P instanceof Error?P.message:"Error al eliminar";b?.("error",M)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-green-900",children:"Empresas Supervisoras"})]}),e.jsx("p",{className:"text-green-700 ml-13",children:"Gestión de empresas consultoras especializadas en supervisión y control de obras"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>d(),className:"flex items-center gap-2 px-4 py-2 bg-green-100 hover:bg-green-200 text-green-700 border border-green-300 rounded-lg transition-colors",children:[e.jsx(le,{className:"w-5 h-5"}),"Nueva Empresa Supervisora"]})})]}),e.jsx(Pa,{tipo:"supervisoras",onNavigate:D=>{D==="dashboard"&&s()}}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(ke,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:u.totalSupervisoras}),e.jsx("p",{className:"text-sm text-green-700",children:"Total Supervisoras"})]})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:u.empresasSupervisoras}),e.jsx("p",{className:"text-sm text-green-700",children:"Empresas Supervisoras"})]})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:u.activasSupervisoras}),e.jsx("p",{className:"text-sm text-green-700",children:"Activas"})]})]})})]}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Rol de las Empresas Supervisoras"}),e.jsx("p",{className:"text-green-700 mb-4",children:"Las empresas supervisoras son responsables del control técnico, seguimiento y verificación del cumplimiento de especificaciones técnicas durante la ejecución de obras públicas."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Control de calidad en obra"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Verificación de especificaciones técnicas"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Seguimiento de cronogramas"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Emisión de informes técnicos"})]})]})]})]})}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Error al cargar empresas supervisoras: ",f]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-green-200",children:[e.jsxs("div",{className:"border-b border-green-100 bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ha,{className:"w-5 h-5 text-green-600"}),e.jsx("h2",{className:"text-lg font-semibold text-green-900",children:"Registro de Empresas Supervisoras"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Empresas consultoras y consorcios certificados para supervisión de obras públicas"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ca,{entidades:a,loading:x,filtros:p,onFiltrosChange:h,onVerDetalle:A,onEditar:d,onEliminar:O})})]}),e.jsx(Aa,{isOpen:_==="empresa",onClose:y,onSubmit:k,empresa:r||void 0,loading:N,title:r?"Editar Empresa Supervisora":"Nueva Empresa Supervisora"}),e.jsx(Sa,{entidad:i,isOpen:_==="detalle",onClose:y,onEditar:()=>{i&&(y(),d(i))}})]})};var Os="Tabs",[yr,Kr]=dt(Os,[ga]),Da=ga(),[vr,Ys]=yr(Os),Ra=o.forwardRef((s,b)=>{const{__scopeTabs:j,value:x,onValueChange:f,defaultValue:n,orientation:l="horizontal",dir:N,activationMode:_="automatic",...w}=s,i=ot(N),[t,r]=ct({prop:x,onChange:f,defaultProp:n??"",caller:Os});return e.jsx(vr,{scope:j,baseId:mt(),value:t,onValueChange:r,orientation:l,dir:i,activationMode:_,children:e.jsx(Ss.div,{dir:i,"data-orientation":l,...w,ref:b})})});Ra.displayName=Os;var Oa="TabsList",Ia=o.forwardRef((s,b)=>{const{__scopeTabs:j,loop:x=!0,...f}=s,n=Ys(Oa,j),l=Da(j);return e.jsx(xt,{asChild:!0,...l,orientation:n.orientation,dir:n.dir,loop:x,children:e.jsx(Ss.div,{role:"tablist","aria-orientation":n.orientation,...f,ref:b})})});Ia.displayName=Oa;var ka="TabsTrigger",Ta=o.forwardRef((s,b)=>{const{__scopeTabs:j,value:x,disabled:f=!1,...n}=s,l=Ys(ka,j),N=Da(j),_=La(l.baseId,x),w=Fa(l.baseId,x),i=x===l.value;return e.jsx(ut,{asChild:!0,...N,focusable:!f,active:i,children:e.jsx(Ss.button,{type:"button",role:"tab","aria-selected":i,"aria-controls":w,"data-state":i?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:_,...n,ref:b,onMouseDown:ks(s.onMouseDown,t=>{!f&&t.button===0&&t.ctrlKey===!1?l.onValueChange(x):t.preventDefault()}),onKeyDown:ks(s.onKeyDown,t=>{[" ","Enter"].includes(t.key)&&l.onValueChange(x)}),onFocus:ks(s.onFocus,()=>{const t=l.activationMode!=="manual";!i&&!f&&t&&l.onValueChange(x)})})})});Ta.displayName=ka;var Ma="TabsContent",za=o.forwardRef((s,b)=>{const{__scopeTabs:j,value:x,forceMount:f,children:n,...l}=s,N=Ys(Ma,j),_=La(N.baseId,x),w=Fa(N.baseId,x),i=x===N.value,t=o.useRef(i);return o.useEffect(()=>{const r=requestAnimationFrame(()=>t.current=!1);return()=>cancelAnimationFrame(r)},[]),e.jsx(pt,{present:f||i,children:({present:r})=>e.jsx(Ss.div,{"data-state":i?"active":"inactive","data-orientation":N.orientation,role:"tabpanel","aria-labelledby":_,hidden:!r,id:w,tabIndex:0,...l,ref:b,style:{...s.style,animationDuration:t.current?"0s":void 0},children:r&&n})})});za.displayName=Ma;function La(s,b){return`${s}-trigger-${b}`}function Fa(s,b){return`${s}-content-${b}`}var Va=Ra,$a=Ia,Le=Ta,Fe=za;const wr=({obraId:s,profesionales:b,onProfesionalesChange:j,fechaInicio:x,fechaFin:f,readonly:n=!1,className:l=""})=>{const{profesiones:N}=mr(),{verificarDisponibilidad:_}=wa();Ea();const[w,i]=o.useState([]),[t,r]=o.useState(!1),[c,p]=o.useState(null),[h,a]=o.useState({});o.useEffect(()=>{const E=b.map((m,g)=>({...m,id:`prof-${g}`,isEditing:!1,errors:{}}));i(E)},[b]);const u=()=>({id:`new-${Date.now()}`,profesion_id:0,nombre_completo:"",numero_colegiatura:"",dni:"",telefono:"",email:"",porcentaje_participacion:0,fecha_inicio_participacion:x,fecha_fin_participacion:f,cargo:"",responsabilidades:[],observaciones:"",isEditing:!0,errors:{}}),d=async E=>{const m={};return E.profesion_id||(m.profesion_id="Debe seleccionar una profesión"),E.nombre_completo.trim()||(m.nombre_completo="El nombre completo es obligatorio"),(E.porcentaje_participacion<=0||E.porcentaje_participacion>100)&&(m.porcentaje_participacion="El porcentaje debe estar entre 1 y 100"),E.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E.email)&&(m.email="Formato de email inválido"),E.dni&&(E.dni.length!==8||!/^\d{8}$/.test(E.dni))&&(m.dni="El DNI debe tener 8 dígitos"),E.telefono&&(E.telefono.length<7||E.telefono.length>15)&&(m.telefono="El teléfono debe tener entre 7 y 15 dígitos"),m},A=async E=>{if(!(!E.nombre_completo.trim()||E.porcentaje_participacion!==100)){a(m=>({...m,[E.id]:!0}));try{const m=await _(E.nombre_completo,E.fecha_inicio_participacion,E.fecha_fin_participacion||f,s);i(g=>g.map(T=>T.id===E.id?{...T,disponibilidad:m}:T))}catch(m){console.error("Error verificando disponibilidad:",m)}finally{a(m=>({...m,[E.id]:!1}))}}},y=()=>{const E=u();i(m=>[...m,E]),r(!0),p(E.id)},k=async E=>{const m=w.find(I=>I.id===E);if(!m)return;const g=await d(m);if(Object.keys(g).length>0){i(I=>I.map(F=>F.id===E?{...F,errors:g}:F));return}if(m.porcentaje_participacion===100){await A(m);const I=w.find(F=>F.id===E);I?.disponibilidad&&I.disponibilidad.disponible}const T=w.map(I=>I.id===E?{...I,isEditing:!1,errors:{}}:I);i(T),p(null),r(!1);const V=T.filter(I=>!I.id?.startsWith("new-")).map(({id:I,isEditing:F,errors:L,disponibilidad:U,...q})=>q);j(V)},O=E=>{i(m=>m.map(g=>g.id===E?{...g,isEditing:!0,errors:{}}:g)),p(E),r(!0)},D=E=>{w.find(g=>g.id===E)?.id?.startsWith("new-")?i(g=>g.filter(T=>T.id!==E)):i(g=>g.map(T=>T.id===E?{...T,isEditing:!1,errors:{}}:T)),p(null),r(!1)},C=E=>{const m=w.find(g=>g.id===E);if(m&&confirm(`¿Estás seguro de que quieres eliminar a ${m.nombre_completo}?`)){const g=w.filter(V=>V.id!==E);i(g);const T=g.filter(V=>!V.id?.startsWith("new-")).map(({id:V,isEditing:I,errors:F,disponibilidad:L,...U})=>U);j(T)}},P=(E,m,g)=>{i(T=>T.map(V=>V.id===E?{...V,[m]:g,errors:{...V.errors,[m]:void 0}}:V)),(m==="nombre_completo"||m==="porcentaje_participacion")&&setTimeout(()=>{const T=w.find(V=>V.id===E);T&&T.porcentaje_participacion===100&&A({...T,[m]:g})},500)},M=w.reduce((E,m)=>E+m.porcentaje_participacion,0),v=w.filter(E=>E.disponibilidad&&!E.disponibilidad.disponible).length,R=E=>{const m=N.find(g=>g.id===E);return m?m.nombre:"Profesión no encontrada"};return e.jsxs("div",{className:`space-y-6 ${l}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Plantel Profesional"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Asignación de profesionales responsables de la obra"})]}),!n&&e.jsxs("button",{type:"button",onClick:y,className:"btn-primary flex items-center gap-2",disabled:t,children:[e.jsx(Oe,{className:"w-4 h-4"}),"Agregar Profesional"]})]}),w.length>0&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[w.length," Profesional",w.length!==1?"es":""]})]})}),e.jsx("div",{className:`rounded-lg p-4 ${M>100?"bg-red-50":M<100?"bg-yellow-50":"bg-green-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:`w-5 h-5 ${M>100?"text-red-600":M<100?"text-yellow-600":"text-green-600"}`}),e.jsxs("span",{className:`font-medium ${M>100?"text-red-900":M<100?"text-yellow-900":"text-green-900"}`,children:[M,"% Total"]})]})}),v>0&&e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:[v," Conflicto",v!==1?"s":""]})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(we,{children:w.map(E=>e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:E.isEditing?e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profesión *"}),e.jsxs("select",{value:E.profesion_id,onChange:m=>P(E.id,"profesion_id",parseInt(m.target.value)),className:`input-field ${E.errors?.profesion_id?"border-red-300":""}`,children:[e.jsx("option",{value:0,children:"Seleccionar profesión"}),N.map(m=>e.jsxs("option",{value:m.id,children:[m.nombre," (",m.abreviatura,")"]},m.id))]}),E.errors?.profesion_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.profesion_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre Completo *"}),e.jsx("input",{type:"text",value:E.nombre_completo,onChange:m=>P(E.id,"nombre_completo",m.target.value),className:`input-field ${E.errors?.nombre_completo?"border-red-300":""}`,placeholder:"Nombres y apellidos completos"}),E.errors?.nombre_completo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.nombre_completo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N° Colegiatura"}),e.jsx("input",{type:"text",value:E.numero_colegiatura||"",onChange:m=>P(E.id,"numero_colegiatura",m.target.value),className:"input-field",placeholder:"CIP-12345"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DNI"}),e.jsx("input",{type:"text",value:E.dni||"",onChange:m=>P(E.id,"dni",m.target.value),className:`input-field ${E.errors?.dni?"border-red-300":""}`,placeholder:"12345678",maxLength:8}),E.errors?.dni&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.dni})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono"}),e.jsx("input",{type:"tel",value:E.telefono||"",onChange:m=>P(E.id,"telefono",m.target.value),className:`input-field ${E.errors?.telefono?"border-red-300":""}`,placeholder:"987654321"}),E.errors?.telefono&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.telefono})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:E.email||"",onChange:m=>P(E.id,"email",m.target.value),className:`input-field ${E.errors?.email?"border-red-300":""}`,placeholder:"profesional@email.com"}),E.errors?.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Porcentaje de Participación * ",h[E.id]&&"(Verificando...)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"1",max:"100",value:E.porcentaje_participacion,onChange:m=>P(E.id,"porcentaje_participacion",parseFloat(m.target.value)||0),className:`input-field pr-8 ${E.errors?.porcentaje_participacion?"border-red-300":""}`,placeholder:"100"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),E.errors?.porcentaje_participacion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.errors.porcentaje_participacion})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cargo"}),e.jsx("input",{type:"text",value:E.cargo||"",onChange:m=>P(E.id,"cargo",m.target.value),className:"input-field",placeholder:"Residente de Obra"})]})]}),E.disponibilidad&&!E.disponibilidad.disponible&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-900",children:"Conflicto de Disponibilidad"}),e.jsx("p",{className:"text-sm text-orange-800 mt-1",children:"Este profesional ya tiene 100% de participación en las siguientes obras:"}),e.jsx("ul",{className:"text-sm text-orange-800 mt-2 space-y-1",children:E.disponibilidad.conflictos.map((m,g)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-orange-600 rounded-full flex-shrink-0"}),e.jsxs("span",{children:[m.obra_nombre," (",m.numero_contrato,") - ",m.fecha_inicio," a ",m.fecha_fin_prevista]})]},g))})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{type:"button",onClick:()=>k(E.id),className:"btn-primary flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Guardar"]}),e.jsxs("button",{type:"button",onClick:()=>D(E.id),className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Cancelar"]})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:E.nombre_completo}),e.jsx("p",{className:"text-sm text-gray-600",children:R(E.profesion_id)}),E.cargo&&e.jsx("p",{className:"text-sm text-gray-600",children:E.cargo})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:[E.porcentaje_participacion,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Participación"})]}),E.disponibilidad&&e.jsx("div",{className:"flex items-center gap-1",children:E.disponibilidad.disponible?e.jsx(Qs,{className:"w-4 h-4 text-green-600"}):e.jsx(Q,{className:"w-4 h-4 text-orange-600"})}),!n&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>O(E.id),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>C(E.id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Cs,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-600",children:[E.numero_colegiatura&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Colegiatura:"})," ",E.numero_colegiatura]}),E.dni&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"DNI:"})," ",E.dni]}),E.telefono&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),E.telefono]}),E.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),E.email]})]})]})},E.id))})}),w.length===0&&!t&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin profesionales asignados"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Agrega profesionales al plantel técnico de la obra"}),!n&&e.jsxs("button",{type:"button",onClick:y,className:"btn-primary flex items-center gap-2 mx-auto",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Agregar Primer Profesional"]})]})]})},Er=({isOpen:s,onClose:b,onSubmit:j,obra:x,loading:f=!1,title:n="Nueva Obra"})=>{const{entidades:l}=Te(),{validarObraForm:N}=Ea(),[_,w]=o.useState("general"),[i,t]=o.useState({numero_contrato:"",nombre:"",codigo_interno:"",entidad_ejecutora_id:0,entidad_supervisora_id:0,monto_ejecucion:0,monto_supervision:0,plazo_ejecucion_dias:0,fecha_inicio:"",fecha_termino:"",ubicacion:"",distrito:"",provincia:"Lima",departamento:"Lima",tipo_obra:void 0,modalidad_ejecucion:"CONTRATA",sistema_contratacion:"SUMA_ALZADA",descripcion:"",observaciones:"",errors:{}}),[r,c]=o.useState([]),[p,h]=o.useState(null);o.useEffect(()=>{x&&s?(t({...x,provincia:x.provincia||"Lima",departamento:x.departamento||"Lima",modalidad_ejecucion:x.modalidad_ejecucion||"CONTRATA",sistema_contratacion:x.sistema_contratacion||"SUMA_ALZADA",errors:{}}),x.numero_contrato||c([])):s&&(t({numero_contrato:"",nombre:"",codigo_interno:"",entidad_ejecutora_id:0,entidad_supervisora_id:0,monto_ejecucion:0,monto_supervision:0,plazo_ejecucion_dias:0,fecha_inicio:"",fecha_termino:"",ubicacion:"",distrito:"",provincia:"Lima",departamento:"Lima",tipo_obra:void 0,modalidad_ejecucion:"CONTRATA",sistema_contratacion:"SUMA_ALZADA",descripcion:"",observaciones:"",errors:{}}),c([])),s&&setTimeout(()=>{const m=document.querySelector("#numero_contrato_input");m&&m.focus()},100)},[x,s]),o.useEffect(()=>{const m=g=>{g.key==="Escape"&&s&&b()};return s&&(document.addEventListener("keydown",m),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",m),document.body.style.overflow="unset"}},[s,b]);const a=(m,g)=>{h({tipo:m,texto:g}),setTimeout(()=>h(null),5e3)},u=(m,g)=>{t(T=>{const V={...T.errors};delete V[m];let I={...T,[m]:g,errors:V};if(m==="fecha_contrato"&&g){const F=new Date(g),L=new Date("2025-04-22");I.ley_aplicable=F>=L?"LEY_32069":"LEY_30225",T.ley_aplicable!==I.ley_aplicable&&(I.procedimiento_seleccion=void 0)}return I})},d=()=>{const m=N(i),g={};return m.errores.forEach(T=>{g[T.campo]=T.mensaje}),t(T=>({...T,errors:g})),m.valido},A=m=>Math.ceil(m/30),y=(m,g)=>{if(!m||!g)return"";const T=new Date(m);return T.setDate(T.getDate()+g),T.toISOString().split("T")[0]},k=()=>i.monto_ejecucion+i.monto_supervision,O=()=>i.ley_aplicable==="LEY_32069"?or:i.ley_aplicable==="LEY_30225"?lr:{},D=(m,g)=>({CARRETERA:["PRECIOS_UNITARIOS","SUMA_ALZADA"],EDIFICACION:["SUMA_ALZADA","PRECIOS_UNITARIOS","LLAVE_EN_MANO"],SANEAMIENTO:["PRECIOS_UNITARIOS","SUMA_ALZADA"],ELECTRICIDAD:["SUMA_ALZADA","PRECIOS_UNITARIOS"],PUENTE:["SUMA_ALZADA","PRECIOS_UNITARIOS"],VEREDAS_PISTAS:["SUMA_ALZADA","PRECIOS_UNITARIOS"],PARQUES_JARDINES:["SUMA_ALZADA","PRECIOS_UNITARIOS"],DRENAJE_PLUVIAL:["PRECIOS_UNITARIOS","SUMA_ALZADA"],OTROS:["SUMA_ALZADA","PRECIOS_UNITARIOS","LLAVE_EN_MANO"]})[g]?.includes(m)??!0,C=async m=>{if(m.preventDefault(),!d()){a("error","Por favor corrige los errores en el formulario");return}try{const{errors:g,...T}=i;await j({obra:T,plantel_profesional:r}),a("success","Obra creada correctamente"),setTimeout(b,1e3)}catch(g){const T=g instanceof Error?g.message:"Error al crear obra";a("error",T)}},P=()=>{const g=`N.º 01-${new Date().getFullYear()}-MDSM/GM`;u("numero_contrato",g)},M=()=>{const m=Math.round(i.monto_ejecucion*.1);u("monto_supervision",m)};if(!s)return null;const v=y(i.fecha_inicio,i.plazo_ejecucion_dias),R=A(i.plazo_ejecucion_dias),E=k();return e.jsx("div",{className:"fixed inset-0 z-[9999] overflow-y-auto",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 transition-opacity",onClick:b,"aria-hidden":"true"}),e.jsx("div",{className:"inline-block w-full max-w-6xl my-8 text-left align-middle transition-all transform relative z-10",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white shadow-2xl rounded-lg px-6 py-4 relative overflow-hidden",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-6 h-6 text-primary-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n})]}),e.jsx("button",{onClick:b,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),p&&e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`mb-4 p-4 rounded-lg flex items-center gap-3 ${p.tipo==="success"?"bg-green-50 border border-green-200 text-green-800":p.tipo==="warning"?"bg-yellow-50 border border-yellow-200 text-yellow-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[p.tipo==="success"?e.jsx(B,{className:"w-5 h-5 text-green-600"}):e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:p.texto})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs(Va,{value:_,onValueChange:w,children:[e.jsxs($a,{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-6",children:[e.jsxs(Le,{value:"general",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Información General"]}),e.jsxs(Le,{value:"financiero",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Información Financiera"]}),e.jsxs(Le,{value:"cronograma",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Cronograma"]}),e.jsxs(Le,{value:"plantel",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Plantel Profesional"]})]}),e.jsxs(Fe,{value:"general",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número de Contrato *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"numero_contrato_input",type:"text",value:i.numero_contrato,onChange:m=>u("numero_contrato",m.target.value),className:`input-field flex-1 ${i.errors.numero_contrato?"border-red-300":""}`,placeholder:ws.ejemplo,autoComplete:"off"}),e.jsx("button",{type:"button",onClick:P,className:"btn-secondary px-3",title:"Generar número sugerido",children:e.jsx(je,{className:"w-4 h-4"})})]}),i.errors.numero_contrato&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.numero_contrato}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Formato: ",ws.formato]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Obra *"}),e.jsx("input",{type:"text",value:i.nombre,onChange:m=>u("nombre",m.target.value),className:`input-field ${i.errors.nombre?"border-red-300":""}`,placeholder:"Nombre completo y descriptivo de la obra"}),i.errors.nombre&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.nombre})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código Interno"}),e.jsx("input",{type:"text",value:i.codigo_interno||"",onChange:m=>u("codigo_interno",m.target.value),className:"input-field",placeholder:"OBR001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Obra"}),e.jsxs("select",{value:i.tipo_obra||"",onChange:m=>u("tipo_obra",m.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"Seleccionar tipo de obra"}),Object.entries(Ks).map(([m,g])=>e.jsx("option",{value:m,children:g},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modalidad de Ejecución"}),e.jsx("select",{value:i.modalidad_ejecucion,onChange:m=>u("modalidad_ejecucion",m.target.value),className:"input-field",children:Object.entries(nr).map(([m,g])=>e.jsx("option",{value:m,children:g},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Contrato *"}),e.jsx("input",{type:"date",value:i.fecha_contrato,onChange:m=>u("fecha_contrato",m.target.value),className:`input-field ${i.errors.fecha_contrato?"border-red-300":""}`}),i.errors.fecha_contrato&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.fecha_contrato}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Determina automáticamente la ley aplicable"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:[e.jsx(gt,{className:"w-5 h-5 inline mr-2"}),"Normativa de Contratación Pública"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ley Aplicable",e.jsx(bt,{className:"w-4 h-4 inline ml-1 text-gray-400"})]}),e.jsx("div",{className:`input-field bg-gray-50 border-dashed ${i.ley_aplicable==="LEY_32069"?"border-green-300 text-green-800 bg-green-50":"border-blue-300 text-blue-800 bg-blue-50"}`,children:i.ley_aplicable?oa[i.ley_aplicable]:"Seleccione fecha de contrato"}),i.fecha_contrato&&e.jsx("p",{className:`text-xs mt-1 ${i.ley_aplicable==="LEY_32069"?"text-green-600":"text-blue-600"}`,children:i.ley_aplicable==="LEY_32069"?"✓ Nueva ley desde 22/04/2025":"ℹ Ley anterior al 22/04/2025"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Procedimiento de Selección"}),e.jsxs("select",{value:i.procedimiento_seleccion||"",onChange:m=>u("procedimiento_seleccion",m.target.value),className:`input-field ${i.ley_aplicable?"":"bg-gray-50 text-gray-400"}`,disabled:!i.ley_aplicable,children:[e.jsx("option",{value:"",children:i.ley_aplicable?"Seleccionar procedimiento":"Primero seleccione fecha de contrato"}),Object.entries(O()).map(([m,g])=>e.jsx("option",{value:m,children:g},m))]}),i.ley_aplicable&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Procedimientos disponibles según ",oa[i.ley_aplicable]]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Sistema de Contratación"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sistema de Contratación *"}),e.jsx("select",{value:i.sistema_contratacion,onChange:m=>u("sistema_contratacion",m.target.value),className:`input-field ${i.tipo_obra&&i.sistema_contratacion&&!D(i.sistema_contratacion,i.tipo_obra)?"border-yellow-300 bg-yellow-50":""}`,children:Object.entries(la).map(([m,g])=>e.jsx("option",{value:m,children:g},m))}),i.sistema_contratacion&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium mb-1",children:la[i.sistema_contratacion]}),e.jsx("p",{className:"text-xs text-blue-700",children:cr[i.sistema_contratacion]||"Información no disponible"})]}),i.tipo_obra&&i.sistema_contratacion&&!D(i.sistema_contratacion,i.tipo_obra)&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[e.jsxs("p",{className:"text-sm text-yellow-800 font-medium flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Revise la coherencia"]}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Este sistema de contratación puede no ser el más adecuado para el tipo de obra seleccionado."})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Entidades Contratistas"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entidad Ejecutora *"}),e.jsxs("select",{value:i.entidad_ejecutora_id,onChange:m=>u("entidad_ejecutora_id",parseInt(m.target.value)),className:`input-field ${i.errors.entidad_ejecutora_id?"border-red-300":""}`,children:[e.jsx("option",{value:0,children:"Seleccionar entidad ejecutora"}),l.map(m=>e.jsxs("option",{value:m.id,children:[m.nombre_completo," (",m.tipo_entidad,")"]},m.id))]}),i.errors.entidad_ejecutora_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.entidad_ejecutora_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entidad Supervisora *"}),e.jsxs("select",{value:i.entidad_supervisora_id,onChange:m=>u("entidad_supervisora_id",parseInt(m.target.value)),className:`input-field ${i.errors.entidad_supervisora_id?"border-red-300":""}`,children:[e.jsx("option",{value:0,children:"Seleccionar entidad supervisora"}),l.filter(m=>m.id!==i.entidad_ejecutora_id).map(m=>e.jsxs("option",{value:m.id,children:[m.nombre_completo," (",m.tipo_entidad,")"]},m.id))]}),i.errors.entidad_supervisora_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.entidad_supervisora_id})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:[e.jsx(Ee,{className:"w-5 h-5 inline mr-2"}),"Ubicación"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departamento"}),e.jsx("input",{type:"text",value:i.departamento,onChange:m=>u("departamento",m.target.value),className:"input-field",placeholder:"Lima"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provincia"}),e.jsx("input",{type:"text",value:i.provincia,onChange:m=>u("provincia",m.target.value),className:"input-field",placeholder:"Lima"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Distrito"}),e.jsx("input",{type:"text",value:i.distrito,onChange:m=>u("distrito",m.target.value),className:"input-field",placeholder:"San Martín de Porres"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubicación Específica"}),e.jsx("textarea",{value:i.ubicacion||"",onChange:m=>u("ubicacion",m.target.value),className:"input-field",rows:2,placeholder:"Descripción detallada de la ubicación de la obra"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción de la Obra"}),e.jsx("textarea",{value:i.descripcion||"",onChange:m=>u("descripcion",m.target.value),className:"input-field",rows:4,placeholder:"Descripción técnica detallada de la obra, objetivos y alcance"})]})]}),e.jsx(Fe,{value:"financiero",className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:[e.jsx(ie,{className:"w-5 h-5 inline mr-2"}),"Montos del Contrato"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monto de Ejecución (S/) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:i.monto_ejecucion,onChange:m=>u("monto_ejecucion",parseFloat(m.target.value)||0),className:`input-field pl-10 ${i.errors.monto_ejecucion?"border-red-300":""}`,placeholder:"0.00"})]}),i.errors.monto_ejecucion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.monto_ejecucion})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monto de Supervisión (S/) *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:i.monto_supervision,onChange:m=>u("monto_supervision",parseFloat(m.target.value)||0),className:`input-field pl-10 ${i.errors.monto_supervision?"border-red-300":""}`,placeholder:"0.00"})]}),e.jsx("button",{type:"button",onClick:M,className:"btn-secondary px-3",title:"Calcular 10% del monto de ejecución",children:"10%"})]}),i.errors.monto_supervision&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.monto_supervision})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Resumen Financiero"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Monto de Ejecución:"}),e.jsxs("span",{className:"font-medium",children:["S/ ",i.monto_ejecucion.toLocaleString("es-PE",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Monto de Supervisión:"}),e.jsxs("span",{className:"font-medium",children:["S/ ",i.monto_supervision.toLocaleString("es-PE",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-2",children:e.jsxs("div",{className:"flex justify-between text-base font-semibold",children:[e.jsx("span",{className:"text-gray-900",children:"Monto Total:"}),e.jsxs("span",{className:"text-primary-600",children:["S/ ",E.toLocaleString("es-PE",{minimumFractionDigits:2})]})]})})]}),i.monto_supervision>0&&i.monto_ejecucion>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-300",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Porcentaje de supervisión: ",e.jsxs("span",{className:"font-medium",children:[(i.monto_supervision/i.monto_ejecucion*100).toFixed(1),"%"]}),i.monto_supervision/i.monto_ejecucion>.2&&e.jsx("span",{className:"ml-2 text-yellow-600",children:"(Excede recomendación del 20%)"})]})})]})]})}),e.jsx(Fe,{value:"cronograma",className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:[e.jsx(X,{className:"w-5 h-5 inline mr-2"}),"Programación de la Obra"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio de Obra *"}),e.jsx("input",{type:"date",value:i.fecha_inicio,onChange:m=>u("fecha_inicio",m.target.value),className:`input-field ${i.errors.fecha_inicio?"border-red-300":""}`,min:i.fecha_contrato||new Date().toISOString().split("T")[0]}),i.errors.fecha_inicio&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.fecha_inicio}),i.fecha_contrato&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"No puede ser anterior a la fecha del contrato"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plazo de Ejecución (días) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"1",value:i.plazo_ejecucion_dias,onChange:m=>u("plazo_ejecucion_dias",parseInt(m.target.value)||0),className:`input-field pr-12 ${i.errors.plazo_ejecucion_dias?"border-red-300":""}`,placeholder:"180"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"días"})]}),i.errors.plazo_ejecucion_dias&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.plazo_ejecucion_dias})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Término/Culminación"}),e.jsx("input",{type:"date",value:i.fecha_termino||"",onChange:m=>u("fecha_termino",m.target.value),className:`input-field ${i.errors.fecha_termino?"border-red-300":""}`,min:i.fecha_inicio||new Date().toISOString().split("T")[0]}),i.errors.fecha_termino&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.errors.fecha_termino}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Fecha planificada de término de la obra (opcional)"})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsxs("h4",{className:"font-medium text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Información Calculada"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-700",children:"Fecha de Fin Prevista"}),e.jsx("div",{className:"font-semibold text-blue-900",children:v?new Date(v).toLocaleDateString("es-PE"):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-700",children:"Número de Valorizaciones"}),e.jsx("div",{className:"font-semibold text-blue-900",children:R||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-700",children:"Plazo en Meses"}),e.jsx("div",{className:"font-semibold text-blue-900",children:i.plazo_ejecucion_dias?(i.plazo_ejecucion_dias/30).toFixed(1):"0"})]})]}),R>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsxs("div",{className:"text-sm text-blue-700 mb-2",children:["Se generarán ",R," valorizaciones programadas automáticamente"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"* Una valorización cada 30 días calendario"})]})]})]})}),e.jsx(Fe,{value:"plantel",className:"space-y-6",children:e.jsx(wr,{profesionales:r,onProfesionalesChange:c,fechaInicio:i.fecha_inicio,fechaFin:v})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observaciones Generales"}),e.jsx("textarea",{value:i.observaciones||"",onChange:m=>u("observaciones",m.target.value),className:"input-field",rows:3,placeholder:"Observaciones adicionales sobre la obra"})]}),e.jsxs("div",{className:"flex gap-4 mt-8 pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"submit",disabled:f,className:"btn-primary flex items-center gap-2 min-w-[120px] justify-center",children:[f?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(B,{className:"w-4 h-4"}),f?"Creando...":"Crear Obra"]}),e.jsx("button",{type:"button",onClick:b,className:"btn-secondary",disabled:f,children:"Cancelar"})]})]})]})})]})})},_r=({obraId:s,isOpen:b,onClose:j,onEditar:x})=>{const{obtenerObraPorId:f}=Me(),{profesionales:n,cargarProfesionalesPorObra:l}=wa(),{valorizaciones:N,cargarValorizacionesPorObra:_}=xr(),{entidades:w}=Te(),[i,t]=o.useState("general"),[r,c]=o.useState(null),[p,h]=o.useState(!1);if(o.useEffect(()=>{s&&b&&(h(!0),f(s).then(v=>{c(v)}).catch(v=>{console.error("Error cargando obra:",v)}),l(s),_(s),h(!1))},[s,b,f,l,_]),!b||!r)return null;const a=w.find(v=>v.id===r.entidad_ejecutora_id),u=w.find(v=>v.id===r.entidad_supervisora_id),A=(v=>{switch(v){case"REGISTRADA":return{color:"text-gray-700 bg-gray-100",icon:H};case"EN_EJECUCION":return{color:"text-blue-700 bg-blue-100",icon:Pe};case"PARALIZADA":return{color:"text-yellow-700 bg-yellow-100",icon:Y};case"TERMINADA":return{color:"text-green-700 bg-green-100",icon:B};case"LIQUIDADA":return{color:"text-purple-700 bg-purple-100",icon:je};case"CANCELADA":return{color:"text-red-700 bg-red-100",icon:Y};default:return{color:"text-gray-700 bg-gray-100",icon:H}}})(r.estado),y=A.icon,k=Math.floor((new Date().getTime()-new Date(r.fecha_inicio).getTime())/(1e3*60*60*24)),O=Math.min(k/r.plazo_ejecucion_dias*100,100),D=N.filter(v=>v.estado==="APROBADA").reduce((v,R)=>v+R.monto_ejecutado,0),C=D/r.monto_ejecucion*100,P=v=>`S/ ${v.toLocaleString("es-PE",{minimumFractionDigits:2})}`,M=Math.max(0,r.plazo_ejecucion_dias-k);return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:j}),e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"inline-block w-full max-w-7xl px-6 py-4 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Pe,{className:"w-6 h-6 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-primary-600 bg-primary-50 px-3 py-1 rounded-full",children:r.numero_contrato}),e.jsxs("span",{className:`px-3 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${A.color}`,children:[e.jsx(y,{className:"w-3 h-3"}),$s[r.estado]]})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:r.nombre}),r.codigo_interno&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Código Interno: ",r.codigo_interno]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[x&&e.jsxs("button",{onClick:()=>x(r.id),className:"btn-secondary flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Editar"]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ie,{className:"w-5 h-5"})})]})]}),p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-primary-50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"w-8 h-8 text-primary-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-primary-900",children:P(r.monto_total)}),e.jsx("p",{className:"text-sm text-primary-700",children:"Inversión Total"})]})]}),e.jsxs("div",{className:"text-xs text-primary-600 mt-2",children:["Ejecución: ",P(r.monto_ejecucion)," | Supervisión: ",P(r.monto_supervision)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(X,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-blue-900",children:r.plazo_ejecucion_dias}),e.jsx("p",{className:"text-sm text-blue-700",children:"Días de Plazo"})]})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:["Inicio: ",new Date(r.fecha_inicio).toLocaleDateString("es-PE")]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(oe,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-900",children:[O.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Progreso Tiempo"})]})]}),e.jsxs("div",{className:"text-xs text-green-600 mt-2",children:[M," días restantes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ve,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-purple-900",children:r.numero_valorizaciones}),e.jsx("p",{className:"text-sm text-purple-700",children:"Valorizaciones"})]})]}),e.jsxs("div",{className:"text-xs text-purple-600 mt-2",children:[N.filter(v=>v.estado==="APROBADA").length," aprobadas"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Avance General de la Obra"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:[C.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Avance Financiero"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progreso Financiero"}),e.jsx("span",{className:"text-sm text-gray-900",children:P(D)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-300",style:{width:`${Math.min(C,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progreso de Tiempo"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[k," / ",r.plazo_ejecucion_dias," días"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${O>C?"bg-yellow-500":"bg-blue-500"}`,style:{width:`${Math.min(O,100)}%`}})})]})]}),Math.abs(O-C)>10&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:O>C?"El avance financiero está rezagado respecto al cronograma":"El avance financiero está adelantado respecto al cronograma"})]})})]}),e.jsxs(Va,{value:i,onValueChange:t,children:[e.jsxs($a,{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-6",children:[e.jsxs(Le,{value:"general",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Información General"]}),e.jsxs(Le,{value:"entidades",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Entidades"]}),e.jsxs(Le,{value:"plantel",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Plantel (",n.length,")"]}),e.jsxs(Le,{value:"valorizaciones",className:"flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-gray-900 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Valorizaciones (",N.length,")"]})]}),e.jsxs(Fe,{value:"general",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Detalles de la Obra"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Je,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Tipo de Obra"}),e.jsx("p",{className:"text-gray-600",children:r.tipo_obra?Ks[r.tipo_obra]:"No especificado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(us,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Modalidad de Ejecución"}),e.jsx("p",{className:"text-gray-600",children:r.modalidad_ejecucion||"No especificado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Sistema de Contratación"}),e.jsx("p",{className:"text-gray-600",children:r.sistema_contratacion||"No especificado"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ubicación"}),e.jsxs("div",{className:"space-y-3",children:[r.ubicacion&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Ubicación Específica"}),e.jsx("p",{className:"text-gray-600",children:r.ubicacion})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Departamento"}),e.jsx("p",{className:"text-gray-600",children:r.departamento||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Provincia"}),e.jsx("p",{className:"text-gray-600",children:r.provincia||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Distrito"}),e.jsx("p",{className:"text-gray-600",children:r.distrito||"No especificado"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Cronograma"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Fecha de Inicio"}),e.jsx("span",{className:"text-gray-700",children:new Date(r.fecha_inicio).toLocaleDateString("es-PE")})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Fecha de Fin Prevista"}),e.jsx("span",{className:"text-gray-700",children:new Date(r.fecha_fin_prevista).toLocaleDateString("es-PE")})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Plazo Total"}),e.jsxs("span",{className:"text-gray-700",children:[r.plazo_ejecucion_dias," días"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Días Transcurridos"}),e.jsxs("span",{className:"text-gray-700",children:[k," días"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Días Restantes"}),e.jsxs("span",{className:`font-medium ${M<30?"text-red-600":M<90?"text-yellow-600":"text-green-600"}`,children:[M," días"]})]}),r.fecha_termino&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-lg border-2 border-purple-200",children:[e.jsx("span",{className:"font-medium text-purple-900",children:"Fecha de Término"}),e.jsx("span",{className:"text-purple-700 font-medium",children:new Date(r.fecha_termino).toLocaleDateString("es-PE")})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Presupuesto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Monto de Ejecución"}),e.jsx("span",{className:"font-bold text-green-700",children:P(r.monto_ejecucion)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Monto de Supervisión"}),e.jsx("span",{className:"font-bold text-blue-700",children:P(r.monto_supervision)})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-primary-50 rounded-lg border-2 border-primary-200",children:[e.jsx("span",{className:"font-bold text-primary-900",children:"Monto Total"}),e.jsx("span",{className:"font-bold text-primary-700 text-lg",children:P(r.monto_total)})]})]})]})]})]}),r.descripcion&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Descripción"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-4 rounded-lg",children:r.descripcion})]}),r.observaciones&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Observaciones"}),e.jsx("p",{className:"text-gray-700 bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:r.observaciones})]})]}),e.jsx(Fe,{value:"entidades",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Entidad Ejecutora"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Responsable de la ejecución"})]})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:a.nombre_completo}),e.jsx("p",{className:"text-blue-700 text-sm",children:a.tipo_entidad})]}),a.ruc_principal&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("span",{className:"font-medium",children:"RUC:"})," ",a.ruc_principal]})}),a.datos_empresa&&e.jsxs("div",{className:"space-y-2 text-sm",children:[a.datos_empresa.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:a.datos_empresa.email})]}),a.datos_empresa.telefono&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:a.datos_empresa.telefono})]}),a.datos_empresa.categoria_contratista&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["Categoría: ",a.datos_empresa.categoria_contratista]})]})]}),a.datos_consorcio&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-blue-700 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Empresa Líder:"})," ",a.datos_consorcio.empresa_lider_nombre]}),a.empresas_participantes&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-700 mb-1",children:"Empresas Participantes:"}),e.jsx("ul",{className:"space-y-1",children:a.empresas_participantes.map((v,R)=>e.jsxs("li",{className:"text-blue-600 text-xs",children:["• ",v.empresa_nombre," (",v.porcentaje_participacion,"%)"]},R))})]})]})]}):e.jsx("p",{className:"text-blue-600",children:"Información no disponible"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Entidad Supervisora"}),e.jsx("p",{className:"text-purple-700 text-sm",children:"Responsable de la supervisión"})]})]}),u?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:u.nombre_completo}),e.jsx("p",{className:"text-purple-700 text-sm",children:u.tipo_entidad})]}),u.ruc_principal&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-purple-700",children:[e.jsx("span",{className:"font-medium",children:"RUC:"})," ",u.ruc_principal]})}),u.datos_empresa&&e.jsxs("div",{className:"space-y-2 text-sm",children:[u.datos_empresa.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:u.datos_empresa.email})]}),u.datos_empresa.telefono&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:u.datos_empresa.telefono})]}),u.datos_empresa.categoria_contratista&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:["Categoría: ",u.datos_empresa.categoria_contratista]})]})]}),u.datos_consorcio&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-purple-700 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Empresa Líder:"})," ",u.datos_consorcio.empresa_lider_nombre]}),u.empresas_participantes&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-700 mb-1",children:"Empresas Participantes:"}),e.jsx("ul",{className:"space-y-1",children:u.empresas_participantes.map((v,R)=>e.jsxs("li",{className:"text-purple-600 text-xs",children:["• ",v.empresa_nombre," (",v.porcentaje_participacion,"%)"]},R))})]})]})]}):e.jsx("p",{className:"text-purple-600",children:"Información no disponible"})]})]})}),e.jsx(Fe,{value:"plantel",className:"space-y-6",children:n.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n.map(v=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:v.nombre_completo}),e.jsx("p",{className:"text-sm text-gray-600",children:v.cargo||"Cargo no especificado"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-lg font-bold text-primary-600",children:[v.porcentaje_participacion,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Participación"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[v.numero_colegiatura&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:["Colegiatura: ",v.numero_colegiatura]})]}),v.dni&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:["DNI: ",v.dni]})]}),v.telefono&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:v.telefono})]}),v.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:v.email})]}),v.responsabilidades&&v.responsabilidades.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"Responsabilidades:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-600",children:v.responsabilidades.map((R,E)=>e.jsx("li",{children:R},E))})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Desde: ",new Date(v.fecha_inicio_participacion).toLocaleDateString("es-PE")]}),e.jsx("span",{className:`px-2 py-1 rounded-full ${v.estado==="ACTIVO"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:v.estado})]})})]},v.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin plantel profesional asignado"}),e.jsx("p",{className:"text-gray-600",children:"No hay profesionales registrados para esta obra"})]})}),e.jsx(Fe,{value:"valorizaciones",className:"space-y-6",children:N.length>0?e.jsx("div",{className:"space-y-4",children:N.map(v=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Valorización N° ",v.numero_valorizacion]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Período: ",new Date(v.periodo_inicio).toLocaleDateString("es-PE")," - "," ",new Date(v.periodo_fin).toLocaleDateString("es-PE")]})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${v.estado==="APROBADA"?"bg-green-100 text-green-800":v.estado==="PAGADA"?"bg-blue-100 text-blue-800":v.estado==="EN_PROCESO"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:v.estado})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monto Ejecutado"}),e.jsx("p",{className:"font-bold text-gray-900",children:P(v.monto_ejecutado)})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"% Avance"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[v.porcentaje_avance,"%"]})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monto Acumulado"}),e.jsx("p",{className:"font-bold text-gray-900",children:P(v.monto_acumulado)})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"% Acumulado"}),e.jsxs("p",{className:"font-bold text-gray-900",children:[v.porcentaje_acumulado,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha Programada:"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(v.fecha_programada).toLocaleDateString("es-PE")})]}),v.fecha_presentacion&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha Presentación:"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(v.fecha_presentacion).toLocaleDateString("es-PE")})]}),v.fecha_aprobacion&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha Aprobación:"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(v.fecha_aprobacion).toLocaleDateString("es-PE")})]})]})]},v.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin valorizaciones registradas"}),e.jsx("p",{className:"text-gray-600",children:"Las valorizaciones se generarán automáticamente según el cronograma"})]})})]})]})]})]})})},Ar=()=>{const{obras:s,loading:b,error:j,cargarObras:x,crearObra:f}=Me(),{entidades:n}=Te(),[l,N]=o.useState(null),[_,w]=o.useState(null),[i,t]=o.useState(!1),[r,c]=o.useState(!1),[p,h]=o.useState(null),[a,u]=o.useState({search:"",estado:void 0,entidad_ejecutora_id:void 0,entidad_supervisora_id:void 0,tipo_obra:void 0}),d=(m,g)=>{h({tipo:m,texto:g}),setTimeout(()=>h(null),5e3)},A=()=>{N("crear")},y=m=>{w(m),N("editar")},k=m=>{w(m),N("detalle")},O=()=>{N(null),w(null)},D=async m=>{t(!0);try{await f(m),d("success","Obra creada correctamente"),O()}catch(g){const T=g instanceof Error?g.message:"Error al crear obra";throw d("error",T),g}finally{t(!1)}},C=async m=>{const g=s.find(T=>T.id===m);if(g&&confirm(`¿Estás seguro de que quieres eliminar la obra "${g.nombre}"?`))try{d("success","Obra eliminada correctamente")}catch(T){const V=T instanceof Error?T.message:"Error al eliminar obra";d("error",V)}},P=m=>{const g={...a,...m};u(g),x(g)},M=m=>{switch(m){case"REGISTRADA":return{color:"bg-gray-100 text-gray-800",icon:H};case"EN_EJECUCION":return{color:"bg-blue-100 text-blue-800",icon:Pe};case"PARALIZADA":return{color:"bg-yellow-100 text-yellow-800",icon:Y};case"TERMINADA":return{color:"bg-green-100 text-green-800",icon:B};case"LIQUIDADA":return{color:"bg-purple-100 text-purple-800",icon:je};case"CANCELADA":return{color:"bg-red-100 text-red-800",icon:Y};default:return{color:"bg-gray-100 text-gray-800",icon:H}}},v=m=>"bg-red-500",R=m=>{const g=n.find(T=>T.id===m);return g?g.nombre_completo:"Entidad no encontrada"},E={total:s.length,activas:s.filter(m=>m.estado==="EN_EJECUCION").length,terminadas:s.filter(m=>m.estado==="TERMINADA").length,paralizadas:s.filter(m=>m.estado==="PARALIZADA").length,montoTotal:s.reduce((m,g)=>m+g.monto_total,0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Obras Públicas"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión integral de obras de infraestructura municipal"})]}),e.jsxs("button",{onClick:A,className:"btn-primary flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Nueva Obra"]})]}),e.jsx(we,{children:p&&e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`p-4 rounded-lg flex items-center gap-3 ${p.tipo==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[p.tipo==="success"?e.jsx(B,{className:"w-5 h-5 text-green-600"}):e.jsx(Y,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:p.texto}),e.jsx("button",{onClick:()=>h(null),className:"ml-auto p-1 hover:bg-black hover:bg-opacity-5 rounded",children:"×"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.total}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Obras"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.activas}),e.jsx("p",{className:"text-sm text-gray-600",children:"En Ejecución"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.terminadas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Terminadas"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.paralizadas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Paralizadas"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["S/ ",(E.montoTotal/1e6).toFixed(1),"M"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Inversión Total"})]})]})})]}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Error al cargar datos: ",j]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por número de contrato, nombre o ubicación...",value:a.search,onChange:m=>P({search:m.target.value}),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("select",{value:a.estado||"",onChange:m=>P({estado:m.target.value||void 0}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),Object.entries($s).map(([m,g])=>e.jsx("option",{value:m,children:g},m))]}),e.jsxs("button",{onClick:()=>c(!r),className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Más Filtros"]})]}),e.jsx(we,{children:r&&e.jsx(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-gray-200 pt-4 mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Obra"}),e.jsxs("select",{value:a.tipo_obra||"",onChange:m=>P({tipo_obra:m.target.value||void 0}),className:"input-field",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),Object.entries(Ks).map(([m,g])=>e.jsx("option",{value:m,children:g},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entidad Ejecutora"}),e.jsxs("select",{value:a.entidad_ejecutora_id||"",onChange:m=>P({entidad_ejecutora_id:parseInt(m.target.value)||void 0}),className:"input-field",children:[e.jsx("option",{value:"",children:"Todas las ejecutoras"}),n.map(m=>e.jsx("option",{value:m.id,children:m.nombre_completo},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entidad Supervisora"}),e.jsxs("select",{value:a.entidad_supervisora_id||"",onChange:m=>P({entidad_supervisora_id:parseInt(m.target.value)||void 0}),className:"input-field",children:[e.jsx("option",{value:"",children:"Todas las supervisoras"}),n.map(m=>e.jsx("option",{value:m.id,children:m.nombre_completo},m.id))]})]})]})})}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay obras registradas"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Comienza creando la primera obra del sistema"}),e.jsxs("button",{onClick:A,className:"btn-primary flex items-center gap-2 mx-auto",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Crear Primera Obra"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mt-6",children:s.map((m,g)=>{const T=M(m.estado),V=T.icon;return e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g*.1},className:"bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs font-medium text-primary-600 bg-primary-50 px-2 py-1 rounded",children:m.numero_contrato}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mt-2 line-clamp-2",children:m.nombre}),m.codigo_interno&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:m.codigo_interno})]}),e.jsxs("span",{className:`px-3 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${T.color}`,children:[e.jsx(V,{className:"w-3 h-3"}),$s[m.estado]]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(le,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Ejecutora: ",R(m.entidad_ejecutora_id)]})]}),m.ubicacion&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ee,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:m.ubicacion})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[new Date(m.fecha_inicio).toLocaleDateString("es-PE")," - "," ",new Date(m.fecha_fin_prevista).toLocaleDateString("es-PE")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"font-medium",children:["S/ ",m.monto_total.toLocaleString("es-PE",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[m.plazo_ejecucion_dias," días"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[m.numero_valorizaciones," valorizaciones"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Avance Estimado"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"15%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${v()}`,style:{width:"15%"}})})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>k(m.id),className:"flex-1 btn-secondary text-sm py-2 flex items-center justify-center gap-1",children:[e.jsx(ke,{className:"w-4 h-4"}),"Ver Detalles"]}),e.jsx("button",{onClick:()=>y(m.id),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Editar obra",children:e.jsx(ts,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(m.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar obra",children:e.jsx(Cs,{className:"w-4 h-4"})})]})]})},m.id)})})]}),e.jsx(Er,{isOpen:l==="crear",onClose:O,onSubmit:D,loading:i,title:"Nueva Obra"}),e.jsx(_r,{obraId:_,isOpen:l==="detalle",onClose:O,onEditar:y})]})},Ua=({partidas:s,partidasSeleccionadas:b,onAgregarPartida:j,onQuitarPartida:x,readonly:f=!1,showCalculations:n=!0})=>{const[l,N]=o.useState(""),[_,w]=o.useState(""),[i,t]=o.useState({}),[r,c]=o.useState({}),p=P=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:2,maximumFractionDigits:2}).format(P).replace("PEN","S/"),h=(P,M=4)=>new Intl.NumberFormat("es-PE",{minimumFractionDigits:M,maximumFractionDigits:M}).format(P),a=o.useMemo(()=>{let P=s;return l&&(P=P.filter(M=>M.codigo_partida.toLowerCase().includes(l.toLowerCase())||M.descripcion.toLowerCase().includes(l.toLowerCase()))),_&&(P=P.filter(M=>M.categoria===_)),P.sort((M,v)=>M.numero_orden-v.numero_orden)},[s,l,_]),u=o.useMemo(()=>Array.from(new Set(s.map(M=>M.categoria).filter(Boolean))).sort(),[s]),d=o.useCallback(P=>b.some(M=>M.partida_id===P),[b]),A=o.useCallback(P=>b.find(v=>v.partida_id===P)?.metrado_actual||0,[b]),y=o.useCallback((P,M)=>{t(v=>({...v,[P]:M}))},[]),k=o.useCallback(P=>{const M=i[P]||"0",v=parseFloat(M);if(isNaN(v)||v<=0){alert("Ingrese un metrado válido mayor a cero");return}j(P,v),t(R=>{const E={...R};return delete E[P],E})},[i,j]),O=o.useCallback(P=>{const M=i[P]||A(P).toString(),v=parseFloat(M);if(isNaN(v)||v<0){alert("Ingrese un metrado válido");return}j(P,v),t(R=>{const E={...R};return delete E[P],E})},[i,A,j]),D=o.useMemo(()=>{let P=0,M=0,v=0,R=0;return b.forEach(E=>{const m=s.find(g=>g.id===E.partida_id);if(m){const g=E.metrado_actual*m.precio_unitario;P+=g,M+=m.metrado_contractual,v+=E.metrado_actual}}),M>0&&(R=v/M*100),{montoTotal:P,metradoTotalContractual:M,metradoTotalEjecutado:v,porcentajePromedioAvance:R,cantidadPartidas:b.length}},[b,s]),C=o.useCallback((P,M)=>{const v=s.find(R=>R.id===P);return v?M<=0?{valido:!1,mensaje:"El metrado debe ser mayor a cero",tipo:"error"}:M>v.metrado_contractual*1.05?{valido:!1,mensaje:"Metrado excede contractual + 5% de tolerancia",tipo:"error"}:M>v.metrado_contractual?{valido:!0,mensaje:"Metrado en tolerancia del 5%",tipo:"warning"}:{valido:!0}:{valido:!1,mensaje:"Partida no encontrada"}},[s]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar por código o descripción...",value:l,onChange:P=>N(P.target.value),className:"pl-10 pr-4 py-2 w-full text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("select",{value:_,onChange:P=>w(P.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),u.map(P=>e.jsx("option",{value:P,children:P},P))]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.length," partidas"]})]}),n&&b.length>0&&e.jsxs(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"card bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-medium text-blue-800",children:"Resumen de Partidas Seleccionadas"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 font-medium",children:"Partidas"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:D.cantidadPartidas})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 font-medium",children:"Monto Total"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:p(D.montoTotal)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 font-medium",children:"Metrado Ejecutado"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:h(D.metradoTotalEjecutado,2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 font-medium",children:"Avance Promedio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:[D.porcentajePromedioAvance.toFixed(2),"%"]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código / Descripción"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unidad"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Metrado Contractual"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio Unitario"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto Contractual"}),!f&&e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Metrado a Ejecutar"}),f&&e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Metrado Ejecutado"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto Parcial"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map((P,M)=>{const v=d(P.id),R=A(P.id),E=i[P.id]||"",m=E?parseFloat(E):R,g=isNaN(m)?0:m*P.precio_unitario,T=P.metrado_contractual>0?R/P.metrado_contractual*100:0,V=E?C(P.id,parseFloat(E)||0):{valido:!0};return e.jsxs(S.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:M*.02},className:`hover:bg-gray-50 ${v?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:P.codigo_partida}),e.jsx("div",{className:"text-gray-600 text-xs mt-1 max-w-xs",children:P.descripcion}),P.categoria&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:P.categoria})]})}),e.jsx("td",{className:"px-4 py-4 text-gray-900 font-mono",children:P.unidad_medida}),e.jsx("td",{className:"px-4 py-4 text-right font-mono text-gray-900",children:h(P.metrado_contractual)}),e.jsx("td",{className:"px-4 py-4 text-right font-mono text-gray-900",children:p(P.precio_unitario)}),e.jsx("td",{className:"px-4 py-4 text-right font-mono font-medium text-gray-900",children:p(P.monto_contractual)}),!f&&e.jsxs("td",{className:"px-4 py-4",children:[v?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:E||R,onChange:I=>y(P.id,I.target.value),step:"0.0001",min:"0",className:`w-24 px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary-500 ${!V.valido&&E?"border-red-300 focus:ring-red-500":V.tipo==="warning"&&E?"border-yellow-300 focus:ring-yellow-500":"border-gray-300"}`}),E&&e.jsx("button",{onClick:()=>O(P.id),disabled:!V.valido,className:"text-blue-600 hover:text-blue-800 disabled:opacity-50",title:"Actualizar metrado",children:e.jsx(B,{className:"w-4 h-4"})})]}):e.jsx("input",{type:"number",value:E,onChange:I=>y(P.id,I.target.value),placeholder:"0.0000",step:"0.0001",min:"0",className:`w-24 px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary-500 ${!V.valido&&E?"border-red-300 focus:ring-red-500":V.tipo==="warning"&&E?"border-yellow-300 focus:ring-yellow-500":"border-gray-300"}`}),E&&V.mensaje&&e.jsx("div",{className:`text-xs mt-1 ${V.tipo==="error"?"text-red-600":"text-yellow-600"}`,children:V.mensaje})]}),f&&e.jsxs("td",{className:"px-4 py-4 text-right",children:[e.jsx("div",{className:"font-mono text-gray-900",children:h(R)}),T>0&&e.jsxs("div",{className:"text-xs text-blue-600",children:[T.toFixed(1),"%"]})]}),e.jsxs("td",{className:"px-4 py-4 text-right",children:[e.jsx("div",{className:"font-mono font-medium text-gray-900",children:p(g)}),v&&e.jsxs("div",{className:"text-xs text-blue-600",children:["Avance: ",(R/P.metrado_contractual*100).toFixed(1),"%"]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:!f&&e.jsx("div",{className:"flex justify-center gap-1",children:v?e.jsx("button",{onClick:()=>x(P.id),className:"text-red-600 hover:text-red-800",title:"Quitar partida",children:e.jsx(Bs,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>k(P.id),disabled:!E||!V.valido,className:"text-green-600 hover:text-green-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Agregar partida",children:e.jsx(Oe,{className:"w-4 h-4"})})})})]},P.id)})})]})}),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No se encontraron partidas con los filtros aplicados"})]})]})},Cr=({onCancel:s,onSuccess:b})=>{const[j,x]=o.useState(null),[f,n]=o.useState(""),[l,N]=o.useState(""),[_,w]=o.useState(""),[i,t]=o.useState(""),[r,c]=o.useState(0),[p,h]=o.useState(0),[a,u]=o.useState(0),[d,A]=o.useState(0),[y,k]=o.useState(""),[O,D]=o.useState(""),[C,P]=o.useState(""),[M,v]=o.useState(""),[R,E]=o.useState([]),[m,g]=o.useState(null),[T,V]=o.useState([]),[I,F]=o.useState(!1),{crearValorizacionEjecucion:L,calcularMontos:U,validarValorizacion:q,formatearMoneda:ee,cargarPartidasPorObra:W,partidas:J,loading:_e}=rs(),{obras:Ye,obtenerObraPorId:ze}=Me(),Z=Ye.filter($=>$.estado==="EN_EJECUCION"||$.estado==="REGISTRADA"),[me,se]=o.useState(null);o.useEffect(()=>{j?ze(j).then($=>{se($)}).catch($=>{console.error("Error cargando obra:",$),se(null)}):se(null)},[j,ze]),o.useEffect(()=>{j&&(W(j),E([]))},[j,W]),o.useEffect(()=>{if(R.length>0&&me){const $={obra_id:me.id||0,numero_valorizacion:1,periodo:"2024-01",fecha_inicio:f,fecha_fin:l,tipo_valorizacion:"EJECUCION",monto_ejecutado:R.reduce((z,xe)=>z+xe.metrado_actual*100,0),adelanto_directo_porcentaje:r,adelanto_materiales_porcentaje:p,penalidades_monto:a,otras_deducciones_monto:d},K=U($);g(K),V([])}else g(null),V([])},[R,r,p,a,d,me,U]);const Ae=o.useCallback(($,K)=>{if(!J.find(ae=>ae.id===$))return;const xe={partida_id:$,metrado_actual:K,fecha_medicion:new Date().toISOString().split("T")[0],metodo_medicion:"MANUAL"};E(ae=>ae.find(fe=>fe.partida_id===$)?ae.map(fe=>fe.partida_id===$?{...fe,metrado_actual:K}:fe):[...ae,xe])},[J]),Xe=o.useCallback($=>{E(K=>K.filter(z=>z.partida_id!==$))},[]),We=o.useCallback(()=>{if(!f||!l)return 0;const $=new Date(f),z=new Date(l).getTime()-$.getTime();return Math.ceil(z/(1e3*60*60*24))+1},[f,l]),Is=async()=>{if(!me){V(["Debe seleccionar una obra"]);return}const $={obra_id:me.id,numero_valorizacion:1,periodo:"2024-01",fecha_inicio:f,fecha_fin:l,tipo_valorizacion:"EJECUCION",monto_ejecutado:R.reduce((K,z)=>K+z.metrado_actual*100,0),numero_expediente:_||void 0,numero_expediente_siaf:i||void 0,adelanto_directo_porcentaje:r,adelanto_materiales_porcentaje:p,penalidades_monto:a,otras_deducciones_monto:d,residente_obra:y,supervisor_obra:O,observaciones_residente:C,observaciones_supervisor:M};try{const K=q($);if(!K.valido){V(K.errores);return}await L($),b()}catch(K){console.error("Error al crear valorización:",K),V([K instanceof Error?K.message:"Error desconocido"])}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:s,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Nueva Valorización de Ejecución"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Crear valorización mensual de avance de obra"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>F(!I),className:"btn-secondary flex items-center gap-2",disabled:!m,children:[e.jsx(je,{className:"w-4 h-4"}),I?"Ocultar":"Ver"," Cálculos"]}),e.jsxs("button",{onClick:Is,disabled:_e||T.length>0,className:"btn-primary flex items-center gap-2 disabled:opacity-50",children:[e.jsx(cs,{className:"w-4 h-4"}),_e?"Guardando...":"Guardar Valorización"]})]})]}),T.length>0&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"card border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800 mb-1",children:"Errores de Validación"}),e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:T.map(($,K)=>e.jsxs("li",{children:["• ",$]},K))})]})]})}),I&&m&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsx("h3",{className:"font-medium text-blue-800",children:"Resumen de Cálculos"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Monto Bruto"}),e.jsx("p",{className:"font-semibold text-blue-900",children:ee(m.monto_bruto)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Total Deducciones"}),e.jsx("p",{className:"font-semibold text-blue-900",children:ee(m.total_deducciones)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Monto Neto"}),e.jsx("p",{className:"font-semibold text-blue-900",children:ee(m.monto_neto)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Avance Físico"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[m.porcentaje_avance_fisico.toFixed(2),"%"]})]})]}),m.advertencias.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-100 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_s,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Advertencias:"}),e.jsx("ul",{className:"text-sm text-yellow-700 mt-1",children:m.advertencias.map(($,K)=>e.jsxs("li",{children:["• ",$]},K))})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Información General"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Obra *"}),e.jsxs("select",{value:j||"",onChange:$=>x($.target.value?Number($.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar obra..."}),Z.map($=>e.jsxs("option",{value:$.id,children:[$.numero_contrato," - ",$.nombre]},$.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto Contractual (de Ejecución)"}),e.jsx("input",{type:"text",value:me?ee(me.monto_ejecucion):"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Obtenido automáticamente de la obra seleccionada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Inicio Periodo *"}),e.jsx("input",{type:"date",value:f,onChange:$=>n($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Fin Periodo *"}),e.jsx("input",{type:"date",value:l,onChange:$=>N($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Días del Periodo"}),e.jsx("input",{type:"text",value:We(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado de Obra"}),e.jsx("input",{type:"text",value:me?me.estado.replace("_"," "):"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Expediente"}),e.jsx("input",{type:"text",value:_,onChange:$=>w($.target.value),placeholder:"Número de expediente administrativo",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Expediente SIAF"}),e.jsx("input",{type:"text",value:i,onChange:$=>t($.target.value),placeholder:"Número de expediente SIAF",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Personal Responsable"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Residente de Obra"}),e.jsx("input",{type:"text",value:y,onChange:$=>k($.target.value),placeholder:"Nombre completo del residente",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supervisor de Obra"}),e.jsx("input",{type:"text",value:O,onChange:$=>D($.target.value),placeholder:"Nombre completo del supervisor",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Observaciones"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones del Residente"}),e.jsx("textarea",{value:C,onChange:$=>P($.target.value),rows:3,placeholder:"Observaciones técnicas, dificultades encontradas, etc.",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones del Supervisor"}),e.jsx("textarea",{value:M,onChange:$=>v($.target.value),rows:3,placeholder:"Control de calidad, cumplimiento de especificaciones, etc.",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deducciones Contractuales"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adelanto Directo (%)"}),e.jsx("input",{type:"number",value:r,onChange:$=>c(Number($.target.value)||0),min:"0",max:"30",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Máximo 30% según normativa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adelanto Materiales (%)"}),e.jsx("input",{type:"number",value:p,onChange:$=>h(Number($.target.value)||0),min:"0",max:"20",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Máximo 20% según normativa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Penalidades (S/)"}),e.jsx("input",{type:"number",value:a,onChange:$=>u(Number($.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Otras Deducciones (S/)"}),e.jsx("input",{type:"number",value:d,onChange:$=>A(Number($.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Retención Garantía: 5%"}),e.jsx("p",{className:"text-xs mt-1",children:"Se aplica automáticamente según normativa"})]})})]})]})})]}),j&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Partidas a Valorizar"})]}),e.jsx(Ua,{partidas:J,partidasSeleccionadas:R,onAgregarPartida:Ae,onQuitarPartida:Xe,readonly:!1}),R.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Seleccione partidas para valorizar"})]})]})]})},Sr=({onCancel:s,onSuccess:b})=>{const[j,x]=o.useState(null),[f,n]=o.useState(""),[l,N]=o.useState(""),[_,w]=o.useState(""),[i,t]=o.useState(""),[r,c]=o.useState(0),[p,h]=o.useState(0),[a,u]=o.useState(0),[d,A]=o.useState(0),[y,k]=o.useState(0),[O,D]=o.useState(0),[C,P]=o.useState(0),[M,v]=o.useState(""),[R,E]=o.useState(""),[m,g]=o.useState(""),[T,V]=o.useState(""),[I,F]=o.useState([]),[L,U]=o.useState(!1),{crearValorizacionSupervision:q,valorizacionesEjecucion:ee,formatearMoneda:W,loading:J}=rs(),{obras:_e,obtenerObraPorId:Ye}=Me(),ze=_e.filter(z=>(z.estado==="EN_EJECUCION"||z.estado==="REGISTRADA")&&z.entidad_supervisora_id),[Z,me]=o.useState(null);o.useEffect(()=>{j?Ye(j).then(z=>{me(z)}).catch(z=>{console.error("Error cargando obra:",z),me(null)}):me(null)},[j,Ye]);const se=o.useMemo(()=>{if(!f||!l)return 0;const z=new Date(f),ae=new Date(l).getTime()-z.getTime();return Math.ceil(ae/(1e3*60*60*24))+1},[f,l]),Ae=p+a+d+y,Xe=o.useMemo(()=>Z?Z.monto_supervision/Z.plazo_ejecucion_dias:0,[Z]),We=o.useMemo(()=>{if(!Z||r===0)return{montoBruto:0,retencionMonto:0,totalDeducciones:0,montoNeto:0,igvMonto:0,montoTotal:0};const z=r*Xe,xe=z*.05,ae=xe+O+C,Qe=z-ae,fe=Qe*.18,Wa=Qe+fe;return{montoBruto:z,retencionMonto:xe,totalDeducciones:ae,montoNeto:Qe,igvMonto:fe,montoTotal:Wa}},[Z,r,Xe,O,C]),Is=se>0?r/se*100:0;o.useEffect(()=>{const z=[];if(j||z.push("Debe seleccionar una obra"),!f||!l?z.push("Debe especificar el periodo de supervisión"):new Date(f)>new Date(l)&&z.push("La fecha de inicio no puede ser posterior a la fecha fin"),r+Ae>se&&z.push("La suma de días trabajados y no trabajados excede los días del periodo"),r<0&&z.push("Los días efectivos no pueden ser negativos"),(p<0||a<0||d<0||y<0)&&z.push("Los días no trabajados no pueden ser negativos"),M.trim()||z.push("Debe especificar el supervisor responsable"),Z&&f&&l){const xe=new Date(Z.fecha_inicio||"2024-01-01"),ae=new Date(Z.fecha_fin_prevista||"2024-12-31"),Qe=new Date(f),fe=new Date(l);Qe<xe&&z.push("El periodo no puede ser anterior al inicio de la obra"),fe>ae&&z.push("El periodo no puede ser posterior a la fecha prevista de fin")}F(z)},[j,f,l,r,Ae,se,p,a,d,y,M,Z]),o.useEffect(()=>{se>0&&r===0&&Ae===0&&c(se)},[se]);const $=o.useCallback(()=>!j||!f||!l?null:ee.find(z=>z.obra_id===j&&z.periodo_inicio===f&&z.periodo_fin===l),[j,f,l,ee]),K=async()=>{if(!Z||I.length>0)return;if(!$()){F(["No se encontró una valorización de ejecución para el mismo periodo"]);return}const xe={obra_id:Z.id,numero_valorizacion:1,periodo:"2024-01",fecha_inicio:f,fecha_fin:l,tipo_valorizacion:"SUPERVISION",monto_ejecutado:We.montoBruto,numero_expediente:_||void 0,numero_expediente_siaf:i||void 0,penalidades_monto:O,otras_deducciones_monto:C};try{await q(xe),b()}catch(ae){console.error("Error al crear valorización de supervisión:",ae),F([ae instanceof Error?ae.message:"Error desconocido"])}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:s,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Nueva Valorización de Supervisión"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Crear valorización de supervisión basada en días efectivos trabajados"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>U(!L),className:"btn-secondary flex items-center gap-2",disabled:!Z||r===0,children:[e.jsx(je,{className:"w-4 h-4"}),L?"Ocultar":"Ver"," Cálculos"]}),e.jsxs("button",{onClick:K,disabled:J||I.length>0,className:"btn-primary flex items-center gap-2 disabled:opacity-50",children:[e.jsx(cs,{className:"w-4 h-4"}),J?"Guardando...":"Guardar Valorización"]})]})]}),I.length>0&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"card border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800 mb-1",children:"Errores de Validación"}),e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:I.map((z,xe)=>e.jsxs("li",{children:["• ",z]},xe))})]})]})}),L&&Z&&r>0&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsx("h3",{className:"font-medium text-blue-800",children:"Resumen de Cálculos"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Monto Bruto"}),e.jsx("p",{className:"font-semibold text-blue-900",children:W(We.montoBruto)}),e.jsxs("p",{className:"text-xs text-blue-600",children:[r," días × ",W(Xe)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Deducciones"}),e.jsx("p",{className:"font-semibold text-blue-900",children:W(We.totalDeducciones)}),e.jsx("p",{className:"text-xs text-blue-600",children:"Retención + Penalidades"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Monto Neto"}),e.jsx("p",{className:"font-semibold text-blue-900",children:W(We.montoNeto)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Días Trabajados"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[Is.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-blue-600",children:[r," de ",se," días"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 mb-2",children:"Desglose de Deducciones:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Retención Garantía (5%):"}),e.jsx("span",{className:"font-medium text-blue-800 ml-2",children:W(We.retencionMonto)})]}),O>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Penalidades:"}),e.jsx("span",{className:"font-medium text-blue-800 ml-2",children:W(O)})]}),C>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Otras Deducciones:"}),e.jsx("span",{className:"font-medium text-blue-800 ml-2",children:W(C)})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(de,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Información General"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Obra *"}),e.jsxs("select",{value:j||"",onChange:z=>x(z.target.value?Number(z.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar obra con supervisor..."}),ze.map(z=>e.jsxs("option",{value:z.id,children:[z.numero_contrato," - ",z.nombre]},z.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto Supervisión"}),e.jsx("input",{type:"text",value:Z?W(Z.monto_supervision):"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Inicio Periodo *"}),e.jsx("input",{type:"date",value:f,onChange:z=>n(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Fin Periodo *"}),e.jsx("input",{type:"date",value:l,onChange:z=>N(z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Días Calendario del Periodo"}),e.jsx("input",{type:"text",value:se,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tarifa Diaria de Supervisión"}),e.jsx("input",{type:"text",value:W(Xe),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculada automáticamente: Monto supervisión / Días plazo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Expediente"}),e.jsx("input",{type:"text",value:_,onChange:z=>w(z.target.value),placeholder:"Número de expediente administrativo",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Expediente SIAF"}),e.jsx("input",{type:"text",value:i,onChange:z=>t(z.target.value),placeholder:"Número de expediente SIAF",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(X,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Control de Días Trabajados"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Días Efectivos Trabajados *"}),e.jsx("input",{type:"number",value:r,onChange:z=>c(Number(z.target.value)||0),min:"0",max:se,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Días reales de supervisión efectiva (máximo ",se," días)"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1",children:[e.jsx(jt,{className:"w-4 h-4 text-blue-500"}),"Días de Lluvia"]}),e.jsx("input",{type:"number",value:p,onChange:z=>h(Number(z.target.value)||0),min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4 text-green-500"}),"Días Feriados"]}),e.jsx("input",{type:"number",value:a,onChange:z=>u(Number(z.target.value)||0),min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1",children:[e.jsx(pa,{className:"w-4 h-4 text-orange-500"}),"Días Suspensión"]}),e.jsx("input",{type:"number",value:d,onChange:z=>A(Number(z.target.value)||0),min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1",children:[e.jsx(ft,{className:"w-4 h-4 text-gray-500"}),"Otros Motivos"]}),e.jsx("input",{type:"number",value:y,onChange:z=>k(Number(z.target.value)||0),min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total No Trabajados"}),e.jsx("input",{type:"text",value:Ae,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Días del periodo:"}),e.jsx("span",{className:"font-medium",children:se})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Días efectivos:"}),e.jsx("span",{className:"font-medium text-green-600",children:r})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Días no trabajados:"}),e.jsx("span",{className:"font-medium text-orange-600",children:Ae})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t pt-2 mt-2",children:[e.jsx("span",{className:"text-gray-700",children:"Total asignado:"}),e.jsxs("span",{className:`font-medium ${r+Ae<=se?"text-green-600":"text-red-600"}`,children:[r+Ae," / ",se]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Supervisor y Actividades"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supervisor Responsable *"}),e.jsx("input",{type:"text",value:M,onChange:z=>v(z.target.value),placeholder:"Nombre completo del supervisor responsable",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Actividades Realizadas"}),e.jsx("textarea",{value:R,onChange:z=>E(z.target.value),rows:3,placeholder:"Descripción de las actividades de supervisión realizadas durante el periodo...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones del Periodo"}),e.jsx("textarea",{value:m,onChange:z=>g(z.target.value),rows:3,placeholder:"Observaciones generales sobre el periodo de supervisión...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivos de Días No Trabajados"}),e.jsx("textarea",{value:T,onChange:z=>V(z.target.value),rows:2,placeholder:"Explicación detallada de los motivos de los días no trabajados...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deducciones"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Penalidades (S/)"}),e.jsx("input",{type:"number",value:O,onChange:z=>D(Number(z.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Penalidades aplicables por incumplimientos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Otras Deducciones (S/)"}),e.jsx("input",{type:"number",value:C,onChange:z=>P(Number(z.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Retención Garantía: 5%"}),e.jsx("p",{className:"text-xs mt-1",children:"Se aplica automáticamente sobre el monto bruto"})]})})]})]}),j&&f&&l&&e.jsxs("div",{className:"card border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_s,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-medium text-blue-800",children:"Valorización Relacionada"})]}),$()?e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx(B,{className:"w-4 h-4 text-green-500 inline mr-2"}),"Se encontró valorización de ejecución para el mismo periodo"]}):e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-500 inline mr-2"}),"No se encontró valorización de ejecución para este periodo"]})]})]})]})]})},Ga=({valorizacionId:s,tipo:b,onBack:j})=>{const[x,f]=o.useState(!1),[n,l]=o.useState(""),[N,_]=o.useState(""),[w,i]=o.useState(!1),[t,r]=o.useState("general"),{valorizacionesEjecucion:c,valorizacionesSupervision:p,cambiarEstadoValorizacion:h,formatearMoneda:a,partidas:u,cargarPartidasPorObra:d,loading:A}=rs(),{obtenerObraPorId:y}=Me(),{entidades:k}=Te(),[O,D]=o.useState(null),C=b==="ejecucion"?c.find(g=>g.id===s):p.find(g=>g.id===s);o.useEffect(()=>{C&&y(C.obra_id).then(g=>{D(g)}).catch(g=>{console.error("Error cargando obra:",g)})},[C,y]),o.useEffect(()=>{C&&b==="ejecucion"&&d(C.obra_id)},[C,b,d]);const P=O?k.find(g=>g.id===O.entidad_ejecutora_id):null,M=O?k.find(g=>g.id===O.entidad_supervisora_id):null,v=g=>{switch(g.toUpperCase()){case"APROBADA":return e.jsx(B,{className:"w-5 h-5 text-green-500"});case"EN_REVISION":case"PRESENTADA":return e.jsx(H,{className:"w-5 h-5 text-yellow-500"});case"BORRADOR":return e.jsx(ts,{className:"w-5 h-5 text-gray-500"});case"OBSERVADA":return e.jsx(Q,{className:"w-5 h-5 text-orange-500"});case"PAGADA":return e.jsx(ie,{className:"w-5 h-5 text-blue-500"});case"RECHAZADA":return e.jsx(Hs,{className:"w-5 h-5 text-red-500"});default:return e.jsx(H,{className:"w-5 h-5 text-gray-500"})}},R=g=>{switch(g.toUpperCase()){case"APROBADA":return"bg-green-100 text-green-800 border-green-200";case"EN_REVISION":case"PRESENTADA":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"BORRADOR":return"bg-gray-100 text-gray-800 border-gray-200";case"OBSERVADA":return"bg-orange-100 text-orange-800 border-orange-200";case"PAGADA":return"bg-blue-100 text-blue-800 border-blue-200";case"RECHAZADA":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},E=async()=>{if(!(!C||!n))try{await h(C.id,n),f(!1),l(""),_("")}catch(g){console.error("Error al cambiar estado:",g)}},m=()=>{if(!C)return[];const g=C.estado;if(b==="ejecucion")switch(g){case"BORRADOR":return["PRESENTADA"];case"PRESENTADA":return["EN_REVISION","OBSERVADA"];case"EN_REVISION":return["APROBADA","OBSERVADA"];case"OBSERVADA":return["PRESENTADA","RECHAZADA"];case"APROBADA":return["PAGADA"];default:return[]}else switch(g){case"BORRADOR":return["PRESENTADA"];case"PRESENTADA":return["APROBADA","RECHAZADA"];case"APROBADA":return["PAGADA"];default:return[]}};return!C||!O?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-medium",children:"Valorización no encontrada"}),e.jsx("button",{onClick:j,className:"btn-primary mt-4",children:"Volver"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:j,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:["Valorización N° ",C.numero_valorizacion,e.jsxs("span",{className:`px-3 py-1 text-sm font-medium rounded-full border ${R(C.estado)}`,children:[v(C.estado),e.jsx("span",{className:"ml-2",children:C.estado.replace("_"," ")})]})]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[b==="ejecucion"?"Valorización de Ejecución":"Valorización de Supervisión"," -",O.numero_contrato]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[m().length>0&&e.jsxs("button",{onClick:()=>f(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Cambiar Estado"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Descargar PDF"]}),e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Ver Expediente"]})]})]}),C.dias_atraso>0&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"card border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800",children:"Valorización con Atraso"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Esta valorización tiene ",C.dias_atraso," días de atraso en el proceso de pago."]})]})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>r("general"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${t==="general"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Información General"}),b==="ejecucion"&&e.jsx("button",{onClick:()=>r("partidas"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${t==="partidas"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Partidas Valorizadas"}),e.jsx("button",{onClick:()=>r("historial"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${t==="historial"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Historial"}),e.jsx("button",{onClick:()=>r("documentos"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${t==="documentos"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Documentos"})]})}),t==="general"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Información de la Obra"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre de la Obra"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:O.nombre})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Número de Contrato"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:O.numero_contrato})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Entidad Ejecutora"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P?.nombre_completo||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Entidad Supervisora"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:M?.nombre_completo||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monto Contractual"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 font-semibold",children:a(b==="ejecucion"?O.monto_ejecucion:O.monto_supervision)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado de la Obra"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:O.estado.replace("_"," ")})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(X,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Periodo de Valorización"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha Inicio"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(C.periodo_inicio).toLocaleDateString("es-PE")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha Fin"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(C.periodo_fin).toLocaleDateString("es-PE")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Días del Periodo"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[String("dias_periodo"in C?C.dias_periodo:"dias_calendario_periodo"in C?C.dias_calendario_periodo:0)," días"]})]}),b==="supervision"&&"dias_efectivos_trabajados"in C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Días Efectivos"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-900 font-semibold",children:[String(C.dias_efectivos_trabajados||0)," días"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Personal Responsable"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b==="ejecucion"&&"residente_obra"in C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Residente de Obra"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:C.residente_obra||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Supervisor de Obra"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:C.supervisor_obra||"No especificado"})]})]}),b==="supervision"&&"supervisor_responsable"in C&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Supervisor Responsable"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:String(C.supervisor_responsable||"No especificado")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Responsable de Entidad"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:C.responsable_entidad||"No especificado"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Nt,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Observaciones"})]}),e.jsxs("div",{className:"space-y-4",children:[b==="ejecucion"&&"observaciones_residente"in C&&e.jsxs(e.Fragment,{children:[C.observaciones_residente&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observaciones del Residente"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:C.observaciones_residente})]}),C.observaciones_supervisor&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observaciones del Supervisor"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:C.observaciones_supervisor})]}),C.observaciones_entidad&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observaciones de la Entidad"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:C.observaciones_entidad})]}),C.motivo_rechazo&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-red-700",children:"Motivo de Rechazo"}),e.jsx("p",{className:"mt-1 text-sm text-red-800 bg-red-50 p-3 rounded-lg border border-red-200",children:C.motivo_rechazo})]})]}),b==="supervision"&&"observaciones_periodo"in C&&e.jsxs(e.Fragment,{children:[C.observaciones_periodo&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observaciones del Periodo"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:String(C.observaciones_periodo)})]}),C.actividades_realizadas&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Actividades Realizadas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:C.actividades_realizadas})]}),C.motivos_dias_no_trabajados&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Motivos Días No Trabajados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-lg",children:C.motivos_dias_no_trabajados})]})]}),!("observaciones_residente"in C)&&!("observaciones_periodo"in C)&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay observaciones registradas"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Resumen Económico"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Monto Bruto"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a(C.monto_bruto)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Deducciones"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["- ",a(C.total_deducciones)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Neto"}),e.jsx("span",{className:"font-bold text-green-600",children:a(C.monto_neto)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"IGV (18%)"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a(C.igv_monto)})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:"Total con IGV"}),e.jsx("span",{className:"font-bold text-blue-600 text-lg",children:a(C.monto_neto+C.igv_monto)})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Desglose de Deducciones"}),e.jsxs("div",{className:"space-y-3",children:[b==="ejecucion"&&"adelanto_directo_monto"in C&&e.jsxs(e.Fragment,{children:[C.adelanto_directo_monto>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Adelanto Directo (",C.adelanto_directo_porcentaje,"%)"]}),e.jsx("span",{className:"font-medium text-gray-900",children:a(C.adelanto_directo_monto)})]}),C.adelanto_materiales_monto>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Adelanto Materiales (",C.adelanto_materiales_porcentaje,"%)"]}),e.jsx("span",{className:"font-medium text-gray-900",children:a(C.adelanto_materiales_monto)})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Retención Garantía (",C.retencion_garantia_porcentaje,"%)"]}),e.jsx("span",{className:"font-medium text-gray-900",children:a(C.retencion_garantia_monto)})]}),C.penalidades_monto>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Penalidades"}),e.jsx("span",{className:"font-medium text-gray-900",children:a(C.penalidades_monto)})]}),C.otras_deducciones_monto>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Otras Deducciones"}),e.jsx("span",{className:"font-medium text-gray-900",children:a(C.otras_deducciones_monto)})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ts,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"GitBranch del Proceso"})]}),e.jsxs("div",{className:"space-y-3",children:[C.fecha_presentacion&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Presentación"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(C.fecha_presentacion).toLocaleDateString("es-PE")})]}),b==="ejecucion"&&"fecha_revision"in C&&C.fecha_revision&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Revisión"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(String(C.fecha_revision)).toLocaleDateString("es-PE")})]}),C.fecha_aprobacion&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Aprobación"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(C.fecha_aprobacion).toLocaleDateString("es-PE")})]}),b==="ejecucion"&&"fecha_limite_pago"in C&&C.fecha_limite_pago&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Límite de Pago"}),e.jsx("span",{className:`font-medium ${new Date(String(C.fecha_limite_pago))<new Date&&!C.fecha_pago?"text-red-600":"text-gray-900"}`,children:new Date(String(C.fecha_limite_pago)).toLocaleDateString("es-PE")})]}),C.fecha_pago&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Pago"}),e.jsx("span",{className:"font-medium text-green-600",children:new Date(C.fecha_pago).toLocaleDateString("es-PE")})]})]})]}),b==="ejecucion"&&"porcentaje_avance_fisico_total"in C&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Avance de Obra"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avance Físico Total"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[Number(C.porcentaje_avance_fisico_total||0).toFixed(2),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full",style:{width:`${Math.min(Number(C.porcentaje_avance_fisico_total||0),100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avance Económico"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a(Number(C.monto_avance_economico_total||0))})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["de ",a(O.monto_ejecucion)," contractuales"]})]})]})]})]})]}),t==="partidas"&&b==="ejecucion"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Partidas Valorizadas"})]}),e.jsx(Ua,{partidas:u,partidasSeleccionadas:[],onAgregarPartida:()=>{},onQuitarPartida:()=>{},readonly:!0,showCalculations:!1})]}),t==="historial"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ts,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Historial de Cambios"})]}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ts,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Historial de cambios no implementado aún"})]})]}),t==="documentos"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ea,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Documentos Adjuntos"})]}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ea,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Gestión de documentos no implementada aún"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Cambiar Estado de Valorización"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nuevo Estado"}),e.jsxs("select",{value:n,onChange:g=>l(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Seleccionar estado..."}),m().map(g=>e.jsx("option",{value:g,children:g.replace("_"," ")},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),e.jsx("textarea",{value:N,onChange:g=>_(g.target.value),rows:3,placeholder:"Motivo del cambio de estado...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 btn-secondary",children:"Cancelar"}),e.jsx("button",{onClick:E,disabled:!n||A,className:"flex-1 btn-primary disabled:opacity-50",children:A?"Cambiando...":"Confirmar"})]})]})})]})},Pr=()=>{const[s,b]=o.useState("lista"),[j,x]=o.useState(null),[f,n]=o.useState({}),[l,N]=o.useState(""),[_,w]=o.useState(),[i,t]=o.useState(""),[r,c]=o.useState(!1),{valorizacionesEjecucion:p,loading:h,error:a,estadisticasDashboard:u,cargarValorizaciones:d,formatearMoneda:A}=rs(),{obras:y}=Me(),{entidades:k}=Te(),O=o.useCallback(()=>{b("lista"),x(null),d(f)},[d,f]),D=o.useCallback(()=>{b("crear")},[]),C=o.useCallback(g=>{x(g),b("detalle")},[]),P=o.useCallback(()=>{const g={search:l||void 0,obra_id:_,estado:i||void 0};n(g),d(g)},[l,_,i,d]),M=o.useCallback(()=>{N(""),w(void 0),t(""),n({}),d()},[d]),v=g=>{switch(g.toUpperCase()){case"APROBADA":return e.jsx(B,{className:"w-5 h-5 text-green-500"});case"EN_REVISION":case"PRESENTADA":return e.jsx(H,{className:"w-5 h-5 text-yellow-500"});case"BORRADOR":return e.jsx(qs,{className:"w-5 h-5 text-gray-500"});case"OBSERVADA":return e.jsx(Y,{className:"w-5 h-5 text-orange-500"});case"PAGADA":return e.jsx(ie,{className:"w-5 h-5 text-blue-500"});case"RECHAZADA":return e.jsx(Hs,{className:"w-5 h-5 text-red-500"});default:return e.jsx(H,{className:"w-5 h-5 text-gray-500"})}},R=g=>{switch(g.toUpperCase()){case"APROBADA":return"bg-green-100 text-green-800";case"EN_REVISION":case"PRESENTADA":return"bg-yellow-100 text-yellow-800";case"BORRADOR":return"bg-gray-100 text-gray-800";case"OBSERVADA":return"bg-orange-100 text-orange-800";case"PAGADA":return"bg-blue-100 text-blue-800";case"RECHAZADA":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=g=>{const T=y.find(V=>V.id===g);return T?T.nombre:"Obra no encontrada"},m=g=>{const T=y.find(I=>I.id===g);if(!T)return"No disponible";const V=k.find(I=>I.id===T.entidad_ejecutora_id);return V?V.nombre_completo:"Entidad no encontrada"};return s==="crear"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Valorizaciones"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-blue-600",children:"Valorización de Ejecución"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Nueva Valorización"})]}),e.jsx(Cr,{onCancel:O,onSuccess:O})]}):s==="detalle"&&j?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Valorizaciones"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-blue-600",children:"Valorización de Ejecución"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Detalle"})]}),e.jsx(Ga,{valorizacionId:j,tipo:"ejecucion",onBack:O})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(Pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Valorización de Ejecución"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Control de valorizaciones de obras ejecutadas"})]})]}),e.jsx("p",{className:"text-gray-600 mt-2 ml-15",children:"Gestión y seguimiento de valorizaciones de obras ejecutadas por empresas contratistas"})]}),e.jsxs("button",{onClick:D,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium shadow-lg transition-all duration-200 hover:shadow-xl",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Nueva Valorización"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"card bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Valorizado"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:u.totalValorizado})]}),e.jsx(oe,{className:"w-8 h-8 text-blue-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Aprobadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:u.aprobadas})]}),e.jsx(B,{className:"w-8 h-8 text-green-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:u.pendientes})]}),e.jsx(H,{className:"w-8 h-8 text-yellow-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Pagadas"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:u.pagadas})]}),e.jsx(ie,{className:"w-8 h-8 text-purple-500 opacity-50"})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por número, obra o empresa...",value:l,onChange:g=>N(g.target.value),onKeyPress:g=>g.key==="Enter"&&P(),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:_||"",onChange:g=>w(g.target.value?Number(g.target.value):void 0),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas las obras"}),y.map(g=>e.jsxs("option",{value:g.id,children:[g.numero_contrato," - ",g.nombre.substring(0,50),"..."]},g.id))]}),e.jsxs("select",{value:i,onChange:g=>t(g.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"BORRADOR",children:"Borrador"}),e.jsx("option",{value:"PRESENTADA",children:"Presentada"}),e.jsx("option",{value:"EN_REVISION",children:"En Revisión"}),e.jsx("option",{value:"OBSERVADA",children:"Observada"}),e.jsx("option",{value:"APROBADA",children:"Aprobada"}),e.jsx("option",{value:"PAGADA",children:"Pagada"}),e.jsx("option",{value:"RECHAZADA",children:"Rechazada"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:P,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Filtrar"]}),e.jsx("button",{onClick:M,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:"Limpiar"}),e.jsxs("button",{className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Exportar"]})]})]}),r&&e.jsxs("div",{className:"border-t pt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha desde"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha hasta"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Solo con atraso"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"true",children:"Sí"}),e.jsx("option",{value:"false",children:"No"})]})]})]}),e.jsxs("button",{onClick:()=>c(!r),className:"text-blue-600 hover:text-blue-800 text-sm font-medium self-start",children:[r?"Ocultar":"Mostrar"," filtros avanzados"]})]})}),e.jsx("div",{className:"card",children:h?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Cargando valorizaciones..."})]}):a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-medium",children:a})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay valorizaciones de ejecución para mostrar"}),e.jsxs("button",{onClick:D,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center gap-2 mx-auto transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Crear primera valorización"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Número / Código"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Obra / Empresa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Periodo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Avance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-blue-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((g,T)=>e.jsxs(S.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:T*.05},className:"hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>C(g.id),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(g.estado),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["N° ",g.numero_valorización||"Sin número"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"codigo_valorización"in g?g.codigo_valorización:`EJE-${g.numero_valorización}`})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 max-w-xs truncate",children:E(g.obra_id)}),e.jsx("div",{className:"text-sm text-gray-500",children:m(g.obra_id)})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[new Date(g.periodo_inicio).toLocaleDateString("es-PE")," - "," ",new Date(g.periodo_fin).toLocaleDateString("es-PE")]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["dias_periodo"in g?g.dias_periodo:0," días"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:A(g.monto_bruto)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Neto: ",A(g.monto_neto)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 max-w-[100px]",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min("porcentaje_avance_fisico_total"in g?g.porcentaje_avance_fisico_total:0,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["porcentaje_avance_fisico_total"in g?g.porcentaje_avance_fisico_total.toFixed(1):"0.0","%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${R(g.estado)}`,children:g.estado.charAt(0)+g.estado.slice(1).toLowerCase().replace("_"," ")}),g.dias_atraso>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:[g.dias_atraso," días atraso"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),C(g.id)},className:"text-blue-600 hover:text-blue-900",title:"Ver detalles",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:V=>V.stopPropagation(),className:"text-gray-600 hover:text-gray-900",title:"Descargar PDF",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},g.id))})]})})})]})},Dr=()=>{const[s,b]=o.useState("lista"),[j,x]=o.useState(null),[f,n]=o.useState({}),[l,N]=o.useState(""),[_,w]=o.useState(),[i,t]=o.useState(""),[r,c]=o.useState(!1),{valorizacionesSupervision:p,loading:h,error:a,estadisticasDashboard:u,cargarValorizaciones:d,formatearMoneda:A}=rs(),{obras:y}=Me(),{entidades:k}=Te(),O=o.useCallback(()=>{b("lista"),x(null),d(f)},[d,f]),D=o.useCallback(()=>{b("crear")},[]),C=o.useCallback(g=>{x(g),b("detalle")},[]),P=o.useCallback(()=>{const g={search:l||void 0,obra_id:_,estado:i||void 0};n(g),d(g)},[l,_,i,d]),M=o.useCallback(()=>{N(""),w(void 0),t(""),n({}),d()},[d]),v=g=>{switch(g.toUpperCase()){case"APROBADA":return e.jsx(B,{className:"w-5 h-5 text-green-500"});case"EN_REVISION":case"PRESENTADA":return e.jsx(H,{className:"w-5 h-5 text-yellow-500"});case"BORRADOR":return e.jsx(qs,{className:"w-5 h-5 text-gray-500"});case"OBSERVADA":return e.jsx(Y,{className:"w-5 h-5 text-orange-500"});case"PAGADA":return e.jsx(ie,{className:"w-5 h-5 text-green-600"});case"RECHAZADA":return e.jsx(Hs,{className:"w-5 h-5 text-red-500"});default:return e.jsx(H,{className:"w-5 h-5 text-gray-500"})}},R=g=>{switch(g.toUpperCase()){case"APROBADA":return"bg-green-100 text-green-800";case"EN_REVISION":case"PRESENTADA":return"bg-yellow-100 text-yellow-800";case"BORRADOR":return"bg-gray-100 text-gray-800";case"OBSERVADA":return"bg-orange-100 text-orange-800";case"PAGADA":return"bg-green-100 text-green-800";case"RECHAZADA":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=g=>{const T=y.find(V=>V.id===g);return T?T.nombre:"Obra no encontrada"},m=g=>{const T=y.find(I=>I.id===g);if(!T)return"No disponible";const V=k.find(I=>I.id===T.entidad_supervisora_id);return V?V.nombre_completo:"Entidad no encontrada"};return s==="crear"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Valorizaciones"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-green-600",children:"Valorización de Supervisión"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Nueva Valorización"})]}),e.jsx(Sr,{onCancel:O,onSuccess:O})]}):s==="detalle"&&j?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Valorizaciones"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-green-600",children:"Valorización de Supervisión"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Detalle"})]}),e.jsx(Ga,{valorizacionId:j,tipo:"supervision",onBack:O})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(ge,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Valorización de Supervisión"}),e.jsx("p",{className:"text-green-600 font-medium",children:"Control de servicios de supervisión"})]})]}),e.jsx("p",{className:"text-gray-600 mt-2 ml-15",children:"Gestión y seguimiento de valorizaciones de servicios de supervisión técnica"})]}),e.jsxs("button",{onClick:D,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-medium shadow-lg transition-all duration-200 hover:shadow-xl",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Nueva Valorización"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"card bg-gradient-to-r from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Valorizado"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:u.totalValorizado})]}),e.jsx(oe,{className:"w-8 h-8 text-green-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-emerald-50 to-emerald-100 border-emerald-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-emerald-600",children:"Aprobadas"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-900",children:u.aprobadas})]}),e.jsx(B,{className:"w-8 h-8 text-emerald-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:u.pendientes})]}),e.jsx(H,{className:"w-8 h-8 text-yellow-500 opacity-50"})]})}),e.jsx("div",{className:"card bg-gradient-to-r from-teal-50 to-teal-100 border-teal-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-teal-600",children:"Pagadas"}),e.jsx("p",{className:"text-2xl font-bold text-teal-900",children:u.pagadas})]}),e.jsx(ie,{className:"w-8 h-8 text-teal-500 opacity-50"})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por número, obra o empresa...",value:l,onChange:g=>N(g.target.value),onKeyPress:g=>g.key==="Enter"&&P(),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("select",{value:_||"",onChange:g=>w(g.target.value?Number(g.target.value):void 0),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas las obras"}),y.filter(g=>g.entidad_supervisora_id).map(g=>e.jsxs("option",{value:g.id,children:[g.numero_contrato," - ",g.nombre.substring(0,50),"..."]},g.id))]}),e.jsxs("select",{value:i,onChange:g=>t(g.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"BORRADOR",children:"Borrador"}),e.jsx("option",{value:"PRESENTADA",children:"Presentada"}),e.jsx("option",{value:"EN_REVISION",children:"En Revisión"}),e.jsx("option",{value:"OBSERVADA",children:"Observada"}),e.jsx("option",{value:"APROBADA",children:"Aprobada"}),e.jsx("option",{value:"PAGADA",children:"Pagada"}),e.jsx("option",{value:"RECHAZADA",children:"Rechazada"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:P,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Filtrar"]}),e.jsx("button",{onClick:M,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:"Limpiar"}),e.jsxs("button",{className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Exportar"]})]})]}),r&&e.jsxs("div",{className:"border-t pt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha desde"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha hasta"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Solo con atraso"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"true",children:"Sí"}),e.jsx("option",{value:"false",children:"No"})]})]})]}),e.jsxs("button",{onClick:()=>c(!r),className:"text-green-600 hover:text-green-800 text-sm font-medium self-start",children:[r?"Ocultar":"Mostrar"," filtros avanzados"]})]})}),e.jsx("div",{className:"card",children:h?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Cargando valorizaciones..."})]}):a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-medium",children:a})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay valorizaciones de supervisión para mostrar"}),e.jsxs("button",{onClick:D,className:"mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg flex items-center gap-2 mx-auto transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Crear primera valorización"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-green-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Número / Código"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Obra / Empresa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Periodo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Días Efectivos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-green-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((g,T)=>e.jsxs(S.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:T*.05},className:"hover:bg-green-50 cursor-pointer transition-colors",onClick:()=>C(g.id),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(g.estado),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["N° ",g.numero_valorizacion]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SUP-",g.numero_valorizacion]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 max-w-xs truncate",children:E(g.obra_id)}),e.jsx("div",{className:"text-sm text-gray-500",children:m(g.obra_id)})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[new Date(g.periodo_inicio).toLocaleDateString("es-PE")," - "," ",new Date(g.periodo_fin).toLocaleDateString("es-PE")]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[String("dias_calendario_periodo"in g?g.dias_calendario_periodo:0)," días calendario"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:A(g.monto_bruto)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Neto: ",A(g.monto_neto)]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[String("dias_efectivos_trabajados"in g?g.dias_efectivos_trabajados:0)," días"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["de ",String("dias_calendario_periodo"in g?g.dias_calendario_periodo:0)," calendario"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${R(g.estado)}`,children:g.estado.charAt(0)+g.estado.slice(1).toLowerCase().replace("_"," ")}),"dias_atraso"in g&&g.dias_atraso>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:[g.dias_atraso," días atraso"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),C(g.id)},className:"text-green-600 hover:text-green-900",title:"Ver detalles",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:V=>V.stopPropagation(),className:"text-gray-600 hover:text-gray-900",title:"Descargar PDF",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},g.id))})]})})})]})},Rr=[{id:1,tipo:"VALORIZACION_MENSUAL",nombre:"Valorización Enero 2025",descripcion:"Reporte de valorización del mes de enero 2025",filtros:{periodo:"MENSUAL",fechaInicio:"2025-01-01",fechaFin:"2025-01-31",niveLDetalle:"COMPLETO"},opciones:{incluirGraficos:!0,incluirResumenEjecutivo:!0,incluirAnalisisComparativo:!1,incluirRecomendaciones:!0,incluirAnexos:!1,incluirFotos:!0,numerarPaginas:!0},estado:"COMPLETADO",fechaGeneracion:"2025-02-01T10:30:00Z",tiempoGeneracion:45,tamaño:2847392,formato:"PDF",rutaArchivo:"/reportes/valorización-enero-2025.pdf",urlDescarga:"/api/reportes/download/1",numeroDescargas:3,ultimaDescarga:"2025-02-01T14:20:00Z",usuarioSolicitante:"admin",activo:!0,created_at:"2025-02-01T10:30:00Z",updated_at:"2025-02-01T14:20:00Z"},{id:2,tipo:"GERENCIAL_EJECUTIVO",nombre:"Dashboard Gerencial Q1 2025",descripcion:"Reporte gerencial ejecutivo del primer trimestre 2025",filtros:{periodo:"TRIMESTRAL",fechaInicio:"2025-01-01",fechaFin:"2025-03-31",niveLDetalle:"RESUMEN"},opciones:{incluirGraficos:!0,incluirResumenEjecutivo:!0,incluirAnalisisComparativo:!0,incluirRecomendaciones:!0,incluirAnexos:!0,incluirFotos:!1,numerarPaginas:!0},estado:"COMPLETADO",fechaGeneracion:"2025-01-28T16:45:00Z",tiempoGeneracion:120,tamaño:4592847,formato:"PDF",rutaArchivo:"/reportes/gerencial-q1-2025.pdf",urlDescarga:"/api/reportes/download/2",numeroDescargas:8,ultimaDescarga:"2025-02-05T09:15:00Z",usuarioSolicitante:"gerente",activo:!0,created_at:"2025-01-28T16:45:00Z",updated_at:"2025-02-05T09:15:00Z"}],Ba=()=>{const[s,b]=o.useState(Rr),[j,x]=o.useState(!1),[f,n]=o.useState(null),{entidades:l}=Te(),{obras:N}=Me(),_=o.useCallback(d=>{const A=N[0],y=l.find(O=>O.id===A?.entidad_ejecutora_id),k=l.find(O=>O.id===A?.entidad_supervisora_id);return{obra:{id:A?.id||1,numeroContrato:A?.numero_contrato||"N.º 001-2025-MDSM/GM",nombre:A?.nombre||"CONSTRUCCION DE CARRETERA PRINCIPAL",ubicacion:A?.ubicacion||"Distrito de Lima, Provincia de Lima",montoEjecucion:A?.monto_ejecucion||25e5,montoSupervision:A?.monto_supervision||125e3,montoTotal:(A?.monto_ejecucion||25e5)+(A?.monto_supervision||125e3),plazoEjecucionDias:A?.plazo_ejecucion_dias||365,fechaInicio:A?.fecha_inicio||"2025-01-15",fechaFinPrevista:A?.fecha_fin_prevista||"2026-01-14",tipoObra:A?.tipo_obra||"CARRETERA",modalidadEjecucion:A?.modalidad_ejecucion||"CONTRATA"},contratista:{nombre:y?.nombre_completo||"CONSTRUCTORA ABC S.A.C.",ruc:y?.ruc_principal||"20123456789",representanteLegal:y?.datos_empresa?.representante_legal||"Juan Pérez García",direccion:y?.datos_empresa?.direccion||"Av. Principal 123, Lima",telefono:y?.datos_empresa?.telefono,email:y?.datos_empresa?.email},supervisor:{nombre:k?.nombre_completo||"CONSULTORES XYZ E.I.R.L.",ruc:k?.ruc_principal||"20987654321",supervisorResponsable:"Ing. María López Silva",direccion:k?.datos_empresa?.direccion||"Jr. Secundario 456, Lima",telefono:k?.datos_empresa?.telefono,email:k?.datos_empresa?.email},valorizacion:{numero:1,periodo:"Enero 2025",periodoInicio:d.fechaInicio,periodoFin:d.fechaFin,montoBruto:245e3,deducciones:{adelantoDirecto:24500,adelantoMateriales:12250,retencionGarantia:12250,penalidades:0,otras:0,total:49e3},montoNeto:196e3,igv:35280,montoTotal:231280,avanceFisicoMensual:9.8,avanceEconomicoMensual:9.8,avanceFisicoAcumulado:9.8,avanceEconomicoAcumulado:9.8,estado:"APROBADA",fechaPresentacion:"2025-02-01",fechaAprobacion:"2025-02-05",fechaPago:"2025-02-10"},partidas:[{id:1,codigo:"01.01.01",numeroOrden:1,descripcion:"MOVIMIENTO DE TIERRAS - EXCAVACION MASIVA",unidadMedida:"m³",metradoContractual:1500,precioUnitario:35.5,montoContractual:53250,metradoAnterior:0,metradoActual:185,metradoAcumulado:185,porcentajeAnterior:0,porcentajeActual:12.33,porcentajeAcumulado:12.33,montoAnterior:0,montoActual:6567.5,montoAcumulado:6567.5},{id:2,codigo:"01.02.01",numeroOrden:2,descripcion:"CONCRETO - CONCRETO F'C=210 KG/CM2",unidadMedida:"m³",metradoContractual:850,precioUnitario:420,montoContractual:357e3,metradoAnterior:0,metradoActual:95,metradoAcumulado:95,porcentajeAnterior:0,porcentajeActual:11.18,porcentajeAcumulado:11.18,montoAnterior:0,montoActual:39900,montoAcumulado:39900}],firmas:{residenteObra:"Ing. Carlos Mendoza",supervisorObra:"Ing. María López Silva",responsableEntidad:"Ing. Roberto Vásquez",fechaFirmas:"2025-02-01"}}},[N,l]),w=o.useCallback(d=>{const A=_(d),y=[{id:"1",tipo:"RETRASO",criticidad:"MEDIO",titulo:"Leve retraso en cronograma",descripcion:"La obra presenta un retraso de 3 días respecto al cronograma programado",fechaDeteccion:"2025-01-28",impacto:"Posible impacto en entrega final si no se corrige",accionRequerida:"Incrementar cuadrilla de trabajo"},{id:"2",tipo:"PRESUPUESTO",criticidad:"BAJO",titulo:"Variación menor en costos de materiales",descripcion:"Incremento del 2% en costos de cemento",fechaDeteccion:"2025-01-25",impacto:"Impacto mínimo en presupuesto total",accionRequerida:"Monitorear precios de mercado"}],k=[{id:"1",categoria:"CRONOGRAMA",prioridad:"MEDIA",titulo:"Optimizar secuencia de actividades",descripcion:"Reorganizar actividades para recuperar tiempo perdido",beneficioEsperado:"Recuperar 3 días de retraso",responsable:"Residente de Obra",plazoEjecucion:"1 semana"},{id:"2",categoria:"GESTION",prioridad:"BAJA",titulo:"Implementar control digital de metrados",descripcion:"Usar herramientas digitales para mejorar precisión",beneficioEsperado:"Mayor precisión en mediciones",responsable:"Supervisor",plazoEjecucion:"2 semanas"}];return{obra:{...A.obra,estadoActual:"EN_EJECUCION",diasTranscurridos:17,diasRestantes:348,porcentajeVigencia:4.66},avance:{fisicoReal:9.8,economicoReal:9.8,fisicoProgramado:10.5,economicoProgramado:10.5,desviacionFisica:-.7,desviacionEconomica:-.7,tendenciaTermino:"ATRASADO",fechaTerminoProyectada:"2026-01-17",diasAtrasoProyectado:3},cronograma:[{periodo:"2025-01",avanceProgramado:10.5,avanceReal:9.8,acumuladoProgramado:10.5,acumuladoReal:9.8},{periodo:"2025-02",avanceProgramado:8.5,avanceReal:0,acumuladoProgramado:19,acumuladoReal:9.8},{periodo:"2025-03",avanceProgramado:9,avanceReal:0,acumuladoProgramado:28,acumuladoReal:9.8}],valorizaciones:[{numero:1,fechaProgramada:"2025-02-01",fechaReal:"2025-02-01",monto:245e3,estado:"APROBADA",diasAtraso:0},{numero:2,fechaProgramada:"2025-03-01",monto:19e4,estado:"PROGRAMADA",diasAtraso:0}],alertas:y,recomendaciones:k}},[_]),i=o.useCallback(()=>({resumenEjecutivo:{inversionTotal:1575e4,inversionEjecutada:1547e3,porcentajeEjecucion:9.8,saldoPorEjecutar:14203e3,obrasActivas:6,obrasTerminadas:2,obrasParalizadas:0,montoPromedioPorObra:2625e3},flujoEfectivo:[{periodo:"2024-10",ingresos:0,egresos:45e4,saldo:-45e4,acumulado:-45e4},{periodo:"2024-11",ingresos:0,egresos:38e4,saldo:-38e4,acumulado:-83e4},{periodo:"2024-12",ingresos:0,egresos:29e4,saldo:-29e4,acumulado:-112e4},{periodo:"2025-01",ingresos:245e3,egresos:32e4,saldo:-75e3,acumulado:-1195e3},{periodo:"2025-02",ingresos:19e4,egresos:285e3,saldo:-95e3,acumulado:-129e4}],estadoPagos:[{obraId:1,obraNombre:"CONSTRUCCION DE CARRETERA PRINCIPAL",montoContratado:2625e3,montoEjecutado:245e3,montoPagado:231280,saldoPorPagar:13720,valorizacionesPendientes:0,diasPromedioAprobacion:4,diasPromedioPago:9,morosidad:0},{obraId:2,obraNombre:"MEJORAMIENTO DE SISTEMA DE AGUA POTABLE",montoContratado:185e4,montoEjecutado:185e3,montoPagado:175e3,saldoPorPagar:1e4,valorizacionesPendientes:1,diasPromedioAprobacion:5,diasPromedioPago:12,morosidad:2}],deducciones:{adelantosDirectos:157500,adelantosMateriales:78750,retencionesGarantia:77350,penalidades:0,otras:5400,total:319e3},proyecciones:{flujoProyectado:[{periodo:"2025-03",montoProyectado:42e4,probabilidad:.85},{periodo:"2025-04",montoProyectado:38e4,probabilidad:.8},{periodo:"2025-05",montoProyectado:41e4,probabilidad:.75}],liquidezProyectada:[{periodo:"2025-03",disponible:85e4,requerido:92e4,gap:-7e4},{periodo:"2025-04",disponible:92e4,requerido:89e4,gap:3e4},{periodo:"2025-05",disponible:105e4,requerido:98e4,gap:7e4}]},indicadores:{roi:12.5,tir:15.8,van:285e4,margenOperativo:18.5,cicloEfectivo:35,rotacionActivos:2.1}}),[]),t=o.useCallback(()=>({contratosVigentes:[{obraId:1,numeroContrato:"N.º 001-2025-MDSM/GM",nombreObra:"CONSTRUCCION DE CARRETERA PRINCIPAL",contratista:"CONSTRUCTORA ABC S.A.C.",montoContrato:2625e3,fechaInicio:"2025-01-15",fechaFinPrevista:"2026-01-14",estadoContrato:"VIGENTE",diasRestantes:348,avanceFisico:9.8,riesgoIncumplimiento:"BAJO"},{obraId:2,numeroContrato:"N.º 002-2025-MDSM/GM",nombreObra:"MEJORAMIENTO DE SISTEMA DE AGUA POTABLE",contratista:"INGENIERIA XYZ E.I.R.L.",montoContrato:185e4,fechaInicio:"2025-01-20",fechaFinPrevista:"2025-12-19",estadoContrato:"VIGENTE",diasRestantes:317,avanceFisico:10.2,riesgoIncumplimiento:"BAJO"}],vencimientos:[{tipo:"GARANTIA",descripcion:"Garantía de Fiel Cumplimiento - Obra Carretera",fechaVencimiento:"2026-04-14",diasParaVencer:438,criticidad:"BAJO",accionRequerida:"Solicitar renovación 90 días antes"},{tipo:"LICENCIA",descripcion:"Licencia de Construcción - Sistema Agua Potable",fechaVencimiento:"2025-06-20",diasParaVencer:134,criticidad:"MEDIO",accionRequerida:"Gestionar renovación en 30 días"}],penalidades:[],adicionalesDeductivos:[{obraId:1,obraNombre:"CONSTRUCCION DE CARRETERA PRINCIPAL",tipo:"ADICIONAL",concepto:"Mejora en especificaciones de pavimento",montoOriginal:125e3,montoAprobado:125e3,fechaSolicitud:"2025-01-25",fechaAprobacion:"2025-01-28",estado:"APROBADO"}],garantias:[{obraId:1,obraNombre:"CONSTRUCCION DE CARRETERA PRINCIPAL",tipoGarantia:"FIEL CUMPLIMIENTO",entidadEmisora:"Banco de Crédito del Perú",montoGarantia:262500,fechaEmision:"2025-01-15",fechaVencimiento:"2026-04-14",estado:"VIGENTE",diasParaVencer:438},{obraId:2,obraNombre:"MEJORAMIENTO DE SISTEMA DE AGUA POTABLE",tipoGarantia:"FIEL CUMPLIMIENTO",entidadEmisora:"Banco Continental",montoGarantia:185e3,fechaEmision:"2025-01-20",fechaVencimiento:"2026-03-20",estado:"VIGENTE",diasParaVencer:413}]}),[]),r=o.useCallback(()=>({kpisPrincipales:{inversionTotal:1575e4,avanceGeneral:9.8,obrasEnEjecucion:6,eficienciaPresupuestal:98.5,indiceCumplimiento:85.2,satisfaccionSupervision:4.3},distribucionInversion:[{categoria:"Carreteras",monto:7875e3,porcentaje:50,color:"#3B82F6"},{categoria:"Saneamiento",monto:315e4,porcentaje:20,color:"#10B981"},{categoria:"Edificaciones",monto:2362500,porcentaje:15,color:"#F59E0B"},{categoria:"Electricidad",monto:1575e3,porcentaje:10,color:"#EF4444"},{categoria:"Otros",monto:787500,porcentaje:5,color:"#6B7280"}],estadoObras:{EN_EJECUCION:6,TERMINADA:2,PARALIZADA:0,CANCELADA:0,REGISTRADA:1},rankingContratistas:[{id:1,nombre:"CONSTRUCTORA ABC S.A.C.",obrasEnEjecucion:2,montoTotal:4475e3,promedioAvance:9.8,indiceCumplimiento:95.5,penalidades:0,calificacionDesempeño:"EXCELENTE",tendencia:"ESTABLE"},{id:2,nombre:"INGENIERIA XYZ E.I.R.L.",obrasEnEjecucion:2,montoTotal:32e5,promedioAvance:10.2,indiceCumplimiento:88.3,penalidades:0,calificacionDesempeño:"BUENO",tendencia:"MEJORANDO"}],analisisRiesgos:[{categoria:"Cronograma",descripcion:"Posibles retrasos por condiciones climáticas",probabilidad:.3,impacto:.6,nivel:"MEDIO",medidaPreventiva:"Planificar actividades alternativas para época de lluvias"},{categoria:"Presupuesto",descripcion:"Incremento en costos de materiales",probabilidad:.5,impacto:.4,nivel:"MEDIO",medidaPreventiva:"Monitoreo semanal de precios y contratos marco"}],tendenciasPorRegion:[{region:"Lima Norte",obrasActivas:3,inversion:875e4,avancePromedio:9.5,problemas:1},{region:"Lima Sur",obrasActivas:2,inversion:425e4,avancePromedio:10.1,problemas:0},{region:"Lima Este",obrasActivas:1,inversion:275e4,avancePromedio:10.8,problemas:0}],proyeccionesEstrategicas:{metaAnual:85,proyeccionAlcance:82.5,brechaEsperada:-2.5,accionesCorrectivas:["Incrementar supervisión en obras críticas","Optimizar procesos de aprobación de valorizaciones","Implementar sistema de alerta temprana"],oportunidadesMejora:["Digitalización de procesos de control","Capacitación continua del personal técnico","Implementación de metodología BIM"]}}),[]),c=o.useCallback(async d=>{x(!0),n(null);try{await new Promise(y=>setTimeout(y,2e3));const A={id:Math.max(...s.map(y=>y.id))+1,tipo:d.tipo,nombre:d.nombre,descripcion:d.descripcion,filtros:d.filtros,opciones:d.opciones,estado:"COMPLETADO",fechaGeneracion:new Date().toISOString(),tiempoGeneracion:Math.floor(Math.random()*120)+30,tamaño:Math.floor(Math.random()*5e6)+1e6,formato:d.configuracionExportacion.formato,rutaArchivo:`/reportes/${d.nombre.toLowerCase().replace(/\s+/g,"-")}.${d.configuracionExportacion.formato.toLowerCase()}`,urlDescarga:`/api/reportes/download/${Math.max(...s.map(y=>y.id))+1}`,numeroDescargas:0,usuarioSolicitante:"admin",activo:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b(y=>[...y,A]),A}catch(A){const y=A instanceof Error?A.message:"Error al generar reporte";throw n(y),A}finally{x(!1)}},[s]),p=o.useCallback((d,A)=>{switch(d){case"VALORIZACION_MENSUAL":return _(A);case"AVANCE_OBRA":return w(A);case"FINANCIERO_CONSOLIDADO":return i();case"CONTROL_CONTRACTUAL":return t();case"GERENCIAL_EJECUTIVO":return r();default:throw new Error(`Tipo de reporte no soportado: ${d}`)}},[_,w,i,t,r]),h=o.useCallback(async d=>{x(!0);try{return await new Promise(A=>setTimeout(A,500)),b(A=>A.filter(y=>y.id!==d)),!0}catch{return n("Error al eliminar reporte"),!1}finally{x(!1)}},[]),a=o.useCallback(async d=>{try{const A=s.find(y=>y.id===d);if(!A)throw new Error("Reporte no encontrado");return b(y=>y.map(k=>k.id===d?{...k,numeroDescargas:k.numeroDescargas+1,ultimaDescarga:new Date().toISOString()}:k)),await new Promise(y=>setTimeout(y,1e3)),A.urlDescarga||null}catch{return n("Error al descargar reporte"),null}},[s]),u=o.useMemo(()=>({avanceMensual:{id:"avance-mensual",tipo:"LINE",titulo:"Avance Mensual de Obras",datos:[{periodo:"Ene",programado:10.5,real:9.8},{periodo:"Feb",programado:19,real:18.2},{periodo:"Mar",programado:28,real:26.8}],configuracion:{height:300,colores:["#3B82F6","#10B981"],mostrarLeyenda:!0,mostrarGrid:!0,ejeX:{dataKey:"periodo",label:"Periodo"},ejeY:{dataKey:"",label:"Porcentaje (%)",formato:"porcentaje"}}},distribucionInversion:{id:"distribucion-inversion",tipo:"PIE",titulo:"Distribución de Inversión por Tipo de Obra",datos:[{name:"Carreteras",value:50,color:"#3B82F6"},{name:"Saneamiento",value:20,color:"#10B981"},{name:"Edificaciones",value:15,color:"#F59E0B"},{name:"Electricidad",value:10,color:"#EF4444"},{name:"Otros",value:5,color:"#6B7280"}],configuracion:{height:300,mostrarLeyenda:!0,formatoTooltip:"porcentaje"}},flujoEfectivo:{id:"flujo-efectivo",tipo:"BAR",titulo:"Flujo de Efectivo Mensual",datos:[{periodo:"Oct",ingresos:0,egresos:450},{periodo:"Nov",ingresos:0,egresos:380},{periodo:"Dic",ingresos:0,egresos:290},{periodo:"Ene",ingresos:245,egresos:320},{periodo:"Feb",ingresos:190,egresos:285}],configuracion:{height:300,colores:["#10B981","#EF4444"],mostrarLeyenda:!0,mostrarGrid:!0,ejeX:{dataKey:"periodo",label:"Mes"},ejeY:{dataKey:"",label:"Miles de S/",formato:"moneda"}}}}),[]);return{reportes:s,loading:j,error:f,generarReporte:c,obtenerDatosReporte:p,eliminarReporte:h,descargarReporte:a,configuracionesGraficos:u}},Or=()=>{const{reportes:s}=Ba();return o.useMemo(()=>{const j=s.filter(f=>f.estado==="COMPLETADO"),x=s.reduce((f,n)=>f+n.numeroDescargas,0);return{totalReportes:s.length,reportesCompletados:j.length,reportesEnProceso:s.filter(f=>f.estado==="GENERANDO").length,reportesConError:s.filter(f=>f.estado==="ERROR").length,totalDescargas:x,reporteMasDescargado:s.reduce((f,n)=>f.numeroDescargas>n.numeroDescargas?f:n),tiempoPromedioGeneracion:j.reduce((f,n)=>f+(n.tiempoGeneracion||0),0)/(j.length||1),reportesPorTipo:s.reduce((f,n)=>(f[n.tipo]=(f[n.tipo]||0)+1,f),{})}},[s])},ss={VALORIZACION_MENSUAL:"Reporte de Valorización Mensual",AVANCE_OBRA:"Reporte de Avance de Obra",FINANCIERO_CONSOLIDADO:"Reporte Financiero Consolidado",CONTROL_CONTRACTUAL:"Reporte de Control Contractual",GERENCIAL_EJECUTIVO:"Reporte Gerencial Ejecutivo"},Ir={PDF:"PDF",EXCEL:"Excel",WORD:"Word",CSV:"CSV"},kr={MENSUAL:"Mensual",TRIMESTRAL:"Trimestral",SEMESTRAL:"Semestral",ANUAL:"Anual",PERSONALIZADO:"Personalizado"},Tr=({filtros:s,onFiltrosChange:b,tipoReporte:j,onAplicar:x,onReset:f})=>{const[n,l]=o.useState(!1),[N,_]=o.useState(""),[w,i]=o.useState(""),t=[{id:1,nombre:"CONSTRUCCION DE CARRETERA PRINCIPAL",codigo:"N.º 001-2025"},{id:2,nombre:"MEJORAMIENTO DE SISTEMA DE AGUA POTABLE",codigo:"N.º 002-2025"},{id:3,nombre:"CONSTRUCCION DE CENTRO DE SALUD",codigo:"N.º 003-2025"}],r=[{id:1,nombre:"CONSTRUCTORA ABC S.A.C.",ruc:"20123456789"},{id:2,nombre:"INGENIERIA XYZ E.I.R.L.",ruc:"20987654321"},{id:3,nombre:"GRUPO CONSTRUCTOR PERU S.A.",ruc:"20456789123"}],c=["CARRETERA","EDIFICACION","SANEAMIENTO","ELECTRICIDAD","PUENTE","OTROS"],p=["REGISTRADA","EN_EJECUCION","PARALIZADA","TERMINADA","LIQUIDADA","CANCELADA"],h=["Lima","Cusco","Arequipa","Piura","Ancash","Junín"],a=(y,k)=>{b({...s,[y]:k})},u=(y,k)=>{const O=y||[];return O.includes(k)?O.filter(D=>D!==k):[...O,k]},d=y=>{const k=new Date,O=k.getFullYear(),D=k.getMonth();switch(y){case"MENSUAL":return{inicio:new Date(O,D,1).toISOString().split("T")[0],fin:new Date(O,D+1,0).toISOString().split("T")[0]};case"TRIMESTRAL":const C=Math.floor(D/3)*3;return{inicio:new Date(O,C,1).toISOString().split("T")[0],fin:new Date(O,C+3,0).toISOString().split("T")[0]};case"SEMESTRAL":const P=D<6?0:6;return{inicio:new Date(O,P,1).toISOString().split("T")[0],fin:new Date(O,P+6,0).toISOString().split("T")[0]};case"ANUAL":return{inicio:new Date(O,0,1).toISOString().split("T")[0],fin:new Date(O,11,31).toISOString().split("T")[0]};default:return{inicio:s.fechaInicio,fin:s.fechaFin}}},A=y=>{const k=d(y);b({...s,periodo:y,fechaInicio:k.inicio,fechaFin:k.fin})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ke,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros de Reporte"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configura los parámetros para generar el reporte"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>l(!n),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),"Avanzados",e.jsx(ua,{className:`w-4 h-4 transition-transform ${n?"rotate-180":""}`})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Limpiar"]})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(X,{className:"inline w-4 h-4 mr-1"}),"Período"]}),e.jsx("select",{value:s.periodo,onChange:y=>A(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:Object.entries(kr).map(([y,k])=>e.jsx("option",{value:y,children:k},y))})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Inicio"}),e.jsx("input",{type:"date",value:s.fechaInicio,onChange:y=>a("fechaInicio",y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Fin"}),e.jsx("input",{type:"date",value:s.fechaFin,onChange:y=>a("fechaFin",y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Nivel de Detalle"}),e.jsx("div",{className:"flex gap-4",children:[{value:"RESUMEN",label:"Resumen",desc:"Información básica y totalizadores"},{value:"DETALLADO",label:"Detallado",desc:"Incluye desgloses y análisis"},{value:"COMPLETO",label:"Completo",desc:"Toda la información disponible"}].map(y=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"nivelDetalle",value:y.value,checked:s.niveLDetalle===y.value,onChange:k=>a("niveLDetalle",k.target.value),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.label}),e.jsx("div",{className:"text-sm text-gray-600",children:y.desc})]})]},y.value))})]})]}),n&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"border-t border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ue,{className:"inline w-4 h-4 mr-1"}),"Obras Específicas"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar obra por nombre o código...",value:N,onChange:y=>_(y.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg",children:t.filter(y=>y.nombre.toLowerCase().includes(N.toLowerCase())||y.codigo.toLowerCase().includes(N.toLowerCase())).map(y=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.obraIds?.includes(y.id)||!1,onChange:()=>a("obraIds",u(s.obraIds,y.id)),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.codigo}),e.jsx("div",{className:"text-sm text-gray-600",children:y.nombre})]})]},y.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contratistas"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar contratista por nombre o RUC...",value:w,onChange:y=>i(y.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg",children:r.filter(y=>y.nombre.toLowerCase().includes(w.toLowerCase())||y.ruc.includes(w)).map(y=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.contratistaIds?.includes(y.id)||!1,onChange:()=>a("contratistaIds",u(s.contratistaIds,y.id)),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.nombre}),e.jsxs("div",{className:"text-sm text-gray-600",children:["RUC: ",y.ruc]})]})]},y.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipos de Obra"}),e.jsx("div",{className:"space-y-2",children:c.map(y=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.tiposObra?.includes(y)||!1,onChange:()=>a("tiposObra",u(s.tiposObra,y)),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:y})]},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estados de Obra"}),e.jsx("div",{className:"space-y-2",children:p.map(y=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.estadosObra?.includes(y)||!1,onChange:()=>a("estadosObra",u(s.estadosObra,y)),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:y.replace("_"," ")})]},y))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ee,{className:"inline w-4 h-4 mr-1"}),"Ubicación"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Departamentos"}),e.jsx("select",{multiple:!0,value:s.departamentos||[],onChange:y=>{const k=Array.from(y.target.selectedOptions,O=>O.value);a("departamentos",k)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",size:4,children:h.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Provincias"}),e.jsx("input",{type:"text",placeholder:"Escribir provincias...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Distritos"}),e.jsx("input",{type:"text",placeholder:"Escribir distritos...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"inline w-4 h-4 mr-1"}),"Rango de Montos (S/)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Monto Mínimo"}),e.jsx("input",{type:"number",placeholder:"0.00",value:s.rangoMontoMin||"",onChange:y=>a("rangoMontoMin",Number(y.target.value)||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Monto Máximo"}),e.jsx("input",{type:"number",placeholder:"999,999,999.00",value:s.rangoMontoMax||"",onChange:y=>a("rangoMontoMax",Number(y.target.value)||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Filtros Adicionales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.incluirCompletadas||!1,onChange:y=>a("incluirCompletadas",y.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir obras completadas"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.incluirParalizadas||!1,onChange:y=>a("incluirParalizadas",y.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir obras paralizadas"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.soloConAlertas||!1,onChange:y=>a("soloConAlertas",y.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Solo obras con alertas"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.soloConRetrasos||!1,onChange:y=>a("soloConRetrasos",y.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Solo obras con retrasos"})]})]})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[s.obraIds?.length?`${s.obraIds.length} obras seleccionadas`:"Todas las obras",s.contratistaIds?.length?` • ${s.contratistaIds.length} contratistas`:""]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors",children:"Restaurar"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Aplicar Filtros"})]})]})})]})},Mr=({onExportar:s,nombreReporteBase:b,className:j=""})=>{const[x,f]=o.useState({formato:"PDF",nombreArchivo:b,incluirPortada:!0,incluirIndice:!0,incluirGraficos:!0,incluirAnexos:!1,configuracionPDF:{orientacion:"portrait",tamaño:"A4",margen:20,fuente:"Arial",tamañoFuente:12,numerarPaginas:!0},configuracionExcel:{incluirFormulas:!0,incluirGraficos:!0,protegerHojas:!1}}),[n,l]=o.useState(!1),[N,_]=o.useState(null),[w,i]=o.useState(!1),t={PDF:e.jsx(re,{className:"w-6 h-6"}),EXCEL:e.jsx(sa,{className:"w-6 h-6"}),WORD:e.jsx(vt,{className:"w-6 h-6"}),CSV:e.jsx(sa,{className:"w-6 h-6"})},r={PDF:"text-red-600 bg-red-100 border-red-200",EXCEL:"text-green-600 bg-green-100 border-green-200",WORD:"text-blue-600 bg-blue-100 border-blue-200",CSV:"text-gray-600 bg-gray-100 border-gray-200"},c=(d,A)=>{f(y=>({...y,[d]:A}))},p=(d,A)=>{f(y=>({...y,configuracionPDF:{...y.configuracionPDF,[d]:A}}))},h=(d,A)=>{f(y=>({...y,configuracionExcel:{...y.configuracionExcel,[d]:A}}))},a=async()=>{l(!0),_(null);try{const d=await s(x);if(_(d),d.exito&&d.urlDescarga){const A=document.createElement("a");A.href=d.urlDescarga,A.download=x.nombreArchivo,document.body.appendChild(A),A.click(),document.body.removeChild(A)}}catch(d){_({exito:!1,error:d instanceof Error?d.message:"Error desconocido"})}finally{l(!1)}},u=d=>d<1024?`${d} B`:d<1024*1024?`${(d/1024).toFixed(1)} KB`:`${(d/(1024*1024)).toFixed(1)} MB`;return e.jsxs("div",{className:`bg-white rounded-xl shadow-lg border border-gray-200 ${j}`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ye,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Exportar Reporte"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure las opciones de exportación"})]})]}),e.jsxs("button",{onClick:()=>i(!w),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),"Configuración"]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Formato de Exportación"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:Object.entries(Ir).map(([d,A])=>e.jsx("button",{onClick:()=>c("formato",d),className:`p-4 border-2 rounded-lg transition-all ${x.formato===d?`${r[d]} border-current`:"border-gray-200 hover:border-gray-300 text-gray-600 hover:text-gray-800"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t[d],e.jsx("span",{className:"text-sm font-medium",children:A})]})},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Archivo"}),e.jsx("input",{type:"text",value:x.nombreArchivo,onChange:d=>c("nombreArchivo",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del archivo sin extensión"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Contenido a Incluir"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.incluirPortada,onChange:d=>c("incluirPortada",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir portada"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.incluirIndice,onChange:d=>c("incluirIndice",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir índice"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.incluirGraficos,onChange:d=>c("incluirGraficos",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir gráficos"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.incluirAnexos,onChange:d=>c("incluirAnexos",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir anexos"})]})]})]}),w&&e.jsxs(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-gray-200 pt-6 space-y-6",children:[x.formato==="PDF"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Configuración PDF"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Orientación"}),e.jsxs("select",{value:x.configuracionPDF?.orientacion,onChange:d=>p("orientacion",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"portrait",children:"Vertical"}),e.jsx("option",{value:"landscape",children:"Horizontal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Tamaño de Página"}),e.jsxs("select",{value:x.configuracionPDF?.tamaño,onChange:d=>p("tamaño",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"A4",children:"A4"}),e.jsx("option",{value:"A3",children:"A3"}),e.jsx("option",{value:"Letter",children:"Letter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Margen (mm)"}),e.jsx("input",{type:"number",value:x.configuracionPDF?.margen,onChange:d=>p("margen",Number(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",min:"10",max:"50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Tamaño de Fuente"}),e.jsx("input",{type:"number",value:x.configuracionPDF?.tamañoFuente,onChange:d=>p("tamañoFuente",Number(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",min:"8",max:"16"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.configuracionPDF?.numerarPaginas,onChange:d=>p("numerarPaginas",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Numerar páginas"})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Marca de Agua (opcional)"}),e.jsx("input",{type:"text",value:x.configuracionPDF?.marcaAgua||"",onChange:d=>p("marcaAgua",d.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Texto de marca de agua"})]})]}),x.formato==="EXCEL"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Configuración Excel"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.configuracionExcel?.incluirFormulas,onChange:d=>h("incluirFormulas",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir fórmulas"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.configuracionExcel?.incluirGraficos,onChange:d=>h("incluirGraficos",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Incluir gráficos en hojas separadas"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.configuracionExcel?.protegerHojas,onChange:d=>h("protegerHojas",d.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Proteger hojas contra modificación"})]})]})]})]}),(n||N)&&e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[n&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Generando reporte..."}),e.jsx("div",{className:"text-sm text-blue-600",children:"Esto puede tomar unos momentos"})]})]}),N&&e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg ${N.exito?"bg-green-50 text-green-900":"bg-red-50 text-red-900"}`,children:[N.exito?e.jsx(B,{className:"w-5 h-5 text-green-600 mt-0.5"}):e.jsx(Y,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:N.exito?"Reporte generado exitosamente":"Error al generar reporte"}),e.jsx("div",{className:"text-sm mt-1",children:N.exito?e.jsxs("div",{className:"space-y-1",children:[N.tamaño&&e.jsxs("div",{children:["Tamaño: ",u(N.tamaño)]}),N.tiempoGeneracion&&e.jsxs("div",{children:["Tiempo: ",N.tiempoGeneracion,"s"]}),e.jsx("div",{children:"La descarga debería iniciarse automáticamente"})]}):e.jsx("div",{children:N.error})})]}),e.jsx("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:a,disabled:n||!x.nombreArchivo,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(ye,{className:"w-5 h-5"}),n?"Generando...":"Exportar Reporte"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(be,{className:"w-5 h-5"}),"Enviar por Email"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(yt,{className:"w-5 h-5"}),"Imprimir"]})]})})]})]})},zr=({datos:s,filtros:b})=>{const j=o.useMemo(()=>({totalPartidas:s.partidas.length,partidasConAvance:s.partidas.filter(n=>n.metradoActual>0).length,montoTotalPartidas:s.partidas.reduce((n,l)=>n+l.montoContractual,0),montoEjecutadoPartidas:s.partidas.reduce((n,l)=>n+l.montoActual,0),porcentajeDeduccionesTotales:s.valorizacion.deducciones.total/s.valorizacion.montoBruto*100,eficienciaEjecucion:s.valorizacion.avanceFisicoAcumulado/s.valorizacion.avanceEconomicoAcumulado*100}),[s]),x=n=>`S/ ${n.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}`,f=n=>`${n.toFixed(2)}%`;return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center border-b border-gray-200 pb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"REPORTE DE VALORIZACIÓN MENSUAL"}),e.jsxs("p",{className:"text-lg text-gray-700 mb-1",children:["Valorización N° ",s.valorizacion.numero," - ",s.valorizacion.periodo]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Período: ",s.valorizacion.periodoInicio," al ",s.valorizacion.periodoFin]})]}),e.jsxs(S.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Información General de la Obra"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nombre:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.obra.nombre})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"N° Contrato:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.obra.numeroContrato})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ubicación:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center gap-1",children:[e.jsx(Ee,{className:"w-4 h-4 text-gray-500"}),s.obra.ubicacion]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tipo de Obra:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.obra.tipoObra})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Modalidad:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.obra.modalidadEjecucion})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Ejecución:"}),e.jsx("span",{className:"col-span-2 text-sm font-medium text-green-700",children:x(s.obra.montoEjecucion)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Supervisión:"}),e.jsx("span",{className:"col-span-2 text-sm font-medium text-blue-700",children:x(s.obra.montoSupervision)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Total:"}),e.jsx("span",{className:"col-span-2 text-sm font-bold text-gray-900",children:x(s.obra.montoTotal)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Plazo:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4 text-gray-500"}),s.obra.plazoEjecucionDias," días"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fecha Inicio:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.obra.fechaInicio})]})]})]})})]}),e.jsxs(S.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-green-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Contratista Ejecutor"})]})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Razón Social"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.contratista.nombre})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"RUC"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.contratista.ruc})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Representante Legal"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.contratista.representanteLegal})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Dirección"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.contratista.direccion})]}),(s.contratista.telefono||s.contratista.email)&&e.jsxs("div",{className:"flex items-center gap-4 pt-2 text-sm text-gray-600",children:[s.contratista.telefono&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),s.contratista.telefono]}),s.contratista.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),s.contratista.email]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Supervisor de Obra"})]})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Razón Social"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.supervisor.nombre})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"RUC"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.supervisor.ruc})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Supervisor Responsable"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.supervisor.supervisorResponsable})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Dirección"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.supervisor.direccion})]}),(s.supervisor.telefono||s.supervisor.email)&&e.jsxs("div",{className:"flex items-center gap-4 pt-2 text-sm text-gray-600",children:[s.supervisor.telefono&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),s.supervisor.telefono]}),s.supervisor.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),s.supervisor.email]})]})]})]})]}),e.jsxs(S.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Resumen de Valorización N° ",s.valorizacion.numero]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Montos y Cálculos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Bruto:"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:x(s.valorizacion.montoBruto)})]}),e.jsxs("div",{className:"ml-4 space-y-2 bg-red-50 p-3 rounded",children:[e.jsx("div",{className:"text-xs font-semibold text-red-800 mb-2",children:"DEDUCCIONES"}),[{label:"Adelanto Directo",valor:s.valorizacion.deducciones.adelantoDirecto},{label:"Adelanto Materiales",valor:s.valorizacion.deducciones.adelantoMateriales},{label:"Retención Garantía",valor:s.valorizacion.deducciones.retencionGarantia},{label:"Penalidades",valor:s.valorizacion.deducciones.penalidades},{label:"Otras Deducciones",valor:s.valorizacion.deducciones.otras}].map((n,l)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-700",children:[n.label,":"]}),e.jsxs("span",{className:"text-xs font-medium text-red-700",children:["-",x(n.valor)]})]},l)),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-red-200",children:[e.jsx("span",{className:"text-xs font-semibold text-red-800",children:"Total Deducciones:"}),e.jsxs("span",{className:"text-xs font-bold text-red-800",children:["-",x(s.valorizacion.deducciones.total)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Monto Neto:"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:x(s.valorizacion.montoNeto)})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"IGV (18%):"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:x(s.valorizacion.igv)})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 border-t-2 border-gray-300 bg-green-50 px-3 rounded",children:[e.jsx("span",{className:"text-md font-bold text-gray-900",children:"Monto Total con IGV:"}),e.jsx("span",{className:"text-lg font-bold text-green-700",children:x(s.valorizacion.montoTotal)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Estado y Fechas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-full ${s.valorizacion.estado==="APROBADA"?"bg-green-100":s.valorizacion.estado==="PAGADA"?"bg-blue-100":"bg-yellow-100"}`,children:s.valorizacion.estado==="APROBADA"||s.valorizacion.estado==="PAGADA"?e.jsx(B,{className:`w-4 h-4 ${s.valorizacion.estado==="PAGADA"?"text-blue-600":"text-green-600"}`}):e.jsx(Q,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Estado"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.valorizacion.estado})]})]}),s.valorizacion.fechaPresentacion&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"F. Presentación"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.valorizacion.fechaPresentacion})]}),s.valorizacion.fechaAprobacion&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"F. Aprobación"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.valorizacion.fechaAprobacion})]}),s.valorizacion.fechaPago&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"F. Pago"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.valorizacion.fechaPago})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"Avance de Obra"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Avance Físico Mensual"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:f(s.valorizacion.avanceFisicoMensual)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.valorizacion.avanceFisicoMensual}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Avance Económico Mensual"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:f(s.valorizacion.avanceEconomicoMensual)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${s.valorizacion.avanceEconomicoMensual}%`}})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Avance Físico Acumulado"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:f(s.valorizacion.avanceFisicoAcumulado)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full",style:{width:`${s.valorizacion.avanceFisicoAcumulado}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Avance Económico Acumulado"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:f(s.valorizacion.avanceEconomicoAcumulado)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-green-600 h-3 rounded-full",style:{width:`${s.valorizacion.avanceEconomicoAcumulado}%`}})})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Estadísticas"}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Partidas:"}),e.jsx("span",{className:"font-medium",children:j.totalPartidas})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Con Avance:"}),e.jsx("span",{className:"font-medium text-green-600",children:j.partidasConAvance})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"% Deducciones:"}),e.jsx("span",{className:"font-medium text-red-600",children:f(j.porcentajeDeduccionesTotales)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Eficiencia:"}),e.jsx("span",{className:`font-medium ${j.eficienciaEjecucion>=95?"text-green-600":j.eficienciaEjecucion>=85?"text-yellow-600":"text-red-600"}`,children:f(j.eficienciaEjecucion)})]})]})]})]})]})})]}),e.jsxs(S.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Firmas y Aprobaciones"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Valorización elaborada y presentada en la fecha: ",e.jsx("strong",{children:s.firmas.fechaFirmas})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 mb-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.firmas.residenteObra}),e.jsx("p",{className:"text-sm text-gray-600",children:"RESIDENTE DE OBRA"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Contratista Ejecutor"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 mb-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.firmas.supervisorObra}),e.jsx("p",{className:"text-sm text-gray-600",children:"SUPERVISOR DE OBRA"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Supervisor de Obra"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 mb-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.firmas.responsableEntidad}),e.jsx("p",{className:"text-sm text-gray-600",children:"RESPONSABLE DE LA ENTIDAD"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Entidad Contratante"})]})})]})]})]})]})},Lr=({datos:s,filtros:b})=>{const j={programado:"#3B82F6",real:"#10B981",info:"#06B6D4"},x=s.cronograma.map((i,t)=>({periodo:i.periodo,avanceProgramado:i.acumuladoProgramado,avanceReal:i.acumuladoReal,meta:t===0?i.acumuladoProgramado:void 0,proyeccion:t>0?i.acumuladoReal+(i.acumuladoProgramado-i.acumuladoReal)*.8:void 0})),f=s.cronograma.map(i=>({periodo:i.periodo,desviacion:i.acumuladoReal-i.acumuladoProgramado,programado:i.acumuladoProgramado,real:i.acumuladoReal})),n=[{hito:"Inicio de Obra",fecha:s.obra.fechaInicio,estado:"completado",avance:0},{hito:"Primera Valorización",fecha:"2025-02-01",estado:"completado",avance:9.8},{hito:"Avance 25%",fecha:"2025-04-15",estado:"programado",avance:25},{hito:"Avance 50%",fecha:"2025-07-15",estado:"programado",avance:50},{hito:"Avance 75%",fecha:"2025-10-15",estado:"programado",avance:75},{hito:"Término de Obra",fecha:s.obra.fechaFinPrevista,estado:"programado",avance:100}],l=i=>i>0?e.jsx(Us,{className:"w-4 h-4 text-green-600"}):i<0?e.jsx(Gs,{className:"w-4 h-4 text-red-600"}):e.jsx(wt,{className:"w-4 h-4 text-gray-600"}),N=i=>`${i.toFixed(1)}%`,_=i=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(i),w=({active:i,payload:t,label:r})=>i&&t&&t.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:`Periodo: ${r}`}),t.map((c,p)=>e.jsx("p",{style:{color:c.color},children:`${c.name}: ${N(c.value)}`},p))]}):null;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Reporte de Avance de Obra"}),e.jsxs("p",{className:"text-blue-100 mt-1",children:[s.obra.nombre," - ",b.fechaInicio," al ",b.fechaFin]}),e.jsxs("p",{className:"text-blue-200 text-sm mt-1",children:["Contrato: ",s.obra.numeroContrato]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:N(s.avance.fisicoReal)}),e.jsx("div",{className:"text-sm text-blue-100",children:"Avance Real"})]})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avance Físico"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:N(s.avance.fisicoReal)}),e.jsxs("div",{className:"flex items-center mt-1 text-sm",children:[l(s.avance.desviacionFisica),e.jsx("span",{className:`ml-1 ${s.avance.desviacionFisica>=0?"text-green-600":"text-red-600"}`,children:N(Math.abs(s.avance.desviacionFisica))})]})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(As,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avance Económico"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N(s.avance.economicoReal)}),e.jsxs("div",{className:"flex items-center mt-1 text-sm",children:[l(s.avance.desviacionEconomica),e.jsx("span",{className:`ml-1 ${s.avance.desviacionEconomica>=0?"text-green-600":"text-red-600"}`,children:N(Math.abs(s.avance.desviacionEconomica))})]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Días Transcurridos"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:s.obra.diasTranscurridos}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["de ",s.obra.diasTranscurridos+s.obra.diasRestantes," días"]})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(X,{className:"w-6 h-6 text-amber-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Estado del Proyecto"}),e.jsx("p",{className:`text-2xl font-bold ${s.avance.tendenciaTermino==="EN_TIEMPO"?"text-green-600":s.avance.tendenciaTermino==="ADELANTADO"?"text-blue-600":"text-red-600"}`,children:s.avance.tendenciaTermino==="EN_TIEMPO"?"A Tiempo":s.avance.tendenciaTermino==="ADELANTADO"?"Adelantado":"Atrasado"}),s.avance.diasAtrasoProyectado>0&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["+",s.avance.diasAtrasoProyectado," días proyectado"]})]}),e.jsx("div",{className:`p-3 rounded-lg ${s.avance.tendenciaTermino==="EN_TIEMPO"?"bg-green-100":s.avance.tendenciaTermino==="ADELANTADO"?"bg-blue-100":"bg-red-100"}`,children:s.avance.tendenciaTermino==="EN_TIEMPO"?e.jsx(B,{className:"w-6 h-6 text-green-600"}):s.avance.tendenciaTermino==="ADELANTADO"?e.jsx(ce,{className:"w-6 h-6 text-blue-600"}):e.jsx(H,{className:"w-6 h-6 text-red-600"})})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Curva S - Avance Programado vs Real"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Comparación del avance físico programado contra el avance real ejecutado"})]}),e.jsx("div",{className:"h-96",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Js,{data:x,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"periodo",stroke:"#666",fontSize:12,tickMargin:10}),e.jsx(Re,{stroke:"#666",fontSize:12,tickFormatter:N,domain:[0,100]}),e.jsx(he,{content:e.jsx(w,{})}),e.jsx(ms,{}),e.jsx(fs,{type:"monotone",dataKey:"proyeccion",fill:j.programado,fillOpacity:.1,stroke:"none",name:"Proyección"}),e.jsx(Ze,{type:"monotone",dataKey:"avanceProgramado",stroke:j.programado,strokeWidth:3,dot:{fill:j.programado,strokeWidth:2,r:5},activeDot:{r:7},name:"Avance Programado"}),e.jsx(Ze,{type:"monotone",dataKey:"avanceReal",stroke:j.real,strokeWidth:3,strokeDasharray:"5 5",dot:{fill:j.real,strokeWidth:2,r:5},activeDot:{r:7},name:"Avance Real"}),e.jsx(xs,{y:100,stroke:"#e0e0e0",strokeDasharray:"2 2"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Análisis de Desviaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Diferencia entre el avance programado y el real por periodo"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:f,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"periodo",stroke:"#666",fontSize:12}),e.jsx(Re,{stroke:"#666",fontSize:12,tickFormatter:N}),e.jsx(he,{formatter:(i,t)=>[N(i),t],labelFormatter:i=>`Periodo: ${i}`}),e.jsx(Se,{dataKey:"desviacion",fill:j.info,name:"Desviación (%)",radius:[2,2,0,0]}),e.jsx(xs,{y:0,stroke:"#666"})]})})})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Timeline de Hitos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cronograma de hitos principales del proyecto"})]}),e.jsx("div",{className:"space-y-4",children:n.map((i,t)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-4 h-4 rounded-full flex-shrink-0 ${i.estado==="completado"?"bg-green-500":i.estado==="en-proceso"?"bg-blue-500":"bg-gray-300"}`}),e.jsx("div",{className:`h-px flex-1 ${t<n.length-1?"bg-gray-200":"transparent"}`}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:i.hito}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(i.fecha).toLocaleDateString("es-PE")}),e.jsx("div",{className:"text-xs font-medium text-blue-600",children:N(i.avance)})]})]},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 text-amber-500 mr-2"}),"Alertas de Proyecto"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Situaciones que requieren atención inmediata"})]}),e.jsx("div",{className:"space-y-4",children:s.alertas.map(i=>e.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${i.criticidad==="CRITICO"?"border-red-500 bg-red-50":i.criticidad==="ALTO"?"border-amber-500 bg-amber-50":i.criticidad==="MEDIO"?"border-blue-500 bg-blue-50":"border-green-500 bg-green-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:i.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:i.descripcion}),i.accionRequerida&&e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["Acción: ",i.accionRequerida]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${i.criticidad==="CRITICO"?"bg-red-100 text-red-800":i.criticidad==="ALTO"?"bg-amber-100 text-amber-800":i.criticidad==="MEDIO"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:i.criticidad})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Detectado: ",new Date(i.fechaDeteccion).toLocaleDateString("es-PE")]})]},i.id))})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(Je,{className:"w-5 h-5 text-blue-500 mr-2"}),"Recomendaciones"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Acciones sugeridas para mejorar el desempeño"})]}),e.jsx("div",{className:"space-y-4",children:s.recomendaciones.map(i=>e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:i.titulo}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${i.prioridad==="ALTA"?"bg-red-100 text-red-800":i.prioridad==="MEDIA"?"bg-amber-100 text-amber-800":"bg-green-100 text-green-800"}`,children:i.prioridad})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:i.descripcion}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs",children:[i.beneficioEsperado&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-600",children:"Beneficio:"}),e.jsx("p",{className:"text-gray-600",children:i.beneficioEsperado})]}),i.responsable&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-600",children:"Responsable:"}),e.jsx("p",{className:"text-gray-600",children:i.responsable})]})]}),i.plazoEjecucion&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"font-medium text-purple-600",children:"Plazo:"}),e.jsx("span",{className:"text-gray-600 ml-1",children:i.plazoEjecucion})]})]},i.id))})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Estado de Valorizaciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Seguimiento de valorizaciones presentadas y programadas"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"#"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Fecha Programada"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Fecha Real"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Monto"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Atraso"})]})}),e.jsx("tbody",{children:s.valorizaciones.map((i,t)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900",children:i.numero}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:new Date(i.fechaProgramada).toLocaleDateString("es-PE")}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:i.fechaReal?new Date(i.fechaReal).toLocaleDateString("es-PE"):"-"}),e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900",children:_(i.monto)}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${i.estado==="APROBADA"?"bg-green-100 text-green-800":i.estado==="PRESENTADA"?"bg-blue-100 text-blue-800":i.estado==="PROGRAMADA"?"bg-gray-100 text-gray-800":"bg-amber-100 text-amber-800"}`,children:i.estado})}),e.jsx("td",{className:"py-3 px-4",children:i.diasAtraso>0?e.jsxs("span",{className:"text-red-600 font-medium",children:["+",i.diasAtraso," días"]}):e.jsx("span",{className:"text-green-600 font-medium",children:"A tiempo"})})]},t))})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"bg-gray-50 p-6 rounded-xl border border-gray-200 text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Reporte generado el ",new Date().toLocaleDateString("es-PE")," a las ",new Date().toLocaleTimeString("es-PE")]}),e.jsx("p",{className:"mt-1",children:"Sistema de Gestión de Valorizaciones - Avance de Obra"})]})]})},Fr=({datos:s,filtros:b})=>{const j={ingresos:"#10B981",egresos:"#EF4444",saldo:"#3B82F6",proyeccion:"#F59E0B",critico:"#EF4444",alerta:"#F59E0B",neutro:"#6B7280"},x=s.flujoEfectivo.map(t=>({...t,saldoPositivo:t.saldo>0?t.saldo:0,saldoNegativo:t.saldo<0?Math.abs(t.saldo):0})),f=[{name:"Adelantos Directos",value:s.deducciones.adelantosDirectos,color:j.critico},{name:"Adelantos Materiales",value:s.deducciones.adelantosMateriales,color:j.alerta},{name:"Retención Garantía",value:s.deducciones.retencionesGarantia,color:j.ingresos},{name:"Penalidades",value:s.deducciones.penalidades,color:j.neutro},{name:"Otras",value:s.deducciones.otras,color:j.saldo}].filter(t=>t.value>0),n=s.proyecciones.liquidezProyectada.map(t=>({periodo:t.periodo,disponible:t.disponible/1e3,requerido:t.requerido/1e3,gap:t.gap/1e3,gapPositivo:t.gap>0?t.gap/1e3:0,gapNegativo:t.gap<0?Math.abs(t.gap)/1e3:0})),l=t=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0}).format(t),N=t=>`${t.toFixed(1)}%`,_=t=>new Intl.NumberFormat("es-PE",{minimumFractionDigits:0}).format(t),w=({active:t,payload:r,label:c})=>t&&r&&r.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:`${c}`}),r.map((p,h)=>e.jsx("p",{style:{color:p.color},children:`${p.name}: ${l(p.value)}`},h))]}):null,i=({active:t,payload:r,label:c})=>t&&r&&r.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:`Periodo: ${c}`}),r.map((p,h)=>e.jsx("p",{style:{color:p.color},children:`${p.name}: ${l(p.value*1e3)}`},h))]}):null;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-green-600 to-emerald-700 text-white p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Reporte Financiero Consolidado"}),e.jsxs("p",{className:"text-green-100 mt-1",children:["Análisis integral de la situación financiera - ",b.fechaInicio," al ",b.fechaFin]}),e.jsxs("p",{className:"text-green-200 text-sm mt-1",children:["Inversión Total: ",l(s.resumenEjecutivo.inversionTotal)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:N(s.resumenEjecutivo.porcentajeEjecucion)}),e.jsx("div",{className:"text-sm text-green-100",children:"Ejecución Presupuestal"})]})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inversión Ejecutada"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:l(s.resumenEjecutivo.inversionEjecutada)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[N(s.resumenEjecutivo.porcentajeEjecucion)," del total"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo por Ejecutar"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l(s.resumenEjecutivo.saldoPorEjecutar)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[N(100-s.resumenEjecutivo.porcentajeEjecucion)," restante"]})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Et,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Obras Activas"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:s.resumenEjecutivo.obrasActivas}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.resumenEjecutivo.obrasTerminadas," terminadas"]})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Ve,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ROI"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:N(s.indicadores.roi)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["TIR: ",N(s.indicadores.tir)]})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6 text-amber-600"})})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600 mr-2"}),"Resumen Ejecutivo de Inversión"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Indicadores clave del estado financiero del portafolio de obras"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Inversión Total"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-blue-700",children:"Programado:"}),e.jsx("span",{className:"font-medium text-blue-900",children:l(s.resumenEjecutivo.inversionTotal)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-blue-700",children:"Ejecutado:"}),e.jsx("span",{className:"font-medium text-blue-900",children:l(s.resumenEjecutivo.inversionEjecutada)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-blue-700",children:"Por Ejecutar:"}),e.jsx("span",{className:"font-medium text-blue-900",children:l(s.resumenEjecutivo.saldoPorEjecutar)})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Estado de Obras"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-700",children:"En Ejecución:"}),e.jsx("span",{className:"font-medium text-green-900",children:s.resumenEjecutivo.obrasActivas})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-700",children:"Terminadas:"}),e.jsx("span",{className:"font-medium text-green-900",children:s.resumenEjecutivo.obrasTerminadas})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-700",children:"Paralizadas:"}),e.jsx("span",{className:"font-medium text-green-900",children:s.resumenEjecutivo.obrasParalizadas})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-amber-900 mb-3",children:"Indicadores"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-700",children:"Monto Promedio:"}),e.jsx("span",{className:"font-medium text-amber-900",children:l(s.resumenEjecutivo.montoPromedioPorObra)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-700",children:"Eficiencia:"}),e.jsx("span",{className:"font-medium text-amber-900",children:N(s.resumenEjecutivo.porcentajeEjecucion)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-amber-700",children:"Ciclo Efectivo:"}),e.jsxs("span",{className:"font-medium text-amber-900",children:[s.indicadores.cicloEfectivo," días"]})]})]})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Flujo de Efectivo Histórico"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Análisis de ingresos, egresos y saldo neto por periodo"})]}),e.jsx("div",{className:"h-96",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Js,{data:x,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"periodo",stroke:"#666",fontSize:12,angle:-45,textAnchor:"end",height:80}),e.jsx(Re,{stroke:"#666",fontSize:12,tickFormatter:t=>_(t/1e3)+"k"}),e.jsx(he,{content:e.jsx(w,{})}),e.jsx(ms,{}),e.jsx(Se,{dataKey:"ingresos",fill:j.ingresos,name:"Ingresos",radius:[2,2,0,0]}),e.jsx(Se,{dataKey:"egresos",fill:j.egresos,name:"Egresos",radius:[2,2,0,0]}),e.jsx(Ze,{type:"monotone",dataKey:"saldo",stroke:j.saldo,strokeWidth:3,dot:{fill:j.saldo,strokeWidth:2,r:5},name:"Saldo Neto"}),e.jsx(Ze,{type:"monotone",dataKey:"acumulado",stroke:j.proyeccion,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:j.proyeccion,strokeWidth:2,r:4},name:"Acumulado"}),e.jsx(xs,{y:0,stroke:"#666",strokeDasharray:"2 2"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Análisis de Liquidez Proyectada"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Comparación entre recursos disponibles y requerimientos futuros"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:n,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"periodo",stroke:"#666",fontSize:12}),e.jsx(Re,{stroke:"#666",fontSize:12,tickFormatter:t=>_(t)+"k"}),e.jsx(he,{content:e.jsx(i,{})}),e.jsx(ms,{}),e.jsx(Se,{dataKey:"disponible",fill:j.ingresos,name:"Disponible"}),e.jsx(Se,{dataKey:"requerido",fill:j.egresos,name:"Requerido"})]})})}),e.jsx("div",{className:"mt-4 space-y-2",children:n.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t.periodo,":"]}),e.jsxs("span",{className:`font-medium ${t.gap>0?"text-green-600":t.gap<0?"text-red-600":"text-gray-600"}`,children:[t.gap>0?"+":"",l(t.gap*1e3)]})]},r))})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Distribución de Deducciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Composición de las deducciones aplicadas en el periodo"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Ps,{children:[e.jsx(Ds,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:r})=>`${t} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:f.map((t,r)=>e.jsx(ds,{fill:t.color},`cell-${r}`))}),e.jsx(he,{formatter:t=>l(t)})]})})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Total: ",l(s.deducciones.total)]})}),e.jsx("div",{className:"grid grid-cols-1 gap-2 text-xs",children:f.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-gray-600",children:t.name})]}),e.jsx("span",{className:"font-medium text-gray-900",children:l(t.value)})]},r))})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Estado de Pagos por Obra"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Situación financiera detallada de cada proyecto en ejecución"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Obra"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Monto Contratado"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Ejecutado"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Pagado"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Saldo Pendiente"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Prom. Aprobación"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Prom. Pago"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Estado"})]})}),e.jsx("tbody",{children:s.estadoPagos.map((t,r)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.obraNombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.obraId]})]}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:l(t.montoContratado)}),e.jsx("td",{className:"py-3 px-4 text-right text-blue-600 font-medium",children:l(t.montoEjecutado)}),e.jsx("td",{className:"py-3 px-4 text-right text-green-600 font-medium",children:l(t.montoPagado)}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:`font-medium ${t.saldoPorPagar>0?"text-amber-600":"text-green-600"}`,children:l(t.saldoPorPagar)})}),e.jsxs("td",{className:"py-3 px-4 text-center text-gray-600",children:[t.diasPromedioAprobacion," días"]}),e.jsxs("td",{className:"py-3 px-4 text-center text-gray-600",children:[t.diasPromedioPago," días"]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.morosidad===0?"bg-green-100 text-green-800":t.morosidad<=5?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:t.morosidad===0?"Al día":`${t.morosidad}d atraso`})})]},r))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-bold text-gray-900",children:"TOTALES"}),e.jsx("td",{className:"py-3 px-4 text-right font-bold text-gray-900",children:l(s.estadoPagos.reduce((t,r)=>t+r.montoContratado,0))}),e.jsx("td",{className:"py-3 px-4 text-right font-bold text-blue-600",children:l(s.estadoPagos.reduce((t,r)=>t+r.montoEjecutado,0))}),e.jsx("td",{className:"py-3 px-4 text-right font-bold text-green-600",children:l(s.estadoPagos.reduce((t,r)=>t+r.montoPagado,0))}),e.jsx("td",{className:"py-3 px-4 text-right font-bold text-amber-600",children:l(s.estadoPagos.reduce((t,r)=>t+r.saldoPorPagar,0))}),e.jsxs("td",{colSpan:3,className:"py-3 px-4 text-center text-gray-600",children:["Promedio: ",Math.round(s.estadoPagos.reduce((t,r)=>t+r.diasPromedioPago,0)/s.estadoPagos.length)," días"]})]})})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600 mr-2"}),"Indicadores Financieros Avanzados"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Métricas de rentabilidad, eficiencia y gestión financiera"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-purple-900 mb-3 flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Rentabilidad"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-purple-700",children:"ROI:"}),e.jsx("span",{className:"font-bold text-purple-900",children:N(s.indicadores.roi)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-purple-700",children:"TIR:"}),e.jsx("span",{className:"font-bold text-purple-900",children:N(s.indicadores.tir)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-purple-700",children:"VAN:"}),e.jsx("span",{className:"font-bold text-purple-900",children:l(s.indicadores.van)})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-indigo-900 mb-3 flex items-center",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Eficiencia Operativa"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-indigo-700",children:"Margen Operativo:"}),e.jsx("span",{className:"font-bold text-indigo-900",children:N(s.indicadores.margenOperativo)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-indigo-700",children:"Rotación Activos:"}),e.jsxs("span",{className:"font-bold text-indigo-900",children:[s.indicadores.rotacionActivos.toFixed(1),"x"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-indigo-700",children:"Ciclo Efectivo:"}),e.jsxs("span",{className:"font-bold text-indigo-900",children:[s.indicadores.cicloEfectivo," días"]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-emerald-900 mb-3 flex items-center",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Gestión de Flujos"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-emerald-700",children:"Flujo Mensual Prom.:"}),e.jsx("span",{className:"font-bold text-emerald-900",children:l(s.flujoEfectivo.reduce((t,r)=>t+r.saldo,0)/s.flujoEfectivo.length)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-emerald-700",children:"Mejor Mes:"}),e.jsx("span",{className:"font-bold text-emerald-900",children:l(Math.max(...s.flujoEfectivo.map(t=>t.saldo)))})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-emerald-700",children:"Tendencia:"}),e.jsx("span",{className:`font-bold flex items-center ${s.flujoEfectivo[s.flujoEfectivo.length-1].saldo>s.flujoEfectivo[0].saldo?"text-emerald-900":"text-red-600"}`,children:s.flujoEfectivo[s.flujoEfectivo.length-1].saldo>s.flujoEfectivo[0].saldo?e.jsxs(e.Fragment,{children:["Mejorando ",e.jsx(_t,{className:"w-3 h-3 ml-1"})]}):e.jsxs(e.Fragment,{children:["Decreciendo ",e.jsx(At,{className:"w-3 h-3 ml-1"})]})})]})]})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Proyecciones de Flujo Futuro"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Estimación de ingresos futuros basada en avance de obras y probabilidades"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:s.proyecciones.flujoProyectado.map((t,r)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.periodo}),e.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.probabilidad>=.8?"bg-green-100 text-green-800":t.probabilidad>=.6?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:[N(t.probabilidad*100)," prob."]})]}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:l(t.montoProyectado)})]},r))}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Resumen de Proyecciones"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Total proyectado (próximos 3 meses): ",e.jsx("span",{className:"font-bold",children:l(s.proyecciones.flujoProyectado.reduce((t,r)=>t+r.montoProyectado,0))})]}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Probabilidad promedio de éxito: ",e.jsx("span",{className:"font-bold",children:N(s.proyecciones.flujoProyectado.reduce((t,r)=>t+r.probabilidad,0)/s.proyecciones.flujoProyectado.length*100)})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},className:"bg-gray-50 p-6 rounded-xl border border-gray-200 text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Reporte generado el ",new Date().toLocaleDateString("es-PE")," a las ",new Date().toLocaleTimeString("es-PE")]}),e.jsx("p",{className:"mt-1",children:"Sistema de Gestión de Valorizaciones - Análisis Financiero Consolidado"})]})]})},Vr=({datos:s,filtros:b})=>{const j={vigente:"#10B981",critico:"#EF4444",alerta:"#F59E0B",garantia:"#8B5CF6"};[{name:"Vigentes",value:s.contratosVigentes.length,color:j.vigente},{name:"Por Vencer",value:s.contratosVigentes.filter(t=>t.diasRestantes<=90).length,color:j.alerta},{name:"Críticos",value:s.contratosVigentes.filter(t=>t.diasRestantes<=30).length,color:j.critico}].filter(t=>t.value>0);const x=s.vencimientos.reduce((t,r)=>{const c=new Date(r.fechaVencimiento).toLocaleDateString("es-PE",{month:"short",year:"numeric"});return t[c]=(t[c]||0)+1,t},{}),f=Object.entries(x).map(([t,r])=>({mes:t,cantidad:r,criticos:s.vencimientos.filter(c=>new Date(c.fechaVencimiento).toLocaleDateString("es-PE",{month:"short",year:"numeric"})===t&&c.criticidad==="CRITICO").length})).slice(0,6),n=s.garantias.reduce((t,r)=>(t[r.tipoGarantia]=(t[r.tipoGarantia]||0)+r.montoGarantia,t),{}),l=Object.entries(n).map(([t,r])=>({name:t,value:r,color:j.garantia})),N=t=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0}).format(t),_=t=>{switch(t){case"CRITICO":return"bg-red-100 text-red-800 border-red-200";case"ALTO":return"bg-orange-100 text-orange-800 border-orange-200";case"MEDIO":return"bg-amber-100 text-amber-800 border-amber-200";case"BAJO":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},w=t=>{switch(t){case"CRITICO":return e.jsx(aa,{className:"w-4 h-4"});case"ALTO":return e.jsx(Q,{className:"w-4 h-4"});case"MEDIO":return e.jsx(Y,{className:"w-4 h-4"});case"BAJO":return e.jsx(B,{className:"w-4 h-4"});default:return e.jsx(ke,{className:"w-4 h-4"})}},i=({active:t,payload:r,label:c})=>t&&r&&r.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:c}),r.map((p,h)=>e.jsx("p",{style:{color:p.color},children:`${p.name}: ${p.value}`},h))]}):null;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-purple-600 to-purple-800 text-white p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Reporte de Control Contractual"}),e.jsxs("p",{className:"text-purple-100 mt-1",children:["Seguimiento integral de contratos, garantías y obligaciones - ",b.fechaInicio," al ",b.fechaFin]}),e.jsxs("p",{className:"text-purple-200 text-sm mt-1",children:[s.contratosVigentes.length," contratos vigentes en seguimiento"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:s.contratosVigentes.length}),e.jsx("div",{className:"text-sm text-purple-100",children:"Contratos Activos"})]})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contratos Vigentes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:s.contratosVigentes.length}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.contratosVigentes.filter(t=>t.diasRestantes<=90).length," próximos a vencer"]})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(re,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total Garantías"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:N(s.garantias.reduce((t,r)=>t+r.montoGarantia,0))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.garantias.length," garantías activas"]})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ge,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vencimientos Próximos"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:s.vencimientos.filter(t=>t.diasParaVencer<=30).length}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"en los próximos 30 días"})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-amber-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Adicionales/Deductivos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N(s.adicionalesDeductivos.reduce((t,r)=>t+r.montoAprobado,0))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.adicionalesDeductivos.length," modificaciones"]})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6 text-green-600"})})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(Ue,{className:"w-5 h-5 text-purple-600 mr-2"}),"Estado de Contratos Vigentes"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Situación detallada de todos los contratos en ejecución"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Contrato"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Obra"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Contratista"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Monto"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Avance"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Días Restantes"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Riesgo"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Estado"})]})}),e.jsx("tbody",{children:s.contratosVigentes.map((t,r)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.numeroContrato}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.fechaInicio).toLocaleDateString("es-PE")})]}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900 max-w-xs truncate",children:t.nombreObra}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.obraId]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-gray-900",children:t.contratista})}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:N(t.montoContrato)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-12 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,t.avanceFisico)}%`}})}),e.jsxs("span",{className:"ml-2 text-sm font-medium",children:[t.avanceFisico.toFixed(1),"%"]})]})}),e.jsxs("td",{className:"py-3 px-4 text-center",children:[e.jsxs("span",{className:`font-medium ${t.diasRestantes<=30?"text-red-600":t.diasRestantes<=90?"text-amber-600":"text-green-600"}`,children:[t.diasRestantes," días"]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.fechaFinPrevista).toLocaleDateString("es-PE")})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full border ${_(t.riesgoIncumplimiento)}`,children:[w(t.riesgoIncumplimiento),e.jsx("span",{className:"ml-1",children:t.riesgoIncumplimiento})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:t.estadoContrato})})]},r))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(X,{className:"w-5 h-5 text-amber-600 mr-2"}),"Timeline de Vencimientos"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribución temporal de vencimientos próximos"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:f,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"mes",stroke:"#666",fontSize:12,angle:-45,textAnchor:"end",height:60}),e.jsx(Re,{stroke:"#666",fontSize:12}),e.jsx(he,{content:e.jsx(i,{})}),e.jsx(ms,{}),e.jsx(Se,{dataKey:"cantidad",fill:j.alerta,name:"Total Vencimientos"}),e.jsx(Se,{dataKey:"criticos",fill:j.critico,name:"Críticos"})]})})})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600 mr-2"}),"Distribución de Garantías"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Composición del portafolio de garantías vigentes"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Ps,{children:[e.jsx(Ds,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:r})=>`${t} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:l.map((t,r)=>e.jsx(ds,{fill:t.color},`cell-${r}`))}),e.jsx(he,{formatter:t=>N(t)})]})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Total: ",N(s.garantias.reduce((t,r)=>t+r.montoGarantia,0))]})}),e.jsx("div",{className:"space-y-2 text-sm",children:l.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-gray-600",children:t.name})]}),e.jsx("span",{className:"font-medium text-gray-900",children:N(t.value)})]},r))})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(H,{className:"w-5 h-5 text-red-600 mr-2"}),"Seguimiento de Vencimientos Críticos"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Documentos, garantías y obligaciones que requieren atención inmediata"})]}),e.jsx("div",{className:"space-y-4",children:s.vencimientos.sort((t,r)=>t.diasParaVencer-r.diasParaVencer).slice(0,10).map((t,r)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${t.diasParaVencer<=7?"border-red-500 bg-red-50":t.diasParaVencer<=30?"border-amber-500 bg-amber-50":t.diasParaVencer<=60?"border-blue-500 bg-blue-50":"border-green-500 bg-green-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.descripcion}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${_(t.criticidad)}`,children:t.tipo})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.accionRequerida}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Vence: ",new Date(t.fechaVencimiento).toLocaleDateString("es-PE")]}),e.jsx("span",{className:`font-medium ${t.diasParaVencer<=7?"text-red-600":t.diasParaVencer<=30?"text-amber-600":"text-blue-600"}`,children:t.diasParaVencer<=0?"VENCIDO":`${t.diasParaVencer} días`})]})]}),e.jsx("div",{className:`p-2 rounded-full ${t.diasParaVencer<=7?"bg-red-100":t.diasParaVencer<=30?"bg-amber-100":"bg-blue-100"}`,children:t.diasParaVencer<=7?e.jsx(aa,{className:"w-5 h-5 text-red-600"}):t.diasParaVencer<=30?e.jsx(Q,{className:"w-5 h-5 text-amber-600"}):e.jsx(H,{className:"w-5 h-5 text-blue-600"})})]})},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(xa,{className:"w-5 h-5 text-red-600 mr-2"}),"Penalidades Aplicadas"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Registro de penalidades por incumplimientos contractuales"})]}),s.penalidades.length>0?e.jsx("div",{className:"space-y-4",children:s.penalidades.map((t,r)=>e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-red-900",children:t.tipoIncumplimiento}),e.jsx("span",{className:"text-sm font-bold text-red-600",children:N(t.montoAplicado)})]}),e.jsxs("p",{className:"text-sm text-red-700 mb-1",children:["Obra: ",t.obraNombre]}),e.jsxs("p",{className:"text-sm text-red-600",children:["Fecha: ",new Date(t.fechaIncumplimiento).toLocaleDateString("es-PE")]}),t.observaciones&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:t.observaciones})]},r))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Sin Penalidades"}),e.jsx("p",{className:"text-gray-600",children:"No se han aplicado penalidades en el periodo"})]})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 text-green-600 mr-2"}),"Adicionales y Deductivos"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Modificaciones contractuales aprobadas y en proceso"})]}),e.jsx("div",{className:"space-y-4",children:s.adicionalesDeductivos.map((t,r)=>e.jsxs("div",{className:`p-4 rounded-lg border ${t.tipo==="ADICIONAL"?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.tipo==="ADICIONAL"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:t.tipo}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.estado==="APROBADO"?"bg-green-100 text-green-800":t.estado==="PENDIENTE"?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:t.estado})]}),e.jsx("span",{className:`text-sm font-bold ${t.tipo==="ADICIONAL"?"text-green-600":"text-blue-600"}`,children:N(t.montoAprobado)})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:t.concepto}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.obraNombre}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Solicitado: ",new Date(t.fechaSolicitud).toLocaleDateString("es-PE")]}),t.fechaAprobacion&&e.jsxs("span",{children:["Aprobado: ",new Date(t.fechaAprobacion).toLocaleDateString("es-PE")]})]}),t.montoOriginal!==t.montoAprobado&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Monto original: ",N(t.montoOriginal)]})]},r))})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-purple-600 mr-2"}),"Estado Detallado de Garantías"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Seguimiento completo de todas las garantías vigentes"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Obra"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Tipo Garantía"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Entidad Emisora"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Monto"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Fecha Emisión"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Vencimiento"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Días Para Vencer"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Estado"})]})}),e.jsx("tbody",{children:s.garantias.map((t,r)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900 max-w-xs truncate",children:t.obraNombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.obraId]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:t.tipoGarantia})}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:t.entidadEmisora}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:N(t.montoGarantia)}),e.jsx("td",{className:"py-3 px-4 text-center text-gray-600",children:new Date(t.fechaEmision).toLocaleDateString("es-PE")}),e.jsx("td",{className:"py-3 px-4 text-center text-gray-600",children:new Date(t.fechaVencimiento).toLocaleDateString("es-PE")}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`font-medium ${t.diasParaVencer<=30?"text-red-600":t.diasParaVencer<=90?"text-amber-600":"text-green-600"}`,children:[t.diasParaVencer," días"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.estado==="VIGENTE"?"bg-green-100 text-green-800":t.estado==="POR_VENCER"?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:t.estado})})]},r))})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},className:"bg-gray-50 p-6 rounded-xl border border-gray-200 text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Reporte generado el ",new Date().toLocaleDateString("es-PE")," a las ",new Date().toLocaleTimeString("es-PE")]}),e.jsx("p",{className:"mt-1",children:"Sistema de Gestión de Valorizaciones - Control Contractual y Legal"})]})]})},$r=({datos:s,filtros:b})=>{const j={primary:"#3B82F6",success:"#10B981",warning:"#F59E0B",danger:"#EF4444",purple:"#8B5CF6",slate:"#64748B"},x=[{indicador:"Cumplimiento",valor:s.kpisPrincipales.indiceCumplimiento,max:100},{indicador:"Eficiencia",valor:s.kpisPrincipales.eficienciaPresupuestal,max:100},{indicador:"Avance",valor:s.kpisPrincipales.avanceGeneral,max:100},{indicador:"Satisfacción",valor:s.kpisPrincipales.satisfaccionSupervision*20,max:100},{indicador:"Calidad",valor:88.5,max:100},{indicador:"Seguridad",valor:92.3,max:100}],f=s.tendenciasPorRegion.map(c=>({...c,eficiencia:c.avancePromedio/(c.inversion/1e6)*100,score:c.avancePromedio*.4+(c.problemas===0?30:30-c.problemas*5)+c.obrasActivas*2})),n=s.analisisRiesgos.map(c=>({name:c.categoria,probabilidad:c.probabilidad*100,impacto:c.impacto*100,nivel:c.nivel,size:Math.max(c.probabilidad*c.impacto*100,20)})),l=Object.entries(s.estadoObras).map(([c,p])=>({name:c.replace("_"," "),value:p,color:c==="EN_EJECUCION"?j.success:c==="TERMINADA"?j.primary:c==="PARALIZADA"?j.danger:c==="CANCELADA"?j.slate:j.warning})),N=c=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0}).format(c),_=c=>`${c.toFixed(1)}%`,w=c=>new Intl.NumberFormat("es-PE",{minimumFractionDigits:0}).format(c),i=c=>{switch(c){case"MEJORANDO":return e.jsx(Us,{className:"w-4 h-4 text-green-600"});case"EMPEORANDO":return e.jsx(Gs,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Bs,{className:"w-4 h-4 text-gray-600"})}},t=c=>{switch(c){case"EXCELENTE":return"bg-green-100 text-green-800 border-green-200";case"BUENO":return"bg-blue-100 text-blue-800 border-blue-200";case"REGULAR":return"bg-amber-100 text-amber-800 border-amber-200";case"DEFICIENTE":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},r=({active:c,payload:p,label:h})=>c&&p&&p.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:h}),p.map((a,u)=>e.jsx("p",{style:{color:a.color},children:`${a.name}: ${typeof a.value=="number"&&a.value>1e3?N(a.value):w(a.value)}`},u))]}):null;return e.jsxs("div",{className:"space-y-8",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-indigo-600 to-purple-700 text-white p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Dashboard Gerencial Ejecutivo"}),e.jsxs("p",{className:"text-indigo-100 mt-1",children:["Análisis estratégico del portafolio de inversiones - ",b.fechaInicio," al ",b.fechaFin]}),e.jsxs("p",{className:"text-indigo-200 text-sm mt-1",children:["Inversión Total: ",N(s.kpisPrincipales.inversionTotal)," •",s.kpisPrincipales.obrasEnEjecucion," obras activas"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:_(s.kpisPrincipales.avanceGeneral)}),e.jsx("div",{className:"text-sm text-indigo-100",children:"Avance General"})]})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inversión Total"}),e.jsx("p",{className:"text-xl font-bold text-indigo-600",children:N(s.kpisPrincipales.inversionTotal)})]}),e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:e.jsx(ie,{className:"w-6 h-6 text-indigo-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avance General"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:_(s.kpisPrincipales.avanceGeneral)})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(As,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Obras Activas"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:s.kpisPrincipales.obrasEnEjecucion})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Ue,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Eficiencia Presup."}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:_(s.kpisPrincipales.eficienciaPresupuestal)})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cumplimiento"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:_(s.kpisPrincipales.indiceCumplimiento)})]}),e.jsx("div",{className:"p-3 bg-emerald-100 rounded-lg",children:e.jsx(ta,{className:"w-6 h-6 text-emerald-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Satisfacción"}),e.jsxs("p",{className:"text-xl font-bold text-amber-600",children:[s.kpisPrincipales.satisfaccionSupervision.toFixed(1),"/5.0"]})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(Ws,{className:"w-6 h-6 text-amber-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Distribución de Inversión por Sector"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Composición del portafolio de inversiones por tipo de obra"})]}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsx(zt,{data:s.distribucionInversion,dataKey:"monto",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",children:s.distribucionInversion.map((c,p)=>e.jsx(ds,{fill:c.color},`cell-${p}`))})})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-4",children:s.distribucionInversion.map((c,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.color}}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:c.categoria}),e.jsx("div",{className:"text-gray-600",children:_(c.porcentaje)})]})]},p))})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Estado de Obras"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Distribución por estado de ejecución"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Ps,{children:[e.jsx(Ds,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:c,percent:p})=>`${c} ${(p*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:l.map((c,p)=>e.jsx(ds,{fill:c.color},`cell-${p}`))}),e.jsx(he,{})]})})}),e.jsx("div",{className:"space-y-2 text-sm",children:l.map((c,p)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:c.color}}),e.jsx("span",{className:"text-gray-600",children:c.name})]}),e.jsx("span",{className:"font-medium text-gray-900",children:c.value})]},p))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ta,{className:"w-5 h-5 text-blue-600 mr-2"}),"Radar de Desempeño Integral"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Evaluación multidimensional del desempeño organizacional"})]}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Lt,{data:x,children:[e.jsx(Ft,{stroke:"#e5e7eb"}),e.jsx(Vt,{dataKey:"indicador",tick:{fontSize:12}}),e.jsx($t,{angle:90,domain:[0,100],tick:{fontSize:10},tickFormatter:_}),e.jsx(Ut,{name:"Desempeño",dataKey:"valor",stroke:j.primary,fill:j.primary,fillOpacity:.3,strokeWidth:2})]})})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Score Promedio: ",e.jsx("span",{className:"font-bold text-blue-600",children:_(x.reduce((c,p)=>c+p.valor,0)/x.length)})]})})]}),e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600 mr-2"}),"Matriz de Análisis de Riesgos"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Evaluación de probabilidad vs impacto de riesgos identificados"})]}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Gt,{children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{type:"number",dataKey:"probabilidad",name:"Probabilidad",domain:[0,100],tickFormatter:c=>`${c}%`}),e.jsx(Re,{type:"number",dataKey:"impacto",name:"Impacto",domain:[0,100],tickFormatter:c=>`${c}%`}),e.jsx(he,{cursor:{strokeDasharray:"3 3"},formatter:(c,p)=>[`${c}%`,p],labelFormatter:c=>`Riesgo: ${c}`}),e.jsx(Bt,{data:n,fill:j.danger,fillOpacity:.7}),e.jsx(xs,{x:50,stroke:"#fbbf24",strokeDasharray:"2 2"}),e.jsx(xs,{y:50,stroke:"#fbbf24",strokeDasharray:"2 2"})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Leyenda de Cuadrantes:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Alto Riesgo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Riesgo Medio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Bajo Riesgo"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Riesgos Críticos:"}),e.jsx("div",{className:"space-y-1",children:n.filter(c=>c.probabilidad>50&&c.impacto>50).map((c,p)=>e.jsx("div",{className:"text-red-600 font-medium",children:c.name},p))})]})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-gold-600 mr-2"}),"Ranking de Desempeño de Contratistas"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Evaluación comparativa del desempeño de proveedores"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"#"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Contratista"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Obras"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Monto Total"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Avance Prom."}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Cumplimiento"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Penalidades"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Calificación"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Tendencia"})]})}),e.jsx("tbody",{children:s.rankingContratistas.map((c,p)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-white font-bold",children:p+1})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:c.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",c.id]})]}),e.jsx("td",{className:"py-3 px-4 text-center font-medium text-blue-600",children:c.obrasEnEjecucion}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:N(c.montoTotal)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min(100,c.promedioAvance)}%`}})}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:_(c.promedioAvance)})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`font-medium ${c.indiceCumplimiento>=90?"text-green-600":c.indiceCumplimiento>=75?"text-amber-600":"text-red-600"}`,children:_(c.indiceCumplimiento)})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`font-medium ${c.penalidades===0?"text-green-600":c.penalidades<=2?"text-amber-600":"text-red-600"}`,children:c.penalidades})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${t(c.calificacionDesempeño)}`,children:c.calificacionDesempeño})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[i(c.tendencia),e.jsx("span",{className:"ml-1 text-xs text-gray-600",children:c.tendencia})]})})]},p))})]})})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(Ee,{className:"w-5 h-5 text-purple-600 mr-2"}),"Análisis de Tendencias por Región"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Comparativo de desempeño e inversión por zona geográfica"})]}),e.jsx("div",{className:"h-80 mb-6",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(Js,{data:f,children:[e.jsx(Ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Be,{dataKey:"region",stroke:"#666",fontSize:12}),e.jsx(Re,{yAxisId:"left",stroke:"#666",fontSize:12,tickFormatter:c=>w(c)}),e.jsx(Re,{yAxisId:"right",orientation:"right",stroke:"#666",fontSize:12,tickFormatter:c=>`${c}%`}),e.jsx(he,{content:e.jsx(r,{})}),e.jsx(ms,{}),e.jsx(Se,{yAxisId:"left",dataKey:"inversion",fill:j.primary,name:"Inversión (S/)",radius:[2,2,0,0]}),e.jsx(Se,{yAxisId:"left",dataKey:"obrasActivas",fill:j.success,name:"Obras Activas",radius:[2,2,0,0]}),e.jsx(Ze,{yAxisId:"right",type:"monotone",dataKey:"avancePromedio",stroke:j.warning,strokeWidth:3,dot:{fill:j.warning,strokeWidth:2,r:6},name:"Avance Promedio (%)"}),e.jsx(Ze,{yAxisId:"right",type:"monotone",dataKey:"score",stroke:j.purple,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:j.purple,strokeWidth:2,r:4},name:"Score de Eficiencia"})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:f.map((c,p)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:c.region}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${c.problemas===0?"bg-green-100 text-green-800":c.problemas<=2?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:c.problemas===0?"Sin problemas":`${c.problemas} problemas`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Obras:"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:c.obrasActivas})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Avance:"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:_(c.avancePromedio)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-600",children:"Inversión:"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:N(c.inversion)})]})]})]},p))})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(ke,{className:"w-5 h-5 text-indigo-600 mr-2"}),"Proyecciones y Recomendaciones Estratégicas"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Análisis prospectivo y plan de acción para el cumplimiento de objetivos"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-indigo-900 mb-3 flex items-center",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Proyecciones de Cumplimiento"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-indigo-700 text-sm",children:"Meta Anual:"}),e.jsx("span",{className:"font-bold text-indigo-900",children:_(s.proyeccionesEstrategicas.metaAnual)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-indigo-700 text-sm",children:"Proyección Alcance:"}),e.jsx("span",{className:"font-bold text-indigo-900",children:_(s.proyeccionesEstrategicas.proyeccionAlcance)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-indigo-700 text-sm",children:"Brecha:"}),e.jsxs("span",{className:`font-bold ${s.proyeccionesEstrategicas.brechaEsperada>=0?"text-green-600":"text-red-600"}`,children:[s.proyeccionesEstrategicas.brechaEsperada>=0?"+":"",_(s.proyeccionesEstrategicas.brechaEsperada)]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 h-3 rounded-full relative",style:{width:`${Math.min(100,s.proyeccionesEstrategicas.proyeccionAlcance)}%`},children:e.jsx("div",{className:"absolute right-0 top-0 h-full w-1 bg-amber-500 rounded-r-full"})})}),e.jsx("p",{className:"text-xs text-indigo-600 mt-1",children:"Avance proyectado al cierre del año"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-amber-900 mb-3 flex items-center",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Acciones Correctivas"]}),e.jsx("div",{className:"space-y-2",children:s.proyeccionesEstrategicas.accionesCorrectivas.map((c,p)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800",children:c})]},p))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-100 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-green-900 mb-3 flex items-center",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Oportunidades de Mejora"]}),e.jsx("div",{className:"space-y-2",children:s.proyeccionesEstrategicas.oportunidadesMejora.map((c,p)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-800",children:c})]},p))})]})]})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},className:"bg-gradient-to-r from-gray-800 to-gray-900 text-white p-6 rounded-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Resumen Ejecutivo"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Estado general del portafolio de inversiones y recomendaciones estratégicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:_(s.kpisPrincipales.avanceGeneral)}),e.jsx("div",{className:"text-sm text-gray-300",children:"Avance General"}),e.jsx("div",{className:"text-xs text-green-300 mt-1",children:s.kpisPrincipales.avanceGeneral>=s.proyeccionesEstrategicas.metaAnual?"Por encima de meta":"En progreso hacia meta"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:_(s.kpisPrincipales.eficienciaPresupuestal)}),e.jsx("div",{className:"text-sm text-gray-300",children:"Eficiencia Presupuestal"}),e.jsx("div",{className:"text-xs text-blue-300 mt-1",children:s.kpisPrincipales.eficienciaPresupuestal>=95?"Excelente control":"Dentro de parámetros"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-400",children:s.analisisRiesgos.filter(c=>c.nivel==="CRITICO").length}),e.jsx("div",{className:"text-sm text-gray-300",children:"Riesgos Críticos"}),e.jsx("div",{className:"text-xs text-purple-300 mt-1",children:s.analisisRiesgos.filter(c=>c.nivel==="CRITICO").length===0?"Sin riesgos críticos":"Requieren atención"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-700 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-200",children:[e.jsx("span",{className:"font-medium",children:"Recomendación Principal:"}),s.proyeccionesEstrategicas.brechaEsperada<0?" Se requiere acelerar la ejecución de obras críticas para alcanzar la meta anual.":" El portafolio mantiene un desempeño satisfactorio. Continuar con el plan actual."]})})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"bg-gray-50 p-6 rounded-xl border border-gray-200 text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Reporte generado el ",new Date().toLocaleDateString("es-PE")," a las ",new Date().toLocaleTimeString("es-PE")]}),e.jsx("p",{className:"mt-1",children:"Sistema de Gestión de Valorizaciones - Dashboard Gerencial Ejecutivo"}),e.jsx("p",{className:"mt-1 text-xs",children:"Información clasificada para uso interno de la Alta Dirección"})]})]})},Ur=()=>{const[s,b]=o.useState("GERENCIAL_EJECUTIVO"),[j,x]=o.useState("configuracion"),[f,n]=o.useState(!1),{reportes:l,loading:N,error:_,generarReporte:w,obtenerDatosReporte:i,eliminarReporte:t,descargarReporte:r}=Ba(),c=Or(),[p,h]=o.useState({periodo:"MENSUAL",fechaInicio:new Date().toISOString().split("T")[0].replace(/-(\d{2})$/,"-01"),fechaFin:new Date().toISOString().split("T")[0],niveLDetalle:"DETALLADO"}),[a,u]=o.useState({incluirGraficos:!0,incluirResumenEjecutivo:!0,incluirAnalisisComparativo:!0,incluirRecomendaciones:!0,incluirAnexos:!1,incluirFotos:!1,numerarPaginas:!0}),d=o.useMemo(()=>({VALORIZACION_MENSUAL:{icon:re,color:"bg-blue-100 text-blue-700 border-blue-200",colorHover:"hover:bg-blue-200",colorActivo:"bg-blue-600 text-white"},AVANCE_OBRA:{icon:Ve,color:"bg-green-100 text-green-700 border-green-200",colorHover:"hover:bg-green-200",colorActivo:"bg-green-600 text-white"},FINANCIERO_CONSOLIDADO:{icon:oe,color:"bg-amber-100 text-amber-700 border-amber-200",colorHover:"hover:bg-amber-200",colorActivo:"bg-amber-600 text-white"},CONTROL_CONTRACTUAL:{icon:ha,color:"bg-purple-100 text-purple-700 border-purple-200",colorHover:"hover:bg-purple-200",colorActivo:"bg-purple-600 text-white"},GERENCIAL_EJECUTIVO:{icon:St,color:"bg-indigo-100 text-indigo-700 border-indigo-200",colorHover:"hover:bg-indigo-200",colorActivo:"bg-indigo-600 text-white"}}),[]),A=o.useCallback(async O=>{try{const D={tipo:s,nombre:`${ss[s]} - ${new Date().toLocaleDateString("es-PE")}`,filtros:p,opciones:a,configuracionExportacion:O},C=await w(D);return C.estado==="COMPLETADO"&&x("historial"),{exito:!0,rutaArchivo:C.rutaArchivo,urlDescarga:C.urlDescarga,tamaño:C.tamaño,tiempoGeneracion:C.tiempoGeneracion}}catch(D){return{exito:!1,error:D instanceof Error?D.message:"Error desconocido"}}},[s,p,a,w]),y=o.useMemo(()=>{try{return i(s,p)}catch(O){return console.error("Error al obtener datos:",O),null}},[s,p,i]),k=()=>{if(!y)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Error al cargar datos"}),e.jsx("p",{className:"text-gray-600",children:"No se pudieron obtener los datos para la vista previa"})]});switch(s){case"VALORIZACION_MENSUAL":return e.jsx(zr,{datos:y,filtros:p});case"AVANCE_OBRA":return e.jsx(Lr,{datos:y,filtros:p});case"FINANCIERO_CONSOLIDADO":return e.jsx(Fr,{datos:y,filtros:p});case"CONTROL_CONTRACTUAL":return e.jsx(Vr,{datos:y,filtros:p});case"GERENCIAL_EJECUTIVO":return e.jsx($r,{datos:y,filtros:p});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Centro de Reportes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sistema profesional de generación y análisis de reportes"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"hidden lg:flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.totalReportes}),e.jsx("div",{className:"text-gray-600",children:"Reportes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.totalDescargas}),e.jsx("div",{className:"text-gray-600",children:"Descargas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-amber-600",children:[c.tiempoPromedioGeneracion.toFixed(1),"s"]}),e.jsx("div",{className:"text-gray-600",children:"Tiempo Prom."})]})]})})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-80 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Tipo de Reporte"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona el tipo de análisis que necesitas"})]}),e.jsx("div",{className:"p-4 space-y-2",children:Object.entries(ss).map(([O,D])=>{const C=d[O],P=C.icon,M=s===O;return e.jsxs("button",{onClick:()=>b(O),className:`w-full flex items-center gap-3 p-3 rounded-lg border text-left transition-all ${M?C.colorActivo:`${C.color} ${C.colorHover}`}`,children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-sm",children:D})})]},O)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Navegación"})}),e.jsx("div",{className:"p-4 space-y-2",children:[{id:"configuracion",label:"Configuración",icon:Ke},{id:"vista-previa",label:"Vista Previa",icon:ke},{id:"historial",label:"Historial",icon:ra}].map(({id:O,label:D,icon:C})=>e.jsxs("button",{onClick:()=>x(O),className:`w-full flex items-center gap-3 p-3 rounded-lg text-left transition-all ${j===O?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:D})]},O))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Acciones"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"w-full flex items-center gap-3 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Generar Reporte"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Configurar Plantilla"})]})]})]})]}),e.jsxs("div",{className:"flex-1",children:[j==="configuracion"&&e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[e.jsx(Tr,{filtros:p,onFiltrosChange:h,tipoReporte:s,onAplicar:()=>x("vista-previa"),onReset:()=>h({periodo:"MENSUAL",fechaInicio:new Date().toISOString().split("T")[0].replace(/-(\d{2})$/,"-01"),fechaFin:new Date().toISOString().split("T")[0],niveLDetalle:"DETALLADO"})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Opciones de Presentación"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Personaliza el contenido de tu reporte"})]}),e.jsx("div",{className:"p-6 space-y-4",children:[{key:"incluirGraficos",label:"Incluir gráficos y visualizaciones"},{key:"incluirResumenEjecutivo",label:"Incluir resumen ejecutivo"},{key:"incluirAnalisisComparativo",label:"Incluir análisis comparativo"},{key:"incluirRecomendaciones",label:"Incluir recomendaciones"},{key:"incluirAnexos",label:"Incluir anexos y documentación"},{key:"numerarPaginas",label:"Numerar páginas"}].map(({key:O,label:D})=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a[O],onChange:C=>u(P=>({...P,[O]:C.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:D})]},O))})]})]}),j==="vista-previa"&&e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Vista Previa - ",ss[s]]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[p.fechaInicio," al ",p.fechaFin]})]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),"Exportar"]})]})}),e.jsx("div",{className:"max-h-[calc(100vh-300px)] overflow-y-auto",children:N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):k()})]}),j==="historial"&&e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Historial de Reportes"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l.length," reportes generados"]})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[l.map(O=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${d[O.tipo].color}`,children:(()=>{const D=d[O.tipo].icon;return e.jsx(D,{className:"w-5 h-5"})})()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:O.nombre}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ss[O.tipo]," • ",O.formato]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:new Date(O.fechaGeneracion).toLocaleDateString("es-PE")}),e.jsxs("div",{className:"text-xs",children:[O.numeroDescargas," descargas"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:O.estado==="COMPLETADO"?e.jsx(B,{className:"w-4 h-4 text-green-600"}):e.jsx(Y,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(O.id),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>t(O.id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(Cs,{className:"w-4 h-4"})})]})]})]})},O.id)),l.length===0&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ra,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No hay reportes generados"}),e.jsx("p",{className:"text-gray-600",children:"Genera tu primer reporte para verlo aquí"})]})]})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Exportar ",ss[s]]}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6",children:e.jsx(Mr,{onExportar:A,nombreReporteBase:`${ss[s]} ${new Date().toLocaleDateString("es-PE")}`})})]})}),_&&e.jsx("div",{className:"fixed bottom-6 right-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:_})]})})]})},Gr=()=>{const[s,b]=o.useState("general"),j=[{id:"general",name:"General",icon:$e},{id:"usuarios",name:"Usuarios",icon:ue},{id:"notificaciones",name:"Notificaciones",icon:ls},{id:"seguridad",name:"Seguridad",icon:ge},{id:"datos",name:"Base de Datos",icon:vs},{id:"apariencia",name:"Apariencia",icon:ia}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Configuración"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administra las preferencias y configuraciones del sistema"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-64",children:e.jsx("nav",{className:"space-y-1",children:j.map(x=>e.jsxs("button",{onClick:()=>b(x.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${s===x.id?"bg-primary-50 text-primary-600 font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(x.icon,{className:"w-5 h-5"}),x.name]},x.id))})}),e.jsxs("div",{className:"flex-1",children:[s==="general"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Configuración General"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Empresa"}),e.jsx("input",{type:"text",defaultValue:"Mi Empresa S.A.C.",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC"}),e.jsx("input",{type:"text",defaultValue:"20123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección"}),e.jsx("input",{type:"text",defaultValue:"Av. Principal 123, Lima, Perú",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono"}),e.jsx("input",{type:"text",defaultValue:"(01) 234-5678",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",defaultValue:"contacto@miempresa.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Moneda Predeterminada"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{children:"Soles (S/)"}),e.jsx("option",{children:"Dólares (USD)"}),e.jsx("option",{children:"Euros (EUR)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zona Horaria"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{children:"Lima (GMT-5)"}),e.jsx("option",{children:"Buenos Aires (GMT-3)"}),e.jsx("option",{children:"Santiago (GMT-4)"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),"Guardar Cambios"]}),e.jsx("button",{className:"btn-secondary",children:"Cancelar"})]})]})]}),s==="usuarios"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Gestión de Usuarios"}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Nuevo Usuario"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usuario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rol"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Último Acceso"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:[{nombre:"Juan Pérez",email:"juan@empresa.com",rol:"Administrador",estado:"Activo",ultimo:"Hace 2 horas"},{nombre:"María García",email:"maria@empresa.com",rol:"Supervisor",estado:"Activo",ultimo:"Hace 1 día"},{nombre:"Carlos López",email:"carlos@empresa.com",rol:"Operador",estado:"Inactivo",ultimo:"Hace 1 semana"}].map((x,f)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.nombre}),e.jsx("div",{className:"text-sm text-gray-500",children:x.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded-full",children:x.rol})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${x.estado==="Activo"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:x.estado})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x.ultimo}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsx("button",{className:"text-primary-600 hover:text-primary-900 mr-3",children:"Editar"}),e.jsx("button",{className:"text-red-600 hover:text-red-900",children:"Eliminar"})]})]},f))})]})})]}),s==="notificaciones"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Configuración de Notificaciones"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Notificaciones por Email"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Nueva valorización creada"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Valorización aprobada"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Obra completada"}),e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Reporte generado"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Notificaciones del Sistema"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Actualizaciones del sistema"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Respaldo automático completado"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Alertas de seguridad"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t",children:e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),"Guardar Preferencias"]})})]})]}),s==="seguridad"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Configuración de Seguridad"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Políticas de Contraseña"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Requerir mínimo 8 caracteres"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Requerir mayúsculas y minúsculas"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Requerir números"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Requerir caracteres especiales"}),e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Autenticación"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Habilitar autenticación de dos factores"}),e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Cerrar sesión automáticamente después de"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{children:"30 minutos"}),e.jsx("option",{children:"1 hora"}),e.jsx("option",{children:"2 horas"}),e.jsx("option",{children:"4 horas"})]})]})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t",children:e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Actualizar Seguridad"]})})]})]}),s==="datos"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Base de Datos"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(vs,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Estado de la Base de Datos"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Conectado • PostgreSQL v14.5 • 256 MB usado de 2 GB"})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Respaldos Automáticos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Habilitar respaldos automáticos"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300 text-primary-600"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Frecuencia de respaldo"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{children:"Diario"}),e.jsx("option",{children:"Semanal"}),e.jsx("option",{children:"Mensual"})]})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Mantener respaldos por"}),e.jsxs("select",{className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{children:"7 días"}),e.jsx("option",{children:"30 días"}),e.jsx("option",{children:"90 días"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Últimos Respaldos"}),e.jsx("div",{className:"space-y-2",children:[{fecha:"2024-02-15 03:00",tamaño:"125 MB",estado:"Completado"},{fecha:"2024-02-14 03:00",tamaño:"123 MB",estado:"Completado"},{fecha:"2024-02-13 03:00",tamaño:"122 MB",estado:"Completado"}].map((x,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:x.fecha}),e.jsx("p",{className:"text-xs text-gray-500",children:x.tamaño})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full",children:x.estado}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-800",children:"Restaurar"})]})]},f))})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{className:"btn-primary",children:"Crear Respaldo Manual"}),e.jsx("button",{className:"btn-secondary",children:"Optimizar Base de Datos"})]})]})]}),s==="apariencia"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"card",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Apariencia"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Tema"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("label",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"radio",name:"theme",defaultChecked:!0,className:"sr-only peer"}),e.jsxs("div",{className:"p-4 border-2 rounded-lg peer-checked:border-primary-500 peer-checked:bg-primary-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-4 h-4 bg-white rounded"}),e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded"})]}),e.jsx("p",{className:"text-sm font-medium",children:"Claro"})]})]}),e.jsxs("label",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"radio",name:"theme",className:"sr-only peer"}),e.jsxs("div",{className:"p-4 border-2 rounded-lg peer-checked:border-primary-500 peer-checked:bg-primary-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-900 rounded"}),e.jsx("div",{className:"w-12 h-1 bg-gray-700 rounded"})]}),e.jsx("p",{className:"text-sm font-medium",children:"Oscuro"})]})]}),e.jsxs("label",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"radio",name:"theme",className:"sr-only peer"}),e.jsxs("div",{className:"p-4 border-2 rounded-lg peer-checked:border-primary-500 peer-checked:bg-primary-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-r from-white to-gray-900 rounded"}),e.jsx("div",{className:"w-12 h-1 bg-gray-500 rounded"})]}),e.jsx("p",{className:"text-sm font-medium",children:"Automático"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Color Principal"}),e.jsx("div",{className:"flex gap-3",children:["bg-blue-500","bg-purple-500","bg-green-500","bg-red-500","bg-yellow-500","bg-gray-500"].map(x=>e.jsxs("label",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"radio",name:"color",className:"sr-only peer"}),e.jsx("div",{className:`w-10 h-10 rounded-lg ${x} peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-gray-900`})]},x))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Densidad de Interfaz"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{children:"Compacta"}),e.jsx("option",{children:"Normal"}),e.jsx("option",{children:"Espaciosa"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{className:"btn-primary flex items-center gap-2",children:[e.jsx(ia,{className:"w-5 h-5"}),"Aplicar Cambios"]}),e.jsx("button",{className:"btn-secondary",children:"Restablecer"})]})]})]})]})]})]})};function Br(){return e.jsx(Ot,{children:e.jsx(It,{children:e.jsxs(pe,{path:"/",element:e.jsx(Ht,{}),children:[e.jsx(pe,{index:!0,element:e.jsx(pr,{})}),e.jsx(pe,{path:"empresas",element:e.jsx(ma,{})}),e.jsx(pe,{path:"empresas/ejecutoras",element:e.jsx(ma,{})}),e.jsx(pe,{path:"empresas/supervisoras",element:e.jsx(Nr,{})}),e.jsx(pe,{path:"obras",element:e.jsx(Ar,{})}),e.jsx(pe,{path:"valorizaciones",element:e.jsx(kt,{to:"/valorizaciones/ejecucion",replace:!0})}),e.jsx(pe,{path:"valorizaciones/ejecucion",element:e.jsx(Pr,{})}),e.jsx(pe,{path:"valorizaciones/supervision",element:e.jsx(Dr,{})}),e.jsx(pe,{path:"reportes",element:e.jsx(Ur,{})}),e.jsx(pe,{path:"configuracion",element:e.jsx(Gr,{})}),e.jsx(pe,{path:"*",element:e.jsx(Jt,{})})]})})})}window.addEventListener("load",()=>{console.log("🛡️ Main.tsx: Registering Service Worker..."),va().then(s=>{console.log("✅ Main.tsx: Service Worker registered successfully:",s)}).catch(s=>{console.error("❌ Main.tsx: Service Worker registration failed:",s)})});const Wr=qt.createRoot(document.getElementById("root"));Wr.render(e.jsx(o.StrictMode,{children:e.jsx(Br,{})}));
